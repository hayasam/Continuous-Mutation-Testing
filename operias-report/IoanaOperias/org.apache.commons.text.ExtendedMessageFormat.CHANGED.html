
<!DOCTYPE HTML>
<html>
	<head>
		<link href='http://fonts.googleapis.com/css?family=Raleway:300' rel='stylesheet' type='text/css'>
		<link href='css/style.css' rel='stylesheet' type='text/css'>
		<script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
		<script type="text/javascript">
			$(document).ready(function() {
				$(".testResultButton").click(function() {
					var id = $(this).attr('id');
					$("#testResult"+id).toggle();
				});
			
				$("#showAllChanges").click(function() {
					$("#revisedCoverageTable, #originalCoverageTable, #sourceDiffTable").hide();
					$("#combinedTable").show();
				});
			
				$("#showOriginal").click(function() {
					$("#revisedCoverageTable, #combinedTable, #sourceDiffTable").hide();
					$("#originalCoverageTable").show();
				});
				
				$("#showNew").click(function() {
					$("#combinedTable, #originalCoverageTable, #sourceDiffTable").hide();
					$("#revisedCoverageTable").show();
				});
				
				$("#showSourceDiff").click(function() {
					$("#combinedTable, #originalCoverageTable, #revisedCoverageTable").hide();
					$("#sourceDiffTable").show();
				});
				
				$(".packageRow").click(function() {					
					$(".ClassIn" + $(this).attr('id')).each(function() {
						if ($(this).is(":visible")) {
							hideTr($(this));
						} else {
							showTr($(this));
						}
					});
				});
			});
			
			function hideTr(tr) {
			  tr.find('td').wrapInner('<div style="display: block;" />').parent().find('td > div').slideUp(100, function () {
				tr.hide();
				var $set = jQuery(this);
				$set.replaceWith($set.contents());
			  });
			}

			function showTr(tr) {
			  tr.show()
			  tr.find('td').wrapInner('<div style="display: none;" />').parent().find('td > div').slideDown(100, function() {
				var $set = jQuery(this);
				$set.replaceWith($set.contents());
			  });
			}
		</script>
		<title>Operias</title>
	</head>
	<body>
		<header>
			<div id="title">
				<h1>Operias</h1>
			</div>
		</header>
		<div id='legend'>
			<h2>Legend</h2>
			<div id="lightGreenLegend"></div><span class="legendText">Was originally covered</span>
			<div id="darkGreenLegend"></div><span class="legendText">Is now covered in the new version</span>
			<div id="lightRedLegend"></div><span class="legendText">Was originally not covered</span>
			<div id="darkRedLegend"></div><span class="legendText">Is not covered anymore in the new version</span>
			<div id="deletedSource"></div><span class="legendText">Row was deleted</span>
			<div id="addedSource"></div><span class="legendText">Row was added</span>
		</div><div id='breadcrumb'>
<h2><a href='index.html'>overview</a> / ExtendedMessageFormat</h2>
</div>
<div id='informationContent'>
  <strong>File</strong> org/apache/commons/text/ExtendedMessageFormat.java <br />
  <strong>Line coverage</strong> stayed the same at 88%<br />
  <strong>Branch coverage</strong> stayed the same at 73%<br />
<br/>
<a href='javascript:void(0);' id='showOriginal'>Show the original coverage</a>&nbsp;&nbsp;|&nbsp;&nbsp;<a href='javascript:void(0);' id='showNew'>Show the revised coverage</a>&nbsp;&nbsp;|&nbsp;&nbsp;<a href='javascript:void(0);' id='showSourceDiff'>Show source differences</a>&nbsp;&nbsp;|&nbsp;&nbsp;<a href='javascript:void(0);' id='showAllChanges'>Show the combined changes</a></div>
<div id='mainContent'><div id='tableContent'>
<table id='originalCoverageTable' class='code'>
<tr>
 	<td class=''>1</td>
 	<td class=''><pre><span class="comment">/*</span></pre></td>
</tr>
<tr>
 	<td class=''>2</td>
 	<td class=''><pre><span class="comment"> * Licensed to the Apache Software Foundation (ASF) under one or more</span></pre></td>
</tr>
<tr>
 	<td class=''>3</td>
 	<td class=''><pre><span class="comment"> * contributor license agreements.  See the NOTICE file distributed with</span></pre></td>
</tr>
<tr>
 	<td class=''>4</td>
 	<td class=''><pre><span class="comment"> * this work for additional information regarding copyright ownership.</span></pre></td>
</tr>
<tr>
 	<td class=''>5</td>
 	<td class=''><pre><span class="comment"> * The ASF licenses this file to You under the Apache License, Version 2.0</span></pre></td>
</tr>
<tr>
 	<td class=''>6</td>
 	<td class=''><pre><span class="comment"> * (the "License"); you may not use this file except in compliance with</span></pre></td>
</tr>
<tr>
 	<td class=''>7</td>
 	<td class=''><pre><span class="comment"> * the License.  You may obtain a copy of the License at</span></pre></td>
</tr>
<tr>
 	<td class=''>8</td>
 	<td class=''><pre><span class="comment"> *</span></pre></td>
</tr>
<tr>
 	<td class=''>9</td>
 	<td class=''><pre><span class="comment"> *      http://www.apache.org/licenses/LICENSE-2.0</span></pre></td>
</tr>
<tr>
 	<td class=''>10</td>
 	<td class=''><pre><span class="comment"> *</span></pre></td>
</tr>
<tr>
 	<td class=''>11</td>
 	<td class=''><pre><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></pre></td>
</tr>
<tr>
 	<td class=''>12</td>
 	<td class=''><pre><span class="comment"> * distributed under the License is distributed on an "AS IS" BASIS,</span></pre></td>
</tr>
<tr>
 	<td class=''>13</td>
 	<td class=''><pre><span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></pre></td>
</tr>
<tr>
 	<td class=''>14</td>
 	<td class=''><pre><span class="comment"> * See the License for the specific language governing permissions and</span></pre></td>
</tr>
<tr>
 	<td class=''>15</td>
 	<td class=''><pre><span class="comment"> * limitations under the License.</span></pre></td>
</tr>
<tr>
 	<td class=''>16</td>
 	<td class=''><pre><span class="comment"> */</span></pre></td>
</tr>
<tr>
 	<td class=''>17</td>
 	<td class=''><pre><span class="keyword">package</span> org.apache.commons.text;</pre></td>
</tr>
<tr>
 	<td class=''>18</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>19</td>
 	<td class=''><pre><span class="keyword">import</span> java.text.Format;</pre></td>
</tr>
<tr>
 	<td class=''>20</td>
 	<td class=''><pre><span class="keyword">import</span> java.text.MessageFormat;</pre></td>
</tr>
<tr>
 	<td class=''>21</td>
 	<td class=''><pre><span class="keyword">import</span> java.text.ParsePosition;</pre></td>
</tr>
<tr>
 	<td class=''>22</td>
 	<td class=''><pre><span class="keyword">import</span> java.util.ArrayList;</pre></td>
</tr>
<tr>
 	<td class=''>23</td>
 	<td class=''><pre><span class="keyword">import</span> java.util.Collection;</pre></td>
</tr>
<tr>
 	<td class=''>24</td>
 	<td class=''><pre><span class="keyword">import</span> java.util.Iterator;</pre></td>
</tr>
<tr>
 	<td class=''>25</td>
 	<td class=''><pre><span class="keyword">import</span> java.util.Locale;</pre></td>
</tr>
<tr>
 	<td class=''>26</td>
 	<td class=''><pre><span class="keyword">import</span> java.util.Map;</pre></td>
</tr>
<tr>
 	<td class=''>27</td>
 	<td class=''><pre><span class="keyword">import</span> java.util.Objects;</pre></td>
</tr>
<tr>
 	<td class=''>28</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>29</td>
 	<td class=''><pre><span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>30</td>
 	<td class=''><pre><span class="comment"> * Extends &lt;code&gt;java.text.MessageFormat&lt;/code&gt; to allow pluggable/additional formatting</span></pre></td>
</tr>
<tr>
 	<td class=''>31</td>
 	<td class=''><pre><span class="comment"> * options for embedded format elements.  Client code should specify a registry</span></pre></td>
</tr>
<tr>
 	<td class=''>32</td>
 	<td class=''><pre><span class="comment"> * of &lt;code&gt;FormatFactory&lt;/code&gt; instances associated with &lt;code&gt;String&lt;/code&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>33</td>
 	<td class=''><pre><span class="comment"> * format names.  This registry will be consulted when the format elements are</span></pre></td>
</tr>
<tr>
 	<td class=''>34</td>
 	<td class=''><pre><span class="comment"> * parsed from the message pattern.  In this way custom patterns can be specified,</span></pre></td>
</tr>
<tr>
 	<td class=''>35</td>
 	<td class=''><pre><span class="comment"> * and the formats supported by &lt;code&gt;java.text.MessageFormat&lt;/code&gt; can be overridden</span></pre></td>
</tr>
<tr>
 	<td class=''>36</td>
 	<td class=''><pre><span class="comment"> * at the format and/or format style level (see MessageFormat).  A "format element"</span></pre></td>
</tr>
<tr>
 	<td class=''>37</td>
 	<td class=''><pre><span class="comment"> * embedded in the message pattern is specified (&lt;b&gt;()?&lt;/b&gt; signifies optionality):&lt;br&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>38</td>
 	<td class=''><pre><span class="comment"> * &lt;code&gt;{&lt;/code&gt;&lt;i&gt;argument-number&lt;/i&gt;&lt;b&gt;(&lt;/b&gt;&lt;code&gt;,&lt;/code&gt;&lt;i&gt;format-name&lt;/i&gt;&lt;b&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>39</td>
 	<td class=''><pre><span class="comment"> * (&lt;/b&gt;&lt;code&gt;,&lt;/code&gt;&lt;i&gt;format-style&lt;/i&gt;&lt;b&gt;)?)?&lt;/b&gt;&lt;code&gt;}&lt;/code&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>40</td>
 	<td class=''><pre><span class="comment"> *</span></pre></td>
</tr>
<tr>
 	<td class=''>41</td>
 	<td class=''><pre><span class="comment"> * &lt;p&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>42</td>
 	<td class=''><pre><span class="comment"> * &lt;i&gt;format-name&lt;/i&gt; and &lt;i&gt;format-style&lt;/i&gt; values are trimmed of surrounding whitespace</span></pre></td>
</tr>
<tr>
 	<td class=''>43</td>
 	<td class=''><pre><span class="comment"> * in the manner of &lt;code&gt;java.text.MessageFormat&lt;/code&gt;.  If &lt;i&gt;format-name&lt;/i&gt; denotes</span></pre></td>
</tr>
<tr>
 	<td class=''>44</td>
 	<td class=''><pre><span class="comment"> * &lt;code&gt;FormatFactory formatFactoryInstance&lt;/code&gt; in &lt;code&gt;registry&lt;/code&gt;, a &lt;code&gt;Format&lt;/code&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>45</td>
 	<td class=''><pre><span class="comment"> * matching &lt;i&gt;format-name&lt;/i&gt; and &lt;i&gt;format-style&lt;/i&gt; is requested from</span></pre></td>
</tr>
<tr>
 	<td class=''>46</td>
 	<td class=''><pre><span class="comment"> * &lt;code&gt;formatFactoryInstance&lt;/code&gt;.  If this is successful, the &lt;code&gt;Format&lt;/code&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>47</td>
 	<td class=''><pre><span class="comment"> * found is used for this format element.</span></pre></td>
</tr>
<tr>
 	<td class=''>48</td>
 	<td class=''><pre><span class="comment"> * &lt;/p&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>49</td>
 	<td class=''><pre><span class="comment"> *</span></pre></td>
</tr>
<tr>
 	<td class=''>50</td>
 	<td class=''><pre><span class="comment"> * &lt;p&gt;&lt;b&gt;NOTICE:&lt;/b&gt; The various subformat mutator methods are considered unnecessary; they exist on the parent</span></pre></td>
</tr>
<tr>
 	<td class=''>51</td>
 	<td class=''><pre><span class="comment"> * class to allow the type of customization which it is the job of this class to provide in</span></pre></td>
</tr>
<tr>
 	<td class=''>52</td>
 	<td class=''><pre><span class="comment"> * a configurable fashion.  These methods have thus been disabled and will throw</span></pre></td>
</tr>
<tr>
 	<td class=''>53</td>
 	<td class=''><pre><span class="comment"> * &lt;code&gt;UnsupportedOperationException&lt;/code&gt; if called.</span></pre></td>
</tr>
<tr>
 	<td class=''>54</td>
 	<td class=''><pre><span class="comment"> * &lt;/p&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>55</td>
 	<td class=''><pre><span class="comment"> *</span></pre></td>
</tr>
<tr>
 	<td class=''>56</td>
 	<td class=''><pre><span class="comment"> * &lt;p&gt;Limitations inherited from &lt;code&gt;java.text.MessageFormat&lt;/code&gt;:&lt;/p&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>57</td>
 	<td class=''><pre><span class="comment"> * &lt;ul&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>58</td>
 	<td class=''><pre><span class="comment"> * &lt;li&gt;When using "choice" subformats, support for nested formatting instructions is limited</span></pre></td>
</tr>
<tr>
 	<td class=''>59</td>
 	<td class=''><pre><span class="comment"> *     to that provided by the base class.&lt;/li&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>60</td>
 	<td class=''><pre><span class="comment"> * &lt;li&gt;Thread-safety of &lt;code&gt;Format&lt;/code&gt;s, including &lt;code&gt;MessageFormat&lt;/code&gt; and thus</span></pre></td>
</tr>
<tr>
 	<td class=''>61</td>
 	<td class=''><pre><span class="comment"> *     &lt;code&gt;ExtendedMessageFormat&lt;/code&gt;, is not guaranteed.&lt;/li&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>62</td>
 	<td class=''><pre><span class="comment"> * &lt;/ul&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>63</td>
 	<td class=''><pre><span class="comment"> *</span></pre></td>
</tr>
<tr>
 	<td class=''>64</td>
 	<td class=''><pre><span class="comment"> * @since 1.0</span></pre></td>
</tr>
<tr>
 	<td class=''>65</td>
 	<td class=''><pre><span class="comment"> */</span></pre></td>
</tr>
<tr>
 	<td class='coveredLight'>66</td>
 	<td class='coveredLight'><pre><span class="keyword">public</span> <span class="keyword">class</span> ExtendedMessageFormat <span class="keyword">extends</span> MessageFormat {</pre></td>
</tr>
<tr>
 	<td class=''>67</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>68</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>69</td>
 	<td class=''><pre><span class="comment">     * Serializable Object.</span></pre></td>
</tr>
<tr>
 	<td class=''>70</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>71</td>
 	<td class=''><pre>    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -2362048321261811743L;</pre></td>
</tr>
<tr>
 	<td class=''>72</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>73</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>74</td>
 	<td class=''><pre><span class="comment">     * Our initial seed value for calculating hashes.</span></pre></td>
</tr>
<tr>
 	<td class=''>75</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>76</td>
 	<td class=''><pre>    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> HASH_SEED = 31;</pre></td>
</tr>
<tr>
 	<td class=''>77</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>78</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>79</td>
 	<td class=''><pre><span class="comment">     * The empty string.</span></pre></td>
</tr>
<tr>
 	<td class=''>80</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>81</td>
 	<td class=''><pre>    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DUMMY_PATTERN = <span class="string">""</span>;</pre></td>
</tr>
<tr>
 	<td class=''>82</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>83</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>84</td>
 	<td class=''><pre><span class="comment">     * A comma.</span></pre></td>
</tr>
<tr>
 	<td class=''>85</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>86</td>
 	<td class=''><pre>    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span> START_FMT = <span class="string">','</span>;</pre></td>
</tr>
<tr>
 	<td class=''>87</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>88</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>89</td>
 	<td class=''><pre><span class="comment">     * A right side squigly brace.</span></pre></td>
</tr>
<tr>
 	<td class=''>90</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>91</td>
 	<td class=''><pre>    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span> END_FE = <span class="string">'}'</span>;</pre></td>
</tr>
<tr>
 	<td class=''>92</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>93</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>94</td>
 	<td class=''><pre><span class="comment">     * A left side squigly brace.</span></pre></td>
</tr>
<tr>
 	<td class=''>95</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>96</td>
 	<td class=''><pre>    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span> START_FE = <span class="string">'{'</span>;</pre></td>
</tr>
<tr>
 	<td class=''>97</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>98</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>99</td>
 	<td class=''><pre><span class="comment">     * A properly escaped character representing a single quote.</span></pre></td>
</tr>
<tr>
 	<td class=''>100</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>101</td>
 	<td class=''><pre>    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span> QUOTE = <span class="string">'\''</span>;</pre></td>
</tr>
<tr>
 	<td class=''>102</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>103</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>104</td>
 	<td class=''><pre><span class="comment">     * To pattern string.</span></pre></td>
</tr>
<tr>
 	<td class=''>105</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>106</td>
 	<td class=''><pre>    <span class="keyword">private</span> String toPattern;</pre></td>
</tr>
<tr>
 	<td class=''>107</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>108</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>109</td>
 	<td class=''><pre><span class="comment">     * Our registry of FormatFactory's.</span></pre></td>
</tr>
<tr>
 	<td class=''>110</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>111</td>
 	<td class=''><pre>    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, ? <span class="keyword">extends</span> FormatFactory&gt; registry;</pre></td>
</tr>
<tr>
 	<td class=''>112</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>113</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>114</td>
 	<td class=''><pre><span class="comment">     * Create a new ExtendedMessageFormat for the default locale.</span></pre></td>
</tr>
<tr>
 	<td class=''>115</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>116</td>
 	<td class=''><pre><span class="comment">     * @param pattern  the pattern to use, not null</span></pre></td>
</tr>
<tr>
 	<td class=''>117</td>
 	<td class=''><pre><span class="comment">     * @throws IllegalArgumentException in case of a bad pattern.</span></pre></td>
</tr>
<tr>
 	<td class=''>118</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>119</td>
 	<td class=''><pre>    <span class="keyword">public</span> ExtendedMessageFormat(<span class="keyword">final</span> String pattern) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>120</td>
 	<td class='coveredLight'><pre>        <span class="keyword">this</span>(pattern, Locale.getDefault());</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>121</td>
 	<td class='coveredLight'><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>122</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>123</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>124</td>
 	<td class=''><pre><span class="comment">     * Create a new ExtendedMessageFormat.</span></pre></td>
</tr>
<tr>
 	<td class=''>125</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>126</td>
 	<td class=''><pre><span class="comment">     * @param pattern  the pattern to use, not null</span></pre></td>
</tr>
<tr>
 	<td class=''>127</td>
 	<td class=''><pre><span class="comment">     * @param locale  the locale to use, not null</span></pre></td>
</tr>
<tr>
 	<td class=''>128</td>
 	<td class=''><pre><span class="comment">     * @throws IllegalArgumentException in case of a bad pattern.</span></pre></td>
</tr>
<tr>
 	<td class=''>129</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>130</td>
 	<td class=''><pre>    <span class="keyword">public</span> ExtendedMessageFormat(<span class="keyword">final</span> String pattern, <span class="keyword">final</span> Locale locale) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>131</td>
 	<td class='coveredLight'><pre>        <span class="keyword">this</span>(pattern, locale, <span class="keyword">null</span>);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>132</td>
 	<td class='coveredLight'><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>133</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>134</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>135</td>
 	<td class=''><pre><span class="comment">     * Create a new ExtendedMessageFormat for the default locale.</span></pre></td>
</tr>
<tr>
 	<td class=''>136</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>137</td>
 	<td class=''><pre><span class="comment">     * @param pattern  the pattern to use, not null</span></pre></td>
</tr>
<tr>
 	<td class=''>138</td>
 	<td class=''><pre><span class="comment">     * @param registry  the registry of format factories, may be null</span></pre></td>
</tr>
<tr>
 	<td class=''>139</td>
 	<td class=''><pre><span class="comment">     * @throws IllegalArgumentException in case of a bad pattern.</span></pre></td>
</tr>
<tr>
 	<td class=''>140</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>141</td>
 	<td class=''><pre>    <span class="keyword">public</span> ExtendedMessageFormat(<span class="keyword">final</span> String pattern,</pre></td>
</tr>
<tr>
 	<td class=''>142</td>
 	<td class=''><pre>                                 <span class="keyword">final</span> Map&lt;String, ? <span class="keyword">extends</span> FormatFactory&gt; registry) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>143</td>
 	<td class='coveredLight'><pre>        <span class="keyword">this</span>(pattern, Locale.getDefault(), registry);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>144</td>
 	<td class='coveredLight'><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>145</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>146</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>147</td>
 	<td class=''><pre><span class="comment">     * Create a new ExtendedMessageFormat.</span></pre></td>
</tr>
<tr>
 	<td class=''>148</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>149</td>
 	<td class=''><pre><span class="comment">     * @param pattern  the pattern to use, not null</span></pre></td>
</tr>
<tr>
 	<td class=''>150</td>
 	<td class=''><pre><span class="comment">     * @param locale  the locale to use, not null</span></pre></td>
</tr>
<tr>
 	<td class=''>151</td>
 	<td class=''><pre><span class="comment">     * @param registry  the registry of format factories, may be null</span></pre></td>
</tr>
<tr>
 	<td class=''>152</td>
 	<td class=''><pre><span class="comment">     * @throws IllegalArgumentException in case of a bad pattern.</span></pre></td>
</tr>
<tr>
 	<td class=''>153</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>154</td>
 	<td class=''><pre>    <span class="keyword">public</span> ExtendedMessageFormat(<span class="keyword">final</span> String pattern,</pre></td>
</tr>
<tr>
 	<td class=''>155</td>
 	<td class=''><pre>                                 <span class="keyword">final</span> Locale locale,</pre></td>
</tr>
<tr>
 	<td class=''>156</td>
 	<td class=''><pre>                                 <span class="keyword">final</span> Map&lt;String, ? <span class="keyword">extends</span> FormatFactory&gt; registry) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>157</td>
 	<td class='coveredLight'><pre>        <span class="keyword">super</span>(DUMMY_PATTERN);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>158</td>
 	<td class='coveredLight'><pre>        setLocale(locale);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>159</td>
 	<td class='coveredLight'><pre>        <span class="keyword">this</span>.registry = registry;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>160</td>
 	<td class='coveredLight'><pre>        applyPattern(pattern);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>161</td>
 	<td class='coveredLight'><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>162</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>163</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>164</td>
 	<td class=''><pre><span class="comment">     * {@inheritDoc}</span></pre></td>
</tr>
<tr>
 	<td class=''>165</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>166</td>
 	<td class=''><pre>    @Override</pre></td>
</tr>
<tr>
 	<td class=''>167</td>
 	<td class=''><pre>    <span class="keyword">public</span> String toPattern() {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>168</td>
 	<td class='coveredLight'><pre>        <span class="keyword">return</span> toPattern;</pre></td>
</tr>
<tr>
 	<td class=''>169</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>170</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>171</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>172</td>
 	<td class=''><pre><span class="comment">     * Apply the specified pattern.</span></pre></td>
</tr>
<tr>
 	<td class=''>173</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>174</td>
 	<td class=''><pre><span class="comment">     * @param pattern String</span></pre></td>
</tr>
<tr>
 	<td class=''>175</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>176</td>
 	<td class=''><pre>    @Override</pre></td>
</tr>
<tr>
 	<td class=''>177</td>
 	<td class=''><pre>    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> applyPattern(<span class="keyword">final</span> String pattern) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>178</td>
 	<td class='coveredLight'><pre>        <span class="keyword">if</span> (registry == <span class="keyword">null</span>) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>179</td>
 	<td class='coveredLight'><pre>            <span class="keyword">super</span>.applyPattern(pattern);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>180</td>
 	<td class='coveredLight'><pre>            toPattern = <span class="keyword">super</span>.toPattern();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>181</td>
 	<td class='coveredLight'><pre>            <span class="keyword">return</span>;</pre></td>
</tr>
<tr>
 	<td class=''>182</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>183</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> ArrayList&lt;Format&gt; foundFormats = <span class="keyword">new</span> ArrayList&lt;&gt;();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>184</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> ArrayList&lt;String&gt; foundDescriptions = <span class="keyword">new</span> ArrayList&lt;&gt;();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>185</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> StringBuilder stripCustom = <span class="keyword">new</span> StringBuilder(pattern.length());</pre></td>
</tr>
<tr>
 	<td class=''>186</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class='coveredLight'>187</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> ParsePosition pos = <span class="keyword">new</span> ParsePosition(0);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>188</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> <span class="keyword">char</span>[] c = pattern.toCharArray();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>189</td>
 	<td class='coveredLight'><pre>        <span class="keyword">int</span> fmtCount = 0;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>190</td>
 	<td class='coveredLight'><pre>        <span class="keyword">while</span> (pos.getIndex() &lt; pattern.length()) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>191</td>
 	<td class='coveredLight'><pre>            <span class="keyword">switch</span> (c[pos.getIndex()]) {</pre></td>
</tr>
<tr>
 	<td class=''>192</td>
 	<td class=''><pre>            <span class="keyword">case</span> QUOTE:</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>193</td>
 	<td class='coveredLight'><pre>                appendQuotedString(pattern, pos, stripCustom);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>194</td>
 	<td class='coveredLight'><pre>                <span class="keyword">break</span>;</pre></td>
</tr>
<tr>
 	<td class=''>195</td>
 	<td class=''><pre>            <span class="keyword">case</span> START_FE:</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>196</td>
 	<td class='coveredLight'><pre>                fmtCount++;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>197</td>
 	<td class='coveredLight'><pre>                seekNonWs(pattern, pos);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>198</td>
 	<td class='coveredLight'><pre>                <span class="keyword">final</span> <span class="keyword">int</span> start = pos.getIndex();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>199</td>
 	<td class='coveredLight'><pre>                <span class="keyword">final</span> <span class="keyword">int</span> index = readArgumentIndex(pattern, next(pos));</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>200</td>
 	<td class='coveredLight'><pre>                stripCustom.append(START_FE).append(index);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>201</td>
 	<td class='coveredLight'><pre>                seekNonWs(pattern, pos);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>202</td>
 	<td class='coveredLight'><pre>                Format format = <span class="keyword">null</span>;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>203</td>
 	<td class='coveredLight'><pre>                String formatDescription = <span class="keyword">null</span>;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>204</td>
 	<td class='coveredLight'><pre>                <span class="keyword">if</span> (c[pos.getIndex()] == START_FMT) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>205</td>
 	<td class='coveredLight'><pre>                    formatDescription = parseFormatDescription(pattern,</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>206</td>
 	<td class='coveredLight'><pre>                            next(pos));</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>207</td>
 	<td class='coveredLight'><pre>                    format = getFormat(formatDescription);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>208</td>
 	<td class='coveredLight'><pre>                    <span class="keyword">if</span> (format == <span class="keyword">null</span>) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>209</td>
 	<td class='coveredLight'><pre>                        stripCustom.append(START_FMT).append(formatDescription);</pre></td>
</tr>
<tr>
 	<td class=''>210</td>
 	<td class=''><pre>                    }</pre></td>
</tr>
<tr>
 	<td class=''>211</td>
 	<td class=''><pre>                }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>212</td>
 	<td class='coveredLight'><pre>                foundFormats.add(format);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>213</td>
 	<td class='coveredLight'><pre>                foundDescriptions.add(format == <span class="keyword">null</span> ? <span class="keyword">null</span> : formatDescription);</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>214</td>
 	<td class='notCoveredLight'><pre>                <span class="keyword">if</span> (foundFormats.size() != fmtCount) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>215</td>
 	<td class='notCoveredLight'><pre>                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"The validated expression is false"</span>);</pre></td>
</tr>
<tr>
 	<td class=''>216</td>
 	<td class=''><pre>                }</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>217</td>
 	<td class='notCoveredLight'><pre>                <span class="keyword">if</span> (foundDescriptions.size() != fmtCount) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>218</td>
 	<td class='notCoveredLight'><pre>                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"The validated expression is false"</span>);</pre></td>
</tr>
<tr>
 	<td class=''>219</td>
 	<td class=''><pre>                }</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>220</td>
 	<td class='notCoveredLight'><pre>                <span class="keyword">if</span> (c[pos.getIndex()] != END_FE) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>221</td>
 	<td class='notCoveredLight'><pre>                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</pre></td>
</tr>
<tr>
 	<td class=''>222</td>
 	<td class=''><pre>                            <span class="string">"Unreadable format element at position "</span> + start);</pre></td>
</tr>
<tr>
 	<td class=''>223</td>
 	<td class=''><pre>                }</pre></td>
</tr>
<tr>
 	<td class=''>224</td>
 	<td class=''><pre>                <span class="comment">//$FALL-THROUGH$</span></pre></td>
</tr>
<tr>
 	<td class=''>225</td>
 	<td class=''><pre>            <span class="keyword">default</span>:</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>226</td>
 	<td class='coveredLight'><pre>                stripCustom.append(c[pos.getIndex()]);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>227</td>
 	<td class='coveredLight'><pre>                next(pos);</pre></td>
</tr>
<tr>
 	<td class=''>228</td>
 	<td class=''><pre>            }</pre></td>
</tr>
<tr>
 	<td class=''>229</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>230</td>
 	<td class='coveredLight'><pre>        <span class="keyword">super</span>.applyPattern(stripCustom.toString());</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>231</td>
 	<td class='coveredLight'><pre>        toPattern = insertFormats(<span class="keyword">super</span>.toPattern(), foundDescriptions);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>232</td>
 	<td class='coveredLight'><pre>        <span class="keyword">if</span> (containsElements(foundFormats)) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>233</td>
 	<td class='coveredLight'><pre>            <span class="keyword">final</span> Format[] origFormats = getFormats();</pre></td>
</tr>
<tr>
 	<td class=''>234</td>
 	<td class=''><pre>            <span class="comment">// only loop over what we know we have, as MessageFormat on Java 1.3</span></pre></td>
</tr>
<tr>
 	<td class=''>235</td>
 	<td class=''><pre>            <span class="comment">// seems to provide an extra format element:</span></pre></td>
</tr>
<tr>
 	<td class='coveredLight'>236</td>
 	<td class='coveredLight'><pre>            <span class="keyword">int</span> i = 0;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>237</td>
 	<td class='coveredLight'><pre>            <span class="keyword">for</span> (<span class="keyword">final</span> Iterator&lt;Format&gt; it = foundFormats.iterator(); it.hasNext(); i++) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>238</td>
 	<td class='coveredLight'><pre>                <span class="keyword">final</span> Format f = it.next();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>239</td>
 	<td class='coveredLight'><pre>                <span class="keyword">if</span> (f != <span class="keyword">null</span>) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>240</td>
 	<td class='coveredLight'><pre>                    origFormats[i] = f;</pre></td>
</tr>
<tr>
 	<td class=''>241</td>
 	<td class=''><pre>                }</pre></td>
</tr>
<tr>
 	<td class=''>242</td>
 	<td class=''><pre>            }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>243</td>
 	<td class='coveredLight'><pre>            <span class="keyword">super</span>.setFormats(origFormats);</pre></td>
</tr>
<tr>
 	<td class=''>244</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>245</td>
 	<td class='coveredLight'><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>246</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>247</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>248</td>
 	<td class=''><pre><span class="comment">     * Throws UnsupportedOperationException - see class Javadoc for details.</span></pre></td>
</tr>
<tr>
 	<td class=''>249</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>250</td>
 	<td class=''><pre><span class="comment">     * @param formatElementIndex format element index</span></pre></td>
</tr>
<tr>
 	<td class=''>251</td>
 	<td class=''><pre><span class="comment">     * @param newFormat the new format</span></pre></td>
</tr>
<tr>
 	<td class=''>252</td>
 	<td class=''><pre><span class="comment">     * @throws UnsupportedOperationException always thrown since this isn't</span></pre></td>
</tr>
<tr>
 	<td class=''>253</td>
 	<td class=''><pre><span class="comment">     *                                       supported by ExtendMessageFormat</span></pre></td>
</tr>
<tr>
 	<td class=''>254</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>255</td>
 	<td class=''><pre>    @Override</pre></td>
</tr>
<tr>
 	<td class=''>256</td>
 	<td class=''><pre>    <span class="keyword">public</span> <span class="keyword">void</span> setFormat(<span class="keyword">final</span> <span class="keyword">int</span> formatElementIndex, <span class="keyword">final</span> Format newFormat) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>257</td>
 	<td class='coveredLight'><pre>        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</pre></td>
</tr>
<tr>
 	<td class=''>258</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>259</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>260</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>261</td>
 	<td class=''><pre><span class="comment">     * Throws UnsupportedOperationException - see class Javadoc for details.</span></pre></td>
</tr>
<tr>
 	<td class=''>262</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>263</td>
 	<td class=''><pre><span class="comment">     * @param argumentIndex argument index</span></pre></td>
</tr>
<tr>
 	<td class=''>264</td>
 	<td class=''><pre><span class="comment">     * @param newFormat the new format</span></pre></td>
</tr>
<tr>
 	<td class=''>265</td>
 	<td class=''><pre><span class="comment">     * @throws UnsupportedOperationException always thrown since this isn't</span></pre></td>
</tr>
<tr>
 	<td class=''>266</td>
 	<td class=''><pre><span class="comment">     *                                       supported by ExtendMessageFormat</span></pre></td>
</tr>
<tr>
 	<td class=''>267</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>268</td>
 	<td class=''><pre>    @Override</pre></td>
</tr>
<tr>
 	<td class=''>269</td>
 	<td class=''><pre>    <span class="keyword">public</span> <span class="keyword">void</span> setFormatByArgumentIndex(<span class="keyword">final</span> <span class="keyword">int</span> argumentIndex,</pre></td>
</tr>
<tr>
 	<td class=''>270</td>
 	<td class=''><pre>                                         <span class="keyword">final</span> Format newFormat) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>271</td>
 	<td class='coveredLight'><pre>        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</pre></td>
</tr>
<tr>
 	<td class=''>272</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>273</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>274</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>275</td>
 	<td class=''><pre><span class="comment">     * Throws UnsupportedOperationException - see class Javadoc for details.</span></pre></td>
</tr>
<tr>
 	<td class=''>276</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>277</td>
 	<td class=''><pre><span class="comment">     * @param newFormats new formats</span></pre></td>
</tr>
<tr>
 	<td class=''>278</td>
 	<td class=''><pre><span class="comment">     * @throws UnsupportedOperationException always thrown since this isn't</span></pre></td>
</tr>
<tr>
 	<td class=''>279</td>
 	<td class=''><pre><span class="comment">     *                                       supported by ExtendMessageFormat</span></pre></td>
</tr>
<tr>
 	<td class=''>280</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>281</td>
 	<td class=''><pre>    @Override</pre></td>
</tr>
<tr>
 	<td class=''>282</td>
 	<td class=''><pre>    <span class="keyword">public</span> <span class="keyword">void</span> setFormats(<span class="keyword">final</span> Format[] newFormats) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>283</td>
 	<td class='coveredLight'><pre>        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</pre></td>
</tr>
<tr>
 	<td class=''>284</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>285</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>286</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>287</td>
 	<td class=''><pre><span class="comment">     * Throws UnsupportedOperationException - see class Javadoc for details.</span></pre></td>
</tr>
<tr>
 	<td class=''>288</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>289</td>
 	<td class=''><pre><span class="comment">     * @param newFormats new formats</span></pre></td>
</tr>
<tr>
 	<td class=''>290</td>
 	<td class=''><pre><span class="comment">     * @throws UnsupportedOperationException always thrown since this isn't</span></pre></td>
</tr>
<tr>
 	<td class=''>291</td>
 	<td class=''><pre><span class="comment">     *                                       supported by ExtendMessageFormat</span></pre></td>
</tr>
<tr>
 	<td class=''>292</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>293</td>
 	<td class=''><pre>    @Override</pre></td>
</tr>
<tr>
 	<td class=''>294</td>
 	<td class=''><pre>    <span class="keyword">public</span> <span class="keyword">void</span> setFormatsByArgumentIndex(<span class="keyword">final</span> Format[] newFormats) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>295</td>
 	<td class='coveredLight'><pre>        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</pre></td>
</tr>
<tr>
 	<td class=''>296</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>297</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>298</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>299</td>
 	<td class=''><pre><span class="comment">     * Check if this extended message format is equal to another object.</span></pre></td>
</tr>
<tr>
 	<td class=''>300</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>301</td>
 	<td class=''><pre><span class="comment">     * @param obj the object to compare to</span></pre></td>
</tr>
<tr>
 	<td class=''>302</td>
 	<td class=''><pre><span class="comment">     * @return true if this object equals the other, otherwise false</span></pre></td>
</tr>
<tr>
 	<td class=''>303</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>304</td>
 	<td class=''><pre>    @Override</pre></td>
</tr>
<tr>
 	<td class=''>305</td>
 	<td class=''><pre>    <span class="keyword">public</span> <span class="keyword">boolean</span> equals(<span class="keyword">final</span> Object obj) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>306</td>
 	<td class='coveredLight'><pre>        <span class="keyword">if</span> (obj == <span class="keyword">this</span>) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>307</td>
 	<td class='coveredLight'><pre>            <span class="keyword">return</span> <span class="keyword">true</span>;</pre></td>
</tr>
<tr>
 	<td class=''>308</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>309</td>
 	<td class='coveredLight'><pre>        <span class="keyword">if</span> (obj == <span class="keyword">null</span>) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>310</td>
 	<td class='coveredLight'><pre>            <span class="keyword">return</span> <span class="keyword">false</span>;</pre></td>
</tr>
<tr>
 	<td class=''>311</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>312</td>
 	<td class='coveredLight'><pre>        <span class="keyword">if</span> (!<span class="keyword">super</span>.equals(obj)) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>313</td>
 	<td class='coveredLight'><pre>            <span class="keyword">return</span> <span class="keyword">false</span>;</pre></td>
</tr>
<tr>
 	<td class=''>314</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>315</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">if</span> (!Objects.equals(getClass(), obj.getClass())) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>316</td>
 	<td class='notCoveredLight'><pre>          <span class="keyword">return</span> <span class="keyword">false</span>;</pre></td>
</tr>
<tr>
 	<td class=''>317</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>318</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> ExtendedMessageFormat rhs = (ExtendedMessageFormat) obj;</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>319</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">if</span> (!Objects.equals(toPattern, rhs.toPattern)) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>320</td>
 	<td class='notCoveredLight'><pre>            <span class="keyword">return</span> <span class="keyword">false</span>;</pre></td>
</tr>
<tr>
 	<td class=''>321</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>322</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">if</span> (!Objects.equals(registry, rhs.registry)) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>323</td>
 	<td class='notCoveredLight'><pre>            <span class="keyword">return</span> <span class="keyword">false</span>;</pre></td>
</tr>
<tr>
 	<td class=''>324</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>325</td>
 	<td class='coveredLight'><pre>        <span class="keyword">return</span> <span class="keyword">true</span>;</pre></td>
</tr>
<tr>
 	<td class=''>326</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>327</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>328</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>329</td>
 	<td class=''><pre><span class="comment">     * {@inheritDoc}</span></pre></td>
</tr>
<tr>
 	<td class=''>330</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>331</td>
 	<td class=''><pre>    @Override</pre></td>
</tr>
<tr>
 	<td class=''>332</td>
 	<td class=''><pre>    <span class="keyword">public</span> <span class="keyword">int</span> hashCode() {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>333</td>
 	<td class='coveredLight'><pre>        <span class="keyword">int</span> result = <span class="keyword">super</span>.hashCode();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>334</td>
 	<td class='coveredLight'><pre>        result = HASH_SEED * result + Objects.hashCode(registry);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>335</td>
 	<td class='coveredLight'><pre>        result = HASH_SEED * result + Objects.hashCode(toPattern);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>336</td>
 	<td class='coveredLight'><pre>        <span class="keyword">return</span> result;</pre></td>
</tr>
<tr>
 	<td class=''>337</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>338</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>339</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>340</td>
 	<td class=''><pre><span class="comment">     * Get a custom format from a format description.</span></pre></td>
</tr>
<tr>
 	<td class=''>341</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>342</td>
 	<td class=''><pre><span class="comment">     * @param desc String</span></pre></td>
</tr>
<tr>
 	<td class=''>343</td>
 	<td class=''><pre><span class="comment">     * @return Format</span></pre></td>
</tr>
<tr>
 	<td class=''>344</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>345</td>
 	<td class=''><pre>    <span class="keyword">private</span> Format getFormat(<span class="keyword">final</span> String desc) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>346</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">if</span> (registry != <span class="keyword">null</span>) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>347</td>
 	<td class='coveredLight'><pre>            String name = desc;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>348</td>
 	<td class='coveredLight'><pre>            String args = <span class="keyword">null</span>;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>349</td>
 	<td class='coveredLight'><pre>            <span class="keyword">final</span> <span class="keyword">int</span> i = desc.indexOf(START_FMT);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>350</td>
 	<td class='coveredLight'><pre>            <span class="keyword">if</span> (i &gt; 0) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>351</td>
 	<td class='coveredLight'><pre>                name = desc.substring(0, i).trim();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>352</td>
 	<td class='coveredLight'><pre>                args = desc.substring(i + 1).trim();</pre></td>
</tr>
<tr>
 	<td class=''>353</td>
 	<td class=''><pre>            }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>354</td>
 	<td class='coveredLight'><pre>            <span class="keyword">final</span> FormatFactory factory = registry.get(name);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>355</td>
 	<td class='coveredLight'><pre>            <span class="keyword">if</span> (factory != <span class="keyword">null</span>) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>356</td>
 	<td class='coveredLight'><pre>                <span class="keyword">return</span> factory.getFormat(name, args, getLocale());</pre></td>
</tr>
<tr>
 	<td class=''>357</td>
 	<td class=''><pre>            }</pre></td>
</tr>
<tr>
 	<td class=''>358</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>359</td>
 	<td class='coveredLight'><pre>        <span class="keyword">return</span> <span class="keyword">null</span>;</pre></td>
</tr>
<tr>
 	<td class=''>360</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>361</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>362</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>363</td>
 	<td class=''><pre><span class="comment">     * Read the argument index from the current format element.</span></pre></td>
</tr>
<tr>
 	<td class=''>364</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>365</td>
 	<td class=''><pre><span class="comment">     * @param pattern pattern to parse</span></pre></td>
</tr>
<tr>
 	<td class=''>366</td>
 	<td class=''><pre><span class="comment">     * @param pos current parse position</span></pre></td>
</tr>
<tr>
 	<td class=''>367</td>
 	<td class=''><pre><span class="comment">     * @return argument index</span></pre></td>
</tr>
<tr>
 	<td class=''>368</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>369</td>
 	<td class=''><pre>    <span class="keyword">private</span> <span class="keyword">int</span> readArgumentIndex(<span class="keyword">final</span> String pattern, <span class="keyword">final</span> ParsePosition pos) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>370</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> <span class="keyword">int</span> start = pos.getIndex();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>371</td>
 	<td class='coveredLight'><pre>        seekNonWs(pattern, pos);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>372</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> StringBuilder result = <span class="keyword">new</span> StringBuilder();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>373</td>
 	<td class='coveredLight'><pre>        <span class="keyword">boolean</span> error = <span class="keyword">false</span>;</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>374</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">for</span> (; !error &amp;&amp; pos.getIndex() &lt; pattern.length(); next(pos)) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>375</td>
 	<td class='coveredLight'><pre>            <span class="keyword">char</span> c = pattern.charAt(pos.getIndex());</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>376</td>
 	<td class='notCoveredLight'><pre>            <span class="keyword">if</span> (Character.isWhitespace(c)) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>377</td>
 	<td class='notCoveredLight'><pre>                seekNonWs(pattern, pos);</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>378</td>
 	<td class='notCoveredLight'><pre>                c = pattern.charAt(pos.getIndex());</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>379</td>
 	<td class='notCoveredLight'><pre>                <span class="keyword">if</span> (c != START_FMT &amp;&amp; c != END_FE) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>380</td>
 	<td class='notCoveredLight'><pre>                    error = <span class="keyword">true</span>;</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>381</td>
 	<td class='notCoveredLight'><pre>                    <span class="keyword">continue</span>;</pre></td>
</tr>
<tr>
 	<td class=''>382</td>
 	<td class=''><pre>                }</pre></td>
</tr>
<tr>
 	<td class=''>383</td>
 	<td class=''><pre>            }</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>384</td>
 	<td class='notCoveredLight'><pre>            <span class="keyword">if</span> ((c == START_FMT || c == END_FE) &amp;&amp; result.length() &gt; 0) {</pre></td>
</tr>
<tr>
 	<td class=''>385</td>
 	<td class=''><pre>                <span class="keyword">try</span> {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>386</td>
 	<td class='coveredLight'><pre>                    <span class="keyword">return</span> Integer.parseInt(result.toString());</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>387</td>
 	<td class='notCoveredLight'><pre>                } <span class="keyword">catch</span> (<span class="keyword">final</span> NumberFormatException e) { <span class="comment">// NOPMD</span></pre></td>
</tr>
<tr>
 	<td class=''>388</td>
 	<td class=''><pre>                    <span class="comment">// we've already ensured only digits, so unless something</span></pre></td>
</tr>
<tr>
 	<td class=''>389</td>
 	<td class=''><pre>                    <span class="comment">// outlandishly large was specified we should be okay.</span></pre></td>
</tr>
<tr>
 	<td class=''>390</td>
 	<td class=''><pre>                }</pre></td>
</tr>
<tr>
 	<td class=''>391</td>
 	<td class=''><pre>            }</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>392</td>
 	<td class='notCoveredLight'><pre>            error = !Character.isDigit(c);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>393</td>
 	<td class='coveredLight'><pre>            result.append(c);</pre></td>
</tr>
<tr>
 	<td class=''>394</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>395</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">if</span> (error) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>396</td>
 	<td class='notCoveredLight'><pre>            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</pre></td>
</tr>
<tr>
 	<td class=''>397</td>
 	<td class=''><pre>                    <span class="string">"Invalid format argument index at position "</span> + start + <span class="string">": "</span></pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>398</td>
 	<td class='notCoveredLight'><pre>                            + pattern.substring(start, pos.getIndex()));</pre></td>
</tr>
<tr>
 	<td class=''>399</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>400</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</pre></td>
</tr>
<tr>
 	<td class=''>401</td>
 	<td class=''><pre>                <span class="string">"Unterminated format element at position "</span> + start);</pre></td>
</tr>
<tr>
 	<td class=''>402</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>403</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>404</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>405</td>
 	<td class=''><pre><span class="comment">     * Parse the format component of a format element.</span></pre></td>
</tr>
<tr>
 	<td class=''>406</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>407</td>
 	<td class=''><pre><span class="comment">     * @param pattern string to parse</span></pre></td>
</tr>
<tr>
 	<td class=''>408</td>
 	<td class=''><pre><span class="comment">     * @param pos current parse position</span></pre></td>
</tr>
<tr>
 	<td class=''>409</td>
 	<td class=''><pre><span class="comment">     * @return Format description String</span></pre></td>
</tr>
<tr>
 	<td class=''>410</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>411</td>
 	<td class=''><pre>    <span class="keyword">private</span> String parseFormatDescription(<span class="keyword">final</span> String pattern, <span class="keyword">final</span> ParsePosition pos) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>412</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> <span class="keyword">int</span> start = pos.getIndex();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>413</td>
 	<td class='coveredLight'><pre>        seekNonWs(pattern, pos);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>414</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> <span class="keyword">int</span> text = pos.getIndex();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>415</td>
 	<td class='coveredLight'><pre>        <span class="keyword">int</span> depth = 1;</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>416</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">for</span> (; pos.getIndex() &lt; pattern.length(); next(pos)) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>417</td>
 	<td class='notCoveredLight'><pre>            <span class="keyword">switch</span> (pattern.charAt(pos.getIndex())) {</pre></td>
</tr>
<tr>
 	<td class=''>418</td>
 	<td class=''><pre>            <span class="keyword">case</span> START_FE:</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>419</td>
 	<td class='coveredLight'><pre>                depth++;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>420</td>
 	<td class='coveredLight'><pre>                <span class="keyword">break</span>;</pre></td>
</tr>
<tr>
 	<td class=''>421</td>
 	<td class=''><pre>            <span class="keyword">case</span> END_FE:</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>422</td>
 	<td class='coveredLight'><pre>                depth--;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>423</td>
 	<td class='coveredLight'><pre>                <span class="keyword">if</span> (depth == 0) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>424</td>
 	<td class='coveredLight'><pre>                    <span class="keyword">return</span> pattern.substring(text, pos.getIndex());</pre></td>
</tr>
<tr>
 	<td class=''>425</td>
 	<td class=''><pre>                }</pre></td>
</tr>
<tr>
 	<td class=''>426</td>
 	<td class=''><pre>                <span class="keyword">break</span>;</pre></td>
</tr>
<tr>
 	<td class=''>427</td>
 	<td class=''><pre>            <span class="keyword">case</span> QUOTE:</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>428</td>
 	<td class='notCoveredLight'><pre>                getQuotedString(pattern, pos);</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>429</td>
 	<td class='notCoveredLight'><pre>                <span class="keyword">break</span>;</pre></td>
</tr>
<tr>
 	<td class=''>430</td>
 	<td class=''><pre>            <span class="keyword">default</span>:</pre></td>
</tr>
<tr>
 	<td class=''>431</td>
 	<td class=''><pre>                <span class="keyword">break</span>;</pre></td>
</tr>
<tr>
 	<td class=''>432</td>
 	<td class=''><pre>            }</pre></td>
</tr>
<tr>
 	<td class=''>433</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>434</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</pre></td>
</tr>
<tr>
 	<td class=''>435</td>
 	<td class=''><pre>                <span class="string">"Unterminated format element at position "</span> + start);</pre></td>
</tr>
<tr>
 	<td class=''>436</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>437</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>438</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>439</td>
 	<td class=''><pre><span class="comment">     * Insert formats back into the pattern for toPattern() support.</span></pre></td>
</tr>
<tr>
 	<td class=''>440</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>441</td>
 	<td class=''><pre><span class="comment">     * @param pattern source</span></pre></td>
</tr>
<tr>
 	<td class=''>442</td>
 	<td class=''><pre><span class="comment">     * @param customPatterns The custom patterns to re-insert, if any</span></pre></td>
</tr>
<tr>
 	<td class=''>443</td>
 	<td class=''><pre><span class="comment">     * @return full pattern</span></pre></td>
</tr>
<tr>
 	<td class=''>444</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>445</td>
 	<td class=''><pre>    <span class="keyword">private</span> String insertFormats(<span class="keyword">final</span> String pattern, <span class="keyword">final</span> ArrayList&lt;String&gt; customPatterns) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>446</td>
 	<td class='coveredLight'><pre>        <span class="keyword">if</span> (!containsElements(customPatterns)) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>447</td>
 	<td class='coveredLight'><pre>            <span class="keyword">return</span> pattern;</pre></td>
</tr>
<tr>
 	<td class=''>448</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>449</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> StringBuilder sb = <span class="keyword">new</span> StringBuilder(pattern.length() * 2);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>450</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> ParsePosition pos = <span class="keyword">new</span> ParsePosition(0);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>451</td>
 	<td class='coveredLight'><pre>        <span class="keyword">int</span> fe = -1;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>452</td>
 	<td class='coveredLight'><pre>        <span class="keyword">int</span> depth = 0;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>453</td>
 	<td class='coveredLight'><pre>        <span class="keyword">while</span> (pos.getIndex() &lt; pattern.length()) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>454</td>
 	<td class='coveredLight'><pre>            <span class="keyword">final</span> <span class="keyword">char</span> c = pattern.charAt(pos.getIndex());</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>455</td>
 	<td class='coveredLight'><pre>            <span class="keyword">switch</span> (c) {</pre></td>
</tr>
<tr>
 	<td class=''>456</td>
 	<td class=''><pre>            <span class="keyword">case</span> QUOTE:</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>457</td>
 	<td class='coveredLight'><pre>                appendQuotedString(pattern, pos, sb);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>458</td>
 	<td class='coveredLight'><pre>                <span class="keyword">break</span>;</pre></td>
</tr>
<tr>
 	<td class=''>459</td>
 	<td class=''><pre>            <span class="keyword">case</span> START_FE:</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>460</td>
 	<td class='coveredLight'><pre>                depth++;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>461</td>
 	<td class='coveredLight'><pre>                sb.append(START_FE).append(readArgumentIndex(pattern, next(pos)));</pre></td>
</tr>
<tr>
 	<td class=''>462</td>
 	<td class=''><pre>                <span class="comment">// do not look for custom patterns when they are embedded, e.g. in a choice</span></pre></td>
</tr>
<tr>
 	<td class='coveredLight'>463</td>
 	<td class='coveredLight'><pre>                <span class="keyword">if</span> (depth == 1) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>464</td>
 	<td class='coveredLight'><pre>                    fe++;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>465</td>
 	<td class='coveredLight'><pre>                    <span class="keyword">final</span> String customPattern = customPatterns.get(fe);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>466</td>
 	<td class='coveredLight'><pre>                    <span class="keyword">if</span> (customPattern != <span class="keyword">null</span>) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>467</td>
 	<td class='coveredLight'><pre>                        sb.append(START_FMT).append(customPattern);</pre></td>
</tr>
<tr>
 	<td class=''>468</td>
 	<td class=''><pre>                    }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>469</td>
 	<td class='coveredLight'><pre>                }</pre></td>
</tr>
<tr>
 	<td class=''>470</td>
 	<td class=''><pre>                <span class="keyword">break</span>;</pre></td>
</tr>
<tr>
 	<td class=''>471</td>
 	<td class=''><pre>            <span class="keyword">case</span> END_FE:</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>472</td>
 	<td class='coveredLight'><pre>                depth--;</pre></td>
</tr>
<tr>
 	<td class=''>473</td>
 	<td class=''><pre>                <span class="comment">//$FALL-THROUGH$</span></pre></td>
</tr>
<tr>
 	<td class=''>474</td>
 	<td class=''><pre>            <span class="keyword">default</span>:</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>475</td>
 	<td class='coveredLight'><pre>                sb.append(c);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>476</td>
 	<td class='coveredLight'><pre>                next(pos);</pre></td>
</tr>
<tr>
 	<td class=''>477</td>
 	<td class=''><pre>            }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>478</td>
 	<td class='coveredLight'><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>479</td>
 	<td class='coveredLight'><pre>        <span class="keyword">return</span> sb.toString();</pre></td>
</tr>
<tr>
 	<td class=''>480</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>481</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>482</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>483</td>
 	<td class=''><pre><span class="comment">     * Consume whitespace from the current parse position.</span></pre></td>
</tr>
<tr>
 	<td class=''>484</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>485</td>
 	<td class=''><pre><span class="comment">     * @param pattern String to read</span></pre></td>
</tr>
<tr>
 	<td class=''>486</td>
 	<td class=''><pre><span class="comment">     * @param pos current position</span></pre></td>
</tr>
<tr>
 	<td class=''>487</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>488</td>
 	<td class=''><pre>    <span class="keyword">private</span> <span class="keyword">void</span> seekNonWs(<span class="keyword">final</span> String pattern, <span class="keyword">final</span> ParsePosition pos) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>489</td>
 	<td class='coveredLight'><pre>        <span class="keyword">int</span> len = 0;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>490</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> <span class="keyword">char</span>[] buffer = pattern.toCharArray();</pre></td>
</tr>
<tr>
 	<td class=''>491</td>
 	<td class=''><pre>        <span class="keyword">do</span> {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>492</td>
 	<td class='coveredLight'><pre>            len = StrMatcher.splitMatcher().isMatch(buffer, pos.getIndex());</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>493</td>
 	<td class='coveredLight'><pre>            pos.setIndex(pos.getIndex() + len);</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>494</td>
 	<td class='notCoveredLight'><pre>        } <span class="keyword">while</span> (len &gt; 0 &amp;&amp; pos.getIndex() &lt; pattern.length());</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>495</td>
 	<td class='coveredLight'><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>496</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>497</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>498</td>
 	<td class=''><pre><span class="comment">     * Convenience method to advance parse position by 1.</span></pre></td>
</tr>
<tr>
 	<td class=''>499</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>500</td>
 	<td class=''><pre><span class="comment">     * @param pos ParsePosition</span></pre></td>
</tr>
<tr>
 	<td class=''>501</td>
 	<td class=''><pre><span class="comment">     * @return &lt;code&gt;pos&lt;/code&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>502</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>503</td>
 	<td class=''><pre>    <span class="keyword">private</span> ParsePosition next(<span class="keyword">final</span> ParsePosition pos) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>504</td>
 	<td class='coveredLight'><pre>        pos.setIndex(pos.getIndex() + 1);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>505</td>
 	<td class='coveredLight'><pre>        <span class="keyword">return</span> pos;</pre></td>
</tr>
<tr>
 	<td class=''>506</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>507</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>508</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>509</td>
 	<td class=''><pre><span class="comment">     * Consume a quoted string, adding it to &lt;code&gt;appendTo&lt;/code&gt; if</span></pre></td>
</tr>
<tr>
 	<td class=''>510</td>
 	<td class=''><pre><span class="comment">     * specified.</span></pre></td>
</tr>
<tr>
 	<td class=''>511</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>512</td>
 	<td class=''><pre><span class="comment">     * @param pattern pattern to parse</span></pre></td>
</tr>
<tr>
 	<td class=''>513</td>
 	<td class=''><pre><span class="comment">     * @param pos current parse position</span></pre></td>
</tr>
<tr>
 	<td class=''>514</td>
 	<td class=''><pre><span class="comment">     * @param appendTo optional StringBuilder to append</span></pre></td>
</tr>
<tr>
 	<td class=''>515</td>
 	<td class=''><pre><span class="comment">     * @return &lt;code&gt;appendTo&lt;/code&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>516</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>517</td>
 	<td class=''><pre>    <span class="keyword">private</span> StringBuilder appendQuotedString(<span class="keyword">final</span> String pattern, <span class="keyword">final</span> ParsePosition pos,</pre></td>
</tr>
<tr>
 	<td class=''>518</td>
 	<td class=''><pre>            <span class="keyword">final</span> StringBuilder appendTo) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>519</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">assert</span> pattern.toCharArray()[pos.getIndex()] == QUOTE</pre></td>
</tr>
<tr>
 	<td class=''>520</td>
 	<td class=''><pre>                : <span class="string">"Quoted string must start with quote character"</span>;</pre></td>
</tr>
<tr>
 	<td class=''>521</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>522</td>
 	<td class=''><pre>        <span class="comment">// handle quote character at the beginning of the string</span></pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>523</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">if</span> (appendTo != <span class="keyword">null</span>) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>524</td>
 	<td class='coveredLight'><pre>            appendTo.append(QUOTE);</pre></td>
</tr>
<tr>
 	<td class=''>525</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>526</td>
 	<td class='coveredLight'><pre>        next(pos);</pre></td>
</tr>
<tr>
 	<td class=''>527</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class='coveredLight'>528</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> <span class="keyword">int</span> start = pos.getIndex();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>529</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> <span class="keyword">char</span>[] c = pattern.toCharArray();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>530</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> <span class="keyword">int</span> lastHold = start;</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>531</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">for</span> (<span class="keyword">int</span> i = pos.getIndex(); i &lt; pattern.length(); i++) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>532</td>
 	<td class='coveredLight'><pre>            <span class="keyword">switch</span> (c[pos.getIndex()]) {</pre></td>
</tr>
<tr>
 	<td class=''>533</td>
 	<td class=''><pre>            <span class="keyword">case</span> QUOTE:</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>534</td>
 	<td class='coveredLight'><pre>                next(pos);</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>535</td>
 	<td class='notCoveredLight'><pre>                <span class="keyword">return</span> appendTo == <span class="keyword">null</span> ? <span class="keyword">null</span> : appendTo.append(c, lastHold,</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>536</td>
 	<td class='coveredLight'><pre>                        pos.getIndex() - lastHold);</pre></td>
</tr>
<tr>
 	<td class=''>537</td>
 	<td class=''><pre>            <span class="keyword">default</span>:</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>538</td>
 	<td class='coveredLight'><pre>                next(pos);</pre></td>
</tr>
<tr>
 	<td class=''>539</td>
 	<td class=''><pre>            }</pre></td>
</tr>
<tr>
 	<td class=''>540</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>541</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</pre></td>
</tr>
<tr>
 	<td class=''>542</td>
 	<td class=''><pre>                <span class="string">"Unterminated quoted string at position "</span> + start);</pre></td>
</tr>
<tr>
 	<td class=''>543</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>544</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>545</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>546</td>
 	<td class=''><pre><span class="comment">     * Consume quoted string only.</span></pre></td>
</tr>
<tr>
 	<td class=''>547</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>548</td>
 	<td class=''><pre><span class="comment">     * @param pattern pattern to parse</span></pre></td>
</tr>
<tr>
 	<td class=''>549</td>
 	<td class=''><pre><span class="comment">     * @param pos current parse position</span></pre></td>
</tr>
<tr>
 	<td class=''>550</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>551</td>
 	<td class=''><pre>    <span class="keyword">private</span> <span class="keyword">void</span> getQuotedString(<span class="keyword">final</span> String pattern, <span class="keyword">final</span> ParsePosition pos) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>552</td>
 	<td class='notCoveredLight'><pre>        appendQuotedString(pattern, pos, <span class="keyword">null</span>);</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>553</td>
 	<td class='notCoveredLight'><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>554</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>555</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>556</td>
 	<td class=''><pre><span class="comment">     * Learn whether the specified Collection contains non-null elements.</span></pre></td>
</tr>
<tr>
 	<td class=''>557</td>
 	<td class=''><pre><span class="comment">     * @param coll to check</span></pre></td>
</tr>
<tr>
 	<td class=''>558</td>
 	<td class=''><pre><span class="comment">     * @return &lt;code&gt;true&lt;/code&gt; if some Object was found, &lt;code&gt;false&lt;/code&gt; otherwise.</span></pre></td>
</tr>
<tr>
 	<td class=''>559</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>560</td>
 	<td class=''><pre>    <span class="keyword">private</span> <span class="keyword">boolean</span> containsElements(<span class="keyword">final</span> Collection&lt;?&gt; coll) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>561</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">if</span> (coll == <span class="keyword">null</span> || coll.isEmpty()) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>562</td>
 	<td class='coveredLight'><pre>            <span class="keyword">return</span> <span class="keyword">false</span>;</pre></td>
</tr>
<tr>
 	<td class=''>563</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>564</td>
 	<td class='coveredLight'><pre>        <span class="keyword">for</span> (<span class="keyword">final</span> Object name : coll) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>565</td>
 	<td class='coveredLight'><pre>            <span class="keyword">if</span> (name != <span class="keyword">null</span>) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>566</td>
 	<td class='coveredLight'><pre>                <span class="keyword">return</span> <span class="keyword">true</span>;</pre></td>
</tr>
<tr>
 	<td class=''>567</td>
 	<td class=''><pre>            }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>568</td>
 	<td class='coveredLight'><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>569</td>
 	<td class='coveredLight'><pre>        <span class="keyword">return</span> <span class="keyword">false</span>;</pre></td>
</tr>
<tr>
 	<td class=''>570</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>571</td>
 	<td class=''><pre>}</pre></td>
</tr>
<table id='revisedCoverageTable' class='code'>
<tr>
 	<td class=''>1</td>
 	<td class=''><pre><span class="comment">/*</span></pre></td>
</tr>
<tr>
 	<td class=''>2</td>
 	<td class=''><pre><span class="comment"> * Licensed to the Apache Software Foundation (ASF) under one or more</span></pre></td>
</tr>
<tr>
 	<td class=''>3</td>
 	<td class=''><pre><span class="comment"> * contributor license agreements.  See the NOTICE file distributed with</span></pre></td>
</tr>
<tr>
 	<td class=''>4</td>
 	<td class=''><pre><span class="comment"> * this work for additional information regarding copyright ownership.</span></pre></td>
</tr>
<tr>
 	<td class=''>5</td>
 	<td class=''><pre><span class="comment"> * The ASF licenses this file to You under the Apache License, Version 2.0</span></pre></td>
</tr>
<tr>
 	<td class=''>6</td>
 	<td class=''><pre><span class="comment"> * (the "License"); you may not use this file except in compliance with</span></pre></td>
</tr>
<tr>
 	<td class=''>7</td>
 	<td class=''><pre><span class="comment"> * the License.  You may obtain a copy of the License at</span></pre></td>
</tr>
<tr>
 	<td class=''>8</td>
 	<td class=''><pre><span class="comment"> *</span></pre></td>
</tr>
<tr>
 	<td class=''>9</td>
 	<td class=''><pre><span class="comment"> *      http://www.apache.org/licenses/LICENSE-2.0</span></pre></td>
</tr>
<tr>
 	<td class=''>10</td>
 	<td class=''><pre><span class="comment"> *</span></pre></td>
</tr>
<tr>
 	<td class=''>11</td>
 	<td class=''><pre><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></pre></td>
</tr>
<tr>
 	<td class=''>12</td>
 	<td class=''><pre><span class="comment"> * distributed under the License is distributed on an "AS IS" BASIS,</span></pre></td>
</tr>
<tr>
 	<td class=''>13</td>
 	<td class=''><pre><span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></pre></td>
</tr>
<tr>
 	<td class=''>14</td>
 	<td class=''><pre><span class="comment"> * See the License for the specific language governing permissions and</span></pre></td>
</tr>
<tr>
 	<td class=''>15</td>
 	<td class=''><pre><span class="comment"> * limitations under the License.</span></pre></td>
</tr>
<tr>
 	<td class=''>16</td>
 	<td class=''><pre><span class="comment"> */</span></pre></td>
</tr>
<tr>
 	<td class=''>17</td>
 	<td class=''><pre><span class="keyword">package</span> org.apache.commons.text;</pre></td>
</tr>
<tr>
 	<td class=''>18</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>19</td>
 	<td class=''><pre><span class="keyword">import</span> java.text.Format;</pre></td>
</tr>
<tr>
 	<td class=''>20</td>
 	<td class=''><pre><span class="keyword">import</span> java.text.MessageFormat;</pre></td>
</tr>
<tr>
 	<td class=''>21</td>
 	<td class=''><pre><span class="keyword">import</span> java.text.ParsePosition;</pre></td>
</tr>
<tr>
 	<td class=''>22</td>
 	<td class=''><pre><span class="keyword">import</span> java.util.ArrayList;</pre></td>
</tr>
<tr>
 	<td class=''>23</td>
 	<td class=''><pre><span class="keyword">import</span> java.util.Collection;</pre></td>
</tr>
<tr>
 	<td class=''>24</td>
 	<td class=''><pre><span class="keyword">import</span> java.util.Iterator;</pre></td>
</tr>
<tr>
 	<td class=''>25</td>
 	<td class=''><pre><span class="keyword">import</span> java.util.Locale;</pre></td>
</tr>
<tr>
 	<td class=''>26</td>
 	<td class=''><pre><span class="keyword">import</span> java.util.Locale.Category;</pre></td>
</tr>
<tr>
 	<td class=''>27</td>
 	<td class=''><pre><span class="keyword">import</span> java.util.Map;</pre></td>
</tr>
<tr>
 	<td class=''>28</td>
 	<td class=''><pre><span class="keyword">import</span> java.util.Objects;</pre></td>
</tr>
<tr>
 	<td class=''>29</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>30</td>
 	<td class=''><pre><span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>31</td>
 	<td class=''><pre><span class="comment"> * Extends &lt;code&gt;java.text.MessageFormat&lt;/code&gt; to allow pluggable/additional formatting</span></pre></td>
</tr>
<tr>
 	<td class=''>32</td>
 	<td class=''><pre><span class="comment"> * options for embedded format elements.  Client code should specify a registry</span></pre></td>
</tr>
<tr>
 	<td class=''>33</td>
 	<td class=''><pre><span class="comment"> * of &lt;code&gt;FormatFactory&lt;/code&gt; instances associated with &lt;code&gt;String&lt;/code&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>34</td>
 	<td class=''><pre><span class="comment"> * format names.  This registry will be consulted when the format elements are</span></pre></td>
</tr>
<tr>
 	<td class=''>35</td>
 	<td class=''><pre><span class="comment"> * parsed from the message pattern.  In this way custom patterns can be specified,</span></pre></td>
</tr>
<tr>
 	<td class=''>36</td>
 	<td class=''><pre><span class="comment"> * and the formats supported by &lt;code&gt;java.text.MessageFormat&lt;/code&gt; can be overridden</span></pre></td>
</tr>
<tr>
 	<td class=''>37</td>
 	<td class=''><pre><span class="comment"> * at the format and/or format style level (see MessageFormat).  A "format element"</span></pre></td>
</tr>
<tr>
 	<td class=''>38</td>
 	<td class=''><pre><span class="comment"> * embedded in the message pattern is specified (&lt;b&gt;()?&lt;/b&gt; signifies optionality):&lt;br&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>39</td>
 	<td class=''><pre><span class="comment"> * &lt;code&gt;{&lt;/code&gt;&lt;i&gt;argument-number&lt;/i&gt;&lt;b&gt;(&lt;/b&gt;&lt;code&gt;,&lt;/code&gt;&lt;i&gt;format-name&lt;/i&gt;&lt;b&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>40</td>
 	<td class=''><pre><span class="comment"> * (&lt;/b&gt;&lt;code&gt;,&lt;/code&gt;&lt;i&gt;format-style&lt;/i&gt;&lt;b&gt;)?)?&lt;/b&gt;&lt;code&gt;}&lt;/code&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>41</td>
 	<td class=''><pre><span class="comment"> *</span></pre></td>
</tr>
<tr>
 	<td class=''>42</td>
 	<td class=''><pre><span class="comment"> * &lt;p&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>43</td>
 	<td class=''><pre><span class="comment"> * &lt;i&gt;format-name&lt;/i&gt; and &lt;i&gt;format-style&lt;/i&gt; values are trimmed of surrounding whitespace</span></pre></td>
</tr>
<tr>
 	<td class=''>44</td>
 	<td class=''><pre><span class="comment"> * in the manner of &lt;code&gt;java.text.MessageFormat&lt;/code&gt;.  If &lt;i&gt;format-name&lt;/i&gt; denotes</span></pre></td>
</tr>
<tr>
 	<td class=''>45</td>
 	<td class=''><pre><span class="comment"> * &lt;code&gt;FormatFactory formatFactoryInstance&lt;/code&gt; in &lt;code&gt;registry&lt;/code&gt;, a &lt;code&gt;Format&lt;/code&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>46</td>
 	<td class=''><pre><span class="comment"> * matching &lt;i&gt;format-name&lt;/i&gt; and &lt;i&gt;format-style&lt;/i&gt; is requested from</span></pre></td>
</tr>
<tr>
 	<td class=''>47</td>
 	<td class=''><pre><span class="comment"> * &lt;code&gt;formatFactoryInstance&lt;/code&gt;.  If this is successful, the &lt;code&gt;Format&lt;/code&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>48</td>
 	<td class=''><pre><span class="comment"> * found is used for this format element.</span></pre></td>
</tr>
<tr>
 	<td class=''>49</td>
 	<td class=''><pre><span class="comment"> * &lt;/p&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>50</td>
 	<td class=''><pre><span class="comment"> *</span></pre></td>
</tr>
<tr>
 	<td class=''>51</td>
 	<td class=''><pre><span class="comment"> * &lt;p&gt;&lt;b&gt;NOTICE:&lt;/b&gt; The various subformat mutator methods are considered unnecessary; they exist on the parent</span></pre></td>
</tr>
<tr>
 	<td class=''>52</td>
 	<td class=''><pre><span class="comment"> * class to allow the type of customization which it is the job of this class to provide in</span></pre></td>
</tr>
<tr>
 	<td class=''>53</td>
 	<td class=''><pre><span class="comment"> * a configurable fashion.  These methods have thus been disabled and will throw</span></pre></td>
</tr>
<tr>
 	<td class=''>54</td>
 	<td class=''><pre><span class="comment"> * &lt;code&gt;UnsupportedOperationException&lt;/code&gt; if called.</span></pre></td>
</tr>
<tr>
 	<td class=''>55</td>
 	<td class=''><pre><span class="comment"> * &lt;/p&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>56</td>
 	<td class=''><pre><span class="comment"> *</span></pre></td>
</tr>
<tr>
 	<td class=''>57</td>
 	<td class=''><pre><span class="comment"> * &lt;p&gt;Limitations inherited from &lt;code&gt;java.text.MessageFormat&lt;/code&gt;:&lt;/p&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>58</td>
 	<td class=''><pre><span class="comment"> * &lt;ul&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>59</td>
 	<td class=''><pre><span class="comment"> * &lt;li&gt;When using "choice" subformats, support for nested formatting instructions is limited</span></pre></td>
</tr>
<tr>
 	<td class=''>60</td>
 	<td class=''><pre><span class="comment"> *     to that provided by the base class.&lt;/li&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>61</td>
 	<td class=''><pre><span class="comment"> * &lt;li&gt;Thread-safety of &lt;code&gt;Format&lt;/code&gt;s, including &lt;code&gt;MessageFormat&lt;/code&gt; and thus</span></pre></td>
</tr>
<tr>
 	<td class=''>62</td>
 	<td class=''><pre><span class="comment"> *     &lt;code&gt;ExtendedMessageFormat&lt;/code&gt;, is not guaranteed.&lt;/li&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>63</td>
 	<td class=''><pre><span class="comment"> * &lt;/ul&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>64</td>
 	<td class=''><pre><span class="comment"> *</span></pre></td>
</tr>
<tr>
 	<td class=''>65</td>
 	<td class=''><pre><span class="comment"> * @since 1.0</span></pre></td>
</tr>
<tr>
 	<td class=''>66</td>
 	<td class=''><pre><span class="comment"> */</span></pre></td>
</tr>
<tr>
 	<td class='coveredLight'>67</td>
 	<td class='coveredLight'><pre><span class="keyword">public</span> <span class="keyword">class</span> ExtendedMessageFormat <span class="keyword">extends</span> MessageFormat {</pre></td>
</tr>
<tr>
 	<td class=''>68</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>69</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>70</td>
 	<td class=''><pre><span class="comment">     * Serializable Object.</span></pre></td>
</tr>
<tr>
 	<td class=''>71</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>72</td>
 	<td class=''><pre>    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -2362048321261811743L;</pre></td>
</tr>
<tr>
 	<td class=''>73</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>74</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>75</td>
 	<td class=''><pre><span class="comment">     * Our initial seed value for calculating hashes.</span></pre></td>
</tr>
<tr>
 	<td class=''>76</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>77</td>
 	<td class=''><pre>    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> HASH_SEED = 31;</pre></td>
</tr>
<tr>
 	<td class=''>78</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>79</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>80</td>
 	<td class=''><pre><span class="comment">     * The empty string.</span></pre></td>
</tr>
<tr>
 	<td class=''>81</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>82</td>
 	<td class=''><pre>    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DUMMY_PATTERN = <span class="string">""</span>;</pre></td>
</tr>
<tr>
 	<td class=''>83</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>84</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>85</td>
 	<td class=''><pre><span class="comment">     * A comma.</span></pre></td>
</tr>
<tr>
 	<td class=''>86</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>87</td>
 	<td class=''><pre>    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span> START_FMT = <span class="string">','</span>;</pre></td>
</tr>
<tr>
 	<td class=''>88</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>89</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>90</td>
 	<td class=''><pre><span class="comment">     * A right side squigly brace.</span></pre></td>
</tr>
<tr>
 	<td class=''>91</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>92</td>
 	<td class=''><pre>    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span> END_FE = <span class="string">'}'</span>;</pre></td>
</tr>
<tr>
 	<td class=''>93</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>94</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>95</td>
 	<td class=''><pre><span class="comment">     * A left side squigly brace.</span></pre></td>
</tr>
<tr>
 	<td class=''>96</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>97</td>
 	<td class=''><pre>    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span> START_FE = <span class="string">'{'</span>;</pre></td>
</tr>
<tr>
 	<td class=''>98</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>99</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>100</td>
 	<td class=''><pre><span class="comment">     * A properly escaped character representing a single quote.</span></pre></td>
</tr>
<tr>
 	<td class=''>101</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>102</td>
 	<td class=''><pre>    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span> QUOTE = <span class="string">'\''</span>;</pre></td>
</tr>
<tr>
 	<td class=''>103</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>104</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>105</td>
 	<td class=''><pre><span class="comment">     * To pattern string.</span></pre></td>
</tr>
<tr>
 	<td class=''>106</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>107</td>
 	<td class=''><pre>    <span class="keyword">private</span> String toPattern;</pre></td>
</tr>
<tr>
 	<td class=''>108</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>109</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>110</td>
 	<td class=''><pre><span class="comment">     * Our registry of FormatFactory's.</span></pre></td>
</tr>
<tr>
 	<td class=''>111</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>112</td>
 	<td class=''><pre>    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, ? <span class="keyword">extends</span> FormatFactory&gt; registry;</pre></td>
</tr>
<tr>
 	<td class=''>113</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>114</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>115</td>
 	<td class=''><pre><span class="comment">     * Create a new ExtendedMessageFormat for the default locale.</span></pre></td>
</tr>
<tr>
 	<td class=''>116</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>117</td>
 	<td class=''><pre><span class="comment">     * @param pattern  the pattern to use, not null</span></pre></td>
</tr>
<tr>
 	<td class=''>118</td>
 	<td class=''><pre><span class="comment">     * @throws IllegalArgumentException in case of a bad pattern.</span></pre></td>
</tr>
<tr>
 	<td class=''>119</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>120</td>
 	<td class=''><pre>    <span class="keyword">public</span> ExtendedMessageFormat(<span class="keyword">final</span> String pattern) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>121</td>
 	<td class='coveredLight'><pre>        <span class="keyword">this</span>(pattern, Locale.getDefault(Category.FORMAT));</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>122</td>
 	<td class='coveredLight'><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>123</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>124</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>125</td>
 	<td class=''><pre><span class="comment">     * Create a new ExtendedMessageFormat.</span></pre></td>
</tr>
<tr>
 	<td class=''>126</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>127</td>
 	<td class=''><pre><span class="comment">     * @param pattern  the pattern to use, not null</span></pre></td>
</tr>
<tr>
 	<td class=''>128</td>
 	<td class=''><pre><span class="comment">     * @param locale  the locale to use, not null</span></pre></td>
</tr>
<tr>
 	<td class=''>129</td>
 	<td class=''><pre><span class="comment">     * @throws IllegalArgumentException in case of a bad pattern.</span></pre></td>
</tr>
<tr>
 	<td class=''>130</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>131</td>
 	<td class=''><pre>    <span class="keyword">public</span> ExtendedMessageFormat(<span class="keyword">final</span> String pattern, <span class="keyword">final</span> Locale locale) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>132</td>
 	<td class='coveredLight'><pre>        <span class="keyword">this</span>(pattern, locale, <span class="keyword">null</span>);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>133</td>
 	<td class='coveredLight'><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>134</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>135</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>136</td>
 	<td class=''><pre><span class="comment">     * Create a new ExtendedMessageFormat for the default locale.</span></pre></td>
</tr>
<tr>
 	<td class=''>137</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>138</td>
 	<td class=''><pre><span class="comment">     * @param pattern  the pattern to use, not null</span></pre></td>
</tr>
<tr>
 	<td class=''>139</td>
 	<td class=''><pre><span class="comment">     * @param registry  the registry of format factories, may be null</span></pre></td>
</tr>
<tr>
 	<td class=''>140</td>
 	<td class=''><pre><span class="comment">     * @throws IllegalArgumentException in case of a bad pattern.</span></pre></td>
</tr>
<tr>
 	<td class=''>141</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>142</td>
 	<td class=''><pre>    <span class="keyword">public</span> ExtendedMessageFormat(<span class="keyword">final</span> String pattern,</pre></td>
</tr>
<tr>
 	<td class=''>143</td>
 	<td class=''><pre>                                 <span class="keyword">final</span> Map&lt;String, ? <span class="keyword">extends</span> FormatFactory&gt; registry) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>144</td>
 	<td class='coveredLight'><pre>        <span class="keyword">this</span>(pattern, Locale.getDefault(Category.FORMAT), registry);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>145</td>
 	<td class='coveredLight'><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>146</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>147</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>148</td>
 	<td class=''><pre><span class="comment">     * Create a new ExtendedMessageFormat.</span></pre></td>
</tr>
<tr>
 	<td class=''>149</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>150</td>
 	<td class=''><pre><span class="comment">     * @param pattern  the pattern to use, not null</span></pre></td>
</tr>
<tr>
 	<td class=''>151</td>
 	<td class=''><pre><span class="comment">     * @param locale  the locale to use, not null</span></pre></td>
</tr>
<tr>
 	<td class=''>152</td>
 	<td class=''><pre><span class="comment">     * @param registry  the registry of format factories, may be null</span></pre></td>
</tr>
<tr>
 	<td class=''>153</td>
 	<td class=''><pre><span class="comment">     * @throws IllegalArgumentException in case of a bad pattern.</span></pre></td>
</tr>
<tr>
 	<td class=''>154</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>155</td>
 	<td class=''><pre>    <span class="keyword">public</span> ExtendedMessageFormat(<span class="keyword">final</span> String pattern,</pre></td>
</tr>
<tr>
 	<td class=''>156</td>
 	<td class=''><pre>                                 <span class="keyword">final</span> Locale locale,</pre></td>
</tr>
<tr>
 	<td class=''>157</td>
 	<td class=''><pre>                                 <span class="keyword">final</span> Map&lt;String, ? <span class="keyword">extends</span> FormatFactory&gt; registry) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>158</td>
 	<td class='coveredLight'><pre>        <span class="keyword">super</span>(DUMMY_PATTERN);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>159</td>
 	<td class='coveredLight'><pre>        setLocale(locale);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>160</td>
 	<td class='coveredLight'><pre>        <span class="keyword">this</span>.registry = registry;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>161</td>
 	<td class='coveredLight'><pre>        applyPattern(pattern);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>162</td>
 	<td class='coveredLight'><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>163</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>164</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>165</td>
 	<td class=''><pre><span class="comment">     * {@inheritDoc}</span></pre></td>
</tr>
<tr>
 	<td class=''>166</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>167</td>
 	<td class=''><pre>    @Override</pre></td>
</tr>
<tr>
 	<td class=''>168</td>
 	<td class=''><pre>    <span class="keyword">public</span> String toPattern() {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>169</td>
 	<td class='coveredLight'><pre>        <span class="keyword">return</span> toPattern;</pre></td>
</tr>
<tr>
 	<td class=''>170</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>171</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>172</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>173</td>
 	<td class=''><pre><span class="comment">     * Apply the specified pattern.</span></pre></td>
</tr>
<tr>
 	<td class=''>174</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>175</td>
 	<td class=''><pre><span class="comment">     * @param pattern String</span></pre></td>
</tr>
<tr>
 	<td class=''>176</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>177</td>
 	<td class=''><pre>    @Override</pre></td>
</tr>
<tr>
 	<td class=''>178</td>
 	<td class=''><pre>    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> applyPattern(<span class="keyword">final</span> String pattern) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>179</td>
 	<td class='coveredLight'><pre>        <span class="keyword">if</span> (registry == <span class="keyword">null</span>) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>180</td>
 	<td class='coveredLight'><pre>            <span class="keyword">super</span>.applyPattern(pattern);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>181</td>
 	<td class='coveredLight'><pre>            toPattern = <span class="keyword">super</span>.toPattern();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>182</td>
 	<td class='coveredLight'><pre>            <span class="keyword">return</span>;</pre></td>
</tr>
<tr>
 	<td class=''>183</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>184</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> ArrayList&lt;Format&gt; foundFormats = <span class="keyword">new</span> ArrayList&lt;&gt;();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>185</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> ArrayList&lt;String&gt; foundDescriptions = <span class="keyword">new</span> ArrayList&lt;&gt;();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>186</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> StringBuilder stripCustom = <span class="keyword">new</span> StringBuilder(pattern.length());</pre></td>
</tr>
<tr>
 	<td class=''>187</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class='coveredLight'>188</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> ParsePosition pos = <span class="keyword">new</span> ParsePosition(0);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>189</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> <span class="keyword">char</span>[] c = pattern.toCharArray();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>190</td>
 	<td class='coveredLight'><pre>        <span class="keyword">int</span> fmtCount = 0;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>191</td>
 	<td class='coveredLight'><pre>        <span class="keyword">while</span> (pos.getIndex() &lt; pattern.length()) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>192</td>
 	<td class='coveredLight'><pre>            <span class="keyword">switch</span> (c[pos.getIndex()]) {</pre></td>
</tr>
<tr>
 	<td class=''>193</td>
 	<td class=''><pre>            <span class="keyword">case</span> QUOTE:</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>194</td>
 	<td class='coveredLight'><pre>                appendQuotedString(pattern, pos, stripCustom);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>195</td>
 	<td class='coveredLight'><pre>                <span class="keyword">break</span>;</pre></td>
</tr>
<tr>
 	<td class=''>196</td>
 	<td class=''><pre>            <span class="keyword">case</span> START_FE:</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>197</td>
 	<td class='coveredLight'><pre>                fmtCount++;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>198</td>
 	<td class='coveredLight'><pre>                seekNonWs(pattern, pos);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>199</td>
 	<td class='coveredLight'><pre>                <span class="keyword">final</span> <span class="keyword">int</span> start = pos.getIndex();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>200</td>
 	<td class='coveredLight'><pre>                <span class="keyword">final</span> <span class="keyword">int</span> index = readArgumentIndex(pattern, next(pos));</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>201</td>
 	<td class='coveredLight'><pre>                stripCustom.append(START_FE).append(index);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>202</td>
 	<td class='coveredLight'><pre>                seekNonWs(pattern, pos);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>203</td>
 	<td class='coveredLight'><pre>                Format format = <span class="keyword">null</span>;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>204</td>
 	<td class='coveredLight'><pre>                String formatDescription = <span class="keyword">null</span>;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>205</td>
 	<td class='coveredLight'><pre>                <span class="keyword">if</span> (c[pos.getIndex()] == START_FMT) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>206</td>
 	<td class='coveredLight'><pre>                    formatDescription = parseFormatDescription(pattern,</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>207</td>
 	<td class='coveredLight'><pre>                            next(pos));</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>208</td>
 	<td class='coveredLight'><pre>                    format = getFormat(formatDescription);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>209</td>
 	<td class='coveredLight'><pre>                    <span class="keyword">if</span> (format == <span class="keyword">null</span>) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>210</td>
 	<td class='coveredLight'><pre>                        stripCustom.append(START_FMT).append(formatDescription);</pre></td>
</tr>
<tr>
 	<td class=''>211</td>
 	<td class=''><pre>                    }</pre></td>
</tr>
<tr>
 	<td class=''>212</td>
 	<td class=''><pre>                }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>213</td>
 	<td class='coveredLight'><pre>                foundFormats.add(format);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>214</td>
 	<td class='coveredLight'><pre>                foundDescriptions.add(format == <span class="keyword">null</span> ? <span class="keyword">null</span> : formatDescription);</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>215</td>
 	<td class='notCoveredLight'><pre>                <span class="keyword">if</span> (foundFormats.size() != fmtCount) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>216</td>
 	<td class='notCoveredLight'><pre>                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"The validated expression is false"</span>);</pre></td>
</tr>
<tr>
 	<td class=''>217</td>
 	<td class=''><pre>                }</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>218</td>
 	<td class='notCoveredLight'><pre>                <span class="keyword">if</span> (foundDescriptions.size() != fmtCount) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>219</td>
 	<td class='notCoveredLight'><pre>                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"The validated expression is false"</span>);</pre></td>
</tr>
<tr>
 	<td class=''>220</td>
 	<td class=''><pre>                }</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>221</td>
 	<td class='notCoveredLight'><pre>                <span class="keyword">if</span> (c[pos.getIndex()] != END_FE) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>222</td>
 	<td class='notCoveredLight'><pre>                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</pre></td>
</tr>
<tr>
 	<td class=''>223</td>
 	<td class=''><pre>                            <span class="string">"Unreadable format element at position "</span> + start);</pre></td>
</tr>
<tr>
 	<td class=''>224</td>
 	<td class=''><pre>                }</pre></td>
</tr>
<tr>
 	<td class=''>225</td>
 	<td class=''><pre>                <span class="comment">//$FALL-THROUGH$</span></pre></td>
</tr>
<tr>
 	<td class=''>226</td>
 	<td class=''><pre>            <span class="keyword">default</span>:</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>227</td>
 	<td class='coveredLight'><pre>                stripCustom.append(c[pos.getIndex()]);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>228</td>
 	<td class='coveredLight'><pre>                next(pos);</pre></td>
</tr>
<tr>
 	<td class=''>229</td>
 	<td class=''><pre>            }</pre></td>
</tr>
<tr>
 	<td class=''>230</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>231</td>
 	<td class='coveredLight'><pre>        <span class="keyword">super</span>.applyPattern(stripCustom.toString());</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>232</td>
 	<td class='coveredLight'><pre>        toPattern = insertFormats(<span class="keyword">super</span>.toPattern(), foundDescriptions);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>233</td>
 	<td class='coveredLight'><pre>        <span class="keyword">if</span> (containsElements(foundFormats)) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>234</td>
 	<td class='coveredLight'><pre>            <span class="keyword">final</span> Format[] origFormats = getFormats();</pre></td>
</tr>
<tr>
 	<td class=''>235</td>
 	<td class=''><pre>            <span class="comment">// only loop over what we know we have, as MessageFormat on Java 1.3</span></pre></td>
</tr>
<tr>
 	<td class=''>236</td>
 	<td class=''><pre>            <span class="comment">// seems to provide an extra format element:</span></pre></td>
</tr>
<tr>
 	<td class='coveredLight'>237</td>
 	<td class='coveredLight'><pre>            <span class="keyword">int</span> i = 0;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>238</td>
 	<td class='coveredLight'><pre>            <span class="keyword">for</span> (<span class="keyword">final</span> Iterator&lt;Format&gt; it = foundFormats.iterator(); it.hasNext(); i++) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>239</td>
 	<td class='coveredLight'><pre>                <span class="keyword">final</span> Format f = it.next();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>240</td>
 	<td class='coveredLight'><pre>                <span class="keyword">if</span> (f != <span class="keyword">null</span>) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>241</td>
 	<td class='coveredLight'><pre>                    origFormats[i] = f;</pre></td>
</tr>
<tr>
 	<td class=''>242</td>
 	<td class=''><pre>                }</pre></td>
</tr>
<tr>
 	<td class=''>243</td>
 	<td class=''><pre>            }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>244</td>
 	<td class='coveredLight'><pre>            <span class="keyword">super</span>.setFormats(origFormats);</pre></td>
</tr>
<tr>
 	<td class=''>245</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>246</td>
 	<td class='coveredLight'><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>247</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>248</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>249</td>
 	<td class=''><pre><span class="comment">     * Throws UnsupportedOperationException - see class Javadoc for details.</span></pre></td>
</tr>
<tr>
 	<td class=''>250</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>251</td>
 	<td class=''><pre><span class="comment">     * @param formatElementIndex format element index</span></pre></td>
</tr>
<tr>
 	<td class=''>252</td>
 	<td class=''><pre><span class="comment">     * @param newFormat the new format</span></pre></td>
</tr>
<tr>
 	<td class=''>253</td>
 	<td class=''><pre><span class="comment">     * @throws UnsupportedOperationException always thrown since this isn't</span></pre></td>
</tr>
<tr>
 	<td class=''>254</td>
 	<td class=''><pre><span class="comment">     *                                       supported by ExtendMessageFormat</span></pre></td>
</tr>
<tr>
 	<td class=''>255</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>256</td>
 	<td class=''><pre>    @Override</pre></td>
</tr>
<tr>
 	<td class=''>257</td>
 	<td class=''><pre>    <span class="keyword">public</span> <span class="keyword">void</span> setFormat(<span class="keyword">final</span> <span class="keyword">int</span> formatElementIndex, <span class="keyword">final</span> Format newFormat) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>258</td>
 	<td class='coveredLight'><pre>        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</pre></td>
</tr>
<tr>
 	<td class=''>259</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>260</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>261</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>262</td>
 	<td class=''><pre><span class="comment">     * Throws UnsupportedOperationException - see class Javadoc for details.</span></pre></td>
</tr>
<tr>
 	<td class=''>263</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>264</td>
 	<td class=''><pre><span class="comment">     * @param argumentIndex argument index</span></pre></td>
</tr>
<tr>
 	<td class=''>265</td>
 	<td class=''><pre><span class="comment">     * @param newFormat the new format</span></pre></td>
</tr>
<tr>
 	<td class=''>266</td>
 	<td class=''><pre><span class="comment">     * @throws UnsupportedOperationException always thrown since this isn't</span></pre></td>
</tr>
<tr>
 	<td class=''>267</td>
 	<td class=''><pre><span class="comment">     *                                       supported by ExtendMessageFormat</span></pre></td>
</tr>
<tr>
 	<td class=''>268</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>269</td>
 	<td class=''><pre>    @Override</pre></td>
</tr>
<tr>
 	<td class=''>270</td>
 	<td class=''><pre>    <span class="keyword">public</span> <span class="keyword">void</span> setFormatByArgumentIndex(<span class="keyword">final</span> <span class="keyword">int</span> argumentIndex,</pre></td>
</tr>
<tr>
 	<td class=''>271</td>
 	<td class=''><pre>                                         <span class="keyword">final</span> Format newFormat) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>272</td>
 	<td class='coveredLight'><pre>        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</pre></td>
</tr>
<tr>
 	<td class=''>273</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>274</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>275</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>276</td>
 	<td class=''><pre><span class="comment">     * Throws UnsupportedOperationException - see class Javadoc for details.</span></pre></td>
</tr>
<tr>
 	<td class=''>277</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>278</td>
 	<td class=''><pre><span class="comment">     * @param newFormats new formats</span></pre></td>
</tr>
<tr>
 	<td class=''>279</td>
 	<td class=''><pre><span class="comment">     * @throws UnsupportedOperationException always thrown since this isn't</span></pre></td>
</tr>
<tr>
 	<td class=''>280</td>
 	<td class=''><pre><span class="comment">     *                                       supported by ExtendMessageFormat</span></pre></td>
</tr>
<tr>
 	<td class=''>281</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>282</td>
 	<td class=''><pre>    @Override</pre></td>
</tr>
<tr>
 	<td class=''>283</td>
 	<td class=''><pre>    <span class="keyword">public</span> <span class="keyword">void</span> setFormats(<span class="keyword">final</span> Format[] newFormats) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>284</td>
 	<td class='coveredLight'><pre>        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</pre></td>
</tr>
<tr>
 	<td class=''>285</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>286</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>287</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>288</td>
 	<td class=''><pre><span class="comment">     * Throws UnsupportedOperationException - see class Javadoc for details.</span></pre></td>
</tr>
<tr>
 	<td class=''>289</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>290</td>
 	<td class=''><pre><span class="comment">     * @param newFormats new formats</span></pre></td>
</tr>
<tr>
 	<td class=''>291</td>
 	<td class=''><pre><span class="comment">     * @throws UnsupportedOperationException always thrown since this isn't</span></pre></td>
</tr>
<tr>
 	<td class=''>292</td>
 	<td class=''><pre><span class="comment">     *                                       supported by ExtendMessageFormat</span></pre></td>
</tr>
<tr>
 	<td class=''>293</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>294</td>
 	<td class=''><pre>    @Override</pre></td>
</tr>
<tr>
 	<td class=''>295</td>
 	<td class=''><pre>    <span class="keyword">public</span> <span class="keyword">void</span> setFormatsByArgumentIndex(<span class="keyword">final</span> Format[] newFormats) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>296</td>
 	<td class='coveredLight'><pre>        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</pre></td>
</tr>
<tr>
 	<td class=''>297</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>298</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>299</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>300</td>
 	<td class=''><pre><span class="comment">     * Check if this extended message format is equal to another object.</span></pre></td>
</tr>
<tr>
 	<td class=''>301</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>302</td>
 	<td class=''><pre><span class="comment">     * @param obj the object to compare to</span></pre></td>
</tr>
<tr>
 	<td class=''>303</td>
 	<td class=''><pre><span class="comment">     * @return true if this object equals the other, otherwise false</span></pre></td>
</tr>
<tr>
 	<td class=''>304</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>305</td>
 	<td class=''><pre>    @Override</pre></td>
</tr>
<tr>
 	<td class=''>306</td>
 	<td class=''><pre>    <span class="keyword">public</span> <span class="keyword">boolean</span> equals(<span class="keyword">final</span> Object obj) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>307</td>
 	<td class='coveredLight'><pre>        <span class="keyword">if</span> (obj == <span class="keyword">this</span>) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>308</td>
 	<td class='coveredLight'><pre>            <span class="keyword">return</span> <span class="keyword">true</span>;</pre></td>
</tr>
<tr>
 	<td class=''>309</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>310</td>
 	<td class='coveredLight'><pre>        <span class="keyword">if</span> (obj == <span class="keyword">null</span>) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>311</td>
 	<td class='coveredLight'><pre>            <span class="keyword">return</span> <span class="keyword">false</span>;</pre></td>
</tr>
<tr>
 	<td class=''>312</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>313</td>
 	<td class='coveredLight'><pre>        <span class="keyword">if</span> (!<span class="keyword">super</span>.equals(obj)) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>314</td>
 	<td class='coveredLight'><pre>            <span class="keyword">return</span> <span class="keyword">false</span>;</pre></td>
</tr>
<tr>
 	<td class=''>315</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>316</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">if</span> (!Objects.equals(getClass(), obj.getClass())) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>317</td>
 	<td class='notCoveredLight'><pre>          <span class="keyword">return</span> <span class="keyword">false</span>;</pre></td>
</tr>
<tr>
 	<td class=''>318</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>319</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> ExtendedMessageFormat rhs = (ExtendedMessageFormat) obj;</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>320</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">if</span> (!Objects.equals(toPattern, rhs.toPattern)) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>321</td>
 	<td class='notCoveredLight'><pre>            <span class="keyword">return</span> <span class="keyword">false</span>;</pre></td>
</tr>
<tr>
 	<td class=''>322</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>323</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">if</span> (!Objects.equals(registry, rhs.registry)) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>324</td>
 	<td class='notCoveredLight'><pre>            <span class="keyword">return</span> <span class="keyword">false</span>;</pre></td>
</tr>
<tr>
 	<td class=''>325</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>326</td>
 	<td class='coveredLight'><pre>        <span class="keyword">return</span> <span class="keyword">true</span>;</pre></td>
</tr>
<tr>
 	<td class=''>327</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>328</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>329</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>330</td>
 	<td class=''><pre><span class="comment">     * {@inheritDoc}</span></pre></td>
</tr>
<tr>
 	<td class=''>331</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>332</td>
 	<td class=''><pre>    @Override</pre></td>
</tr>
<tr>
 	<td class=''>333</td>
 	<td class=''><pre>    <span class="keyword">public</span> <span class="keyword">int</span> hashCode() {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>334</td>
 	<td class='coveredLight'><pre>        <span class="keyword">int</span> result = <span class="keyword">super</span>.hashCode();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>335</td>
 	<td class='coveredLight'><pre>        result = HASH_SEED * result + Objects.hashCode(registry);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>336</td>
 	<td class='coveredLight'><pre>        result = HASH_SEED * result + Objects.hashCode(toPattern);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>337</td>
 	<td class='coveredLight'><pre>        <span class="keyword">return</span> result;</pre></td>
</tr>
<tr>
 	<td class=''>338</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>339</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>340</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>341</td>
 	<td class=''><pre><span class="comment">     * Get a custom format from a format description.</span></pre></td>
</tr>
<tr>
 	<td class=''>342</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>343</td>
 	<td class=''><pre><span class="comment">     * @param desc String</span></pre></td>
</tr>
<tr>
 	<td class=''>344</td>
 	<td class=''><pre><span class="comment">     * @return Format</span></pre></td>
</tr>
<tr>
 	<td class=''>345</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>346</td>
 	<td class=''><pre>    <span class="keyword">private</span> Format getFormat(<span class="keyword">final</span> String desc) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>347</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">if</span> (registry != <span class="keyword">null</span>) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>348</td>
 	<td class='coveredLight'><pre>            String name = desc;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>349</td>
 	<td class='coveredLight'><pre>            String args = <span class="keyword">null</span>;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>350</td>
 	<td class='coveredLight'><pre>            <span class="keyword">final</span> <span class="keyword">int</span> i = desc.indexOf(START_FMT);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>351</td>
 	<td class='coveredLight'><pre>            <span class="keyword">if</span> (i &gt; 0) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>352</td>
 	<td class='coveredLight'><pre>                name = desc.substring(0, i).trim();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>353</td>
 	<td class='coveredLight'><pre>                args = desc.substring(i + 1).trim();</pre></td>
</tr>
<tr>
 	<td class=''>354</td>
 	<td class=''><pre>            }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>355</td>
 	<td class='coveredLight'><pre>            <span class="keyword">final</span> FormatFactory factory = registry.get(name);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>356</td>
 	<td class='coveredLight'><pre>            <span class="keyword">if</span> (factory != <span class="keyword">null</span>) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>357</td>
 	<td class='coveredLight'><pre>                <span class="keyword">return</span> factory.getFormat(name, args, getLocale());</pre></td>
</tr>
<tr>
 	<td class=''>358</td>
 	<td class=''><pre>            }</pre></td>
</tr>
<tr>
 	<td class=''>359</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>360</td>
 	<td class='coveredLight'><pre>        <span class="keyword">return</span> <span class="keyword">null</span>;</pre></td>
</tr>
<tr>
 	<td class=''>361</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>362</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>363</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>364</td>
 	<td class=''><pre><span class="comment">     * Read the argument index from the current format element.</span></pre></td>
</tr>
<tr>
 	<td class=''>365</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>366</td>
 	<td class=''><pre><span class="comment">     * @param pattern pattern to parse</span></pre></td>
</tr>
<tr>
 	<td class=''>367</td>
 	<td class=''><pre><span class="comment">     * @param pos current parse position</span></pre></td>
</tr>
<tr>
 	<td class=''>368</td>
 	<td class=''><pre><span class="comment">     * @return argument index</span></pre></td>
</tr>
<tr>
 	<td class=''>369</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>370</td>
 	<td class=''><pre>    <span class="keyword">private</span> <span class="keyword">int</span> readArgumentIndex(<span class="keyword">final</span> String pattern, <span class="keyword">final</span> ParsePosition pos) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>371</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> <span class="keyword">int</span> start = pos.getIndex();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>372</td>
 	<td class='coveredLight'><pre>        seekNonWs(pattern, pos);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>373</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> StringBuilder result = <span class="keyword">new</span> StringBuilder();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>374</td>
 	<td class='coveredLight'><pre>        <span class="keyword">boolean</span> error = <span class="keyword">false</span>;</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>375</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">for</span> (; !error &amp;&amp; pos.getIndex() &lt; pattern.length(); next(pos)) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>376</td>
 	<td class='coveredLight'><pre>            <span class="keyword">char</span> c = pattern.charAt(pos.getIndex());</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>377</td>
 	<td class='notCoveredLight'><pre>            <span class="keyword">if</span> (Character.isWhitespace(c)) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>378</td>
 	<td class='notCoveredLight'><pre>                seekNonWs(pattern, pos);</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>379</td>
 	<td class='notCoveredLight'><pre>                c = pattern.charAt(pos.getIndex());</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>380</td>
 	<td class='notCoveredLight'><pre>                <span class="keyword">if</span> (c != START_FMT &amp;&amp; c != END_FE) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>381</td>
 	<td class='notCoveredLight'><pre>                    error = <span class="keyword">true</span>;</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>382</td>
 	<td class='notCoveredLight'><pre>                    <span class="keyword">continue</span>;</pre></td>
</tr>
<tr>
 	<td class=''>383</td>
 	<td class=''><pre>                }</pre></td>
</tr>
<tr>
 	<td class=''>384</td>
 	<td class=''><pre>            }</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>385</td>
 	<td class='notCoveredLight'><pre>            <span class="keyword">if</span> ((c == START_FMT || c == END_FE) &amp;&amp; result.length() &gt; 0) {</pre></td>
</tr>
<tr>
 	<td class=''>386</td>
 	<td class=''><pre>                <span class="keyword">try</span> {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>387</td>
 	<td class='coveredLight'><pre>                    <span class="keyword">return</span> Integer.parseInt(result.toString());</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>388</td>
 	<td class='notCoveredLight'><pre>                } <span class="keyword">catch</span> (<span class="keyword">final</span> NumberFormatException e) { <span class="comment">// NOPMD</span></pre></td>
</tr>
<tr>
 	<td class=''>389</td>
 	<td class=''><pre>                    <span class="comment">// we've already ensured only digits, so unless something</span></pre></td>
</tr>
<tr>
 	<td class=''>390</td>
 	<td class=''><pre>                    <span class="comment">// outlandishly large was specified we should be okay.</span></pre></td>
</tr>
<tr>
 	<td class=''>391</td>
 	<td class=''><pre>                }</pre></td>
</tr>
<tr>
 	<td class=''>392</td>
 	<td class=''><pre>            }</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>393</td>
 	<td class='notCoveredLight'><pre>            error = !Character.isDigit(c);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>394</td>
 	<td class='coveredLight'><pre>            result.append(c);</pre></td>
</tr>
<tr>
 	<td class=''>395</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>396</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">if</span> (error) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>397</td>
 	<td class='notCoveredLight'><pre>            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</pre></td>
</tr>
<tr>
 	<td class=''>398</td>
 	<td class=''><pre>                    <span class="string">"Invalid format argument index at position "</span> + start + <span class="string">": "</span></pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>399</td>
 	<td class='notCoveredLight'><pre>                            + pattern.substring(start, pos.getIndex()));</pre></td>
</tr>
<tr>
 	<td class=''>400</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>401</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</pre></td>
</tr>
<tr>
 	<td class=''>402</td>
 	<td class=''><pre>                <span class="string">"Unterminated format element at position "</span> + start);</pre></td>
</tr>
<tr>
 	<td class=''>403</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>404</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>405</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>406</td>
 	<td class=''><pre><span class="comment">     * Parse the format component of a format element.</span></pre></td>
</tr>
<tr>
 	<td class=''>407</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>408</td>
 	<td class=''><pre><span class="comment">     * @param pattern string to parse</span></pre></td>
</tr>
<tr>
 	<td class=''>409</td>
 	<td class=''><pre><span class="comment">     * @param pos current parse position</span></pre></td>
</tr>
<tr>
 	<td class=''>410</td>
 	<td class=''><pre><span class="comment">     * @return Format description String</span></pre></td>
</tr>
<tr>
 	<td class=''>411</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>412</td>
 	<td class=''><pre>    <span class="keyword">private</span> String parseFormatDescription(<span class="keyword">final</span> String pattern, <span class="keyword">final</span> ParsePosition pos) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>413</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> <span class="keyword">int</span> start = pos.getIndex();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>414</td>
 	<td class='coveredLight'><pre>        seekNonWs(pattern, pos);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>415</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> <span class="keyword">int</span> text = pos.getIndex();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>416</td>
 	<td class='coveredLight'><pre>        <span class="keyword">int</span> depth = 1;</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>417</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">for</span> (; pos.getIndex() &lt; pattern.length(); next(pos)) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>418</td>
 	<td class='notCoveredLight'><pre>            <span class="keyword">switch</span> (pattern.charAt(pos.getIndex())) {</pre></td>
</tr>
<tr>
 	<td class=''>419</td>
 	<td class=''><pre>            <span class="keyword">case</span> START_FE:</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>420</td>
 	<td class='coveredLight'><pre>                depth++;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>421</td>
 	<td class='coveredLight'><pre>                <span class="keyword">break</span>;</pre></td>
</tr>
<tr>
 	<td class=''>422</td>
 	<td class=''><pre>            <span class="keyword">case</span> END_FE:</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>423</td>
 	<td class='coveredLight'><pre>                depth--;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>424</td>
 	<td class='coveredLight'><pre>                <span class="keyword">if</span> (depth == 0) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>425</td>
 	<td class='coveredLight'><pre>                    <span class="keyword">return</span> pattern.substring(text, pos.getIndex());</pre></td>
</tr>
<tr>
 	<td class=''>426</td>
 	<td class=''><pre>                }</pre></td>
</tr>
<tr>
 	<td class=''>427</td>
 	<td class=''><pre>                <span class="keyword">break</span>;</pre></td>
</tr>
<tr>
 	<td class=''>428</td>
 	<td class=''><pre>            <span class="keyword">case</span> QUOTE:</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>429</td>
 	<td class='notCoveredLight'><pre>                getQuotedString(pattern, pos);</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>430</td>
 	<td class='notCoveredLight'><pre>                <span class="keyword">break</span>;</pre></td>
</tr>
<tr>
 	<td class=''>431</td>
 	<td class=''><pre>            <span class="keyword">default</span>:</pre></td>
</tr>
<tr>
 	<td class=''>432</td>
 	<td class=''><pre>                <span class="keyword">break</span>;</pre></td>
</tr>
<tr>
 	<td class=''>433</td>
 	<td class=''><pre>            }</pre></td>
</tr>
<tr>
 	<td class=''>434</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>435</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</pre></td>
</tr>
<tr>
 	<td class=''>436</td>
 	<td class=''><pre>                <span class="string">"Unterminated format element at position "</span> + start);</pre></td>
</tr>
<tr>
 	<td class=''>437</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>438</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>439</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>440</td>
 	<td class=''><pre><span class="comment">     * Insert formats back into the pattern for toPattern() support.</span></pre></td>
</tr>
<tr>
 	<td class=''>441</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>442</td>
 	<td class=''><pre><span class="comment">     * @param pattern source</span></pre></td>
</tr>
<tr>
 	<td class=''>443</td>
 	<td class=''><pre><span class="comment">     * @param customPatterns The custom patterns to re-insert, if any</span></pre></td>
</tr>
<tr>
 	<td class=''>444</td>
 	<td class=''><pre><span class="comment">     * @return full pattern</span></pre></td>
</tr>
<tr>
 	<td class=''>445</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>446</td>
 	<td class=''><pre>    <span class="keyword">private</span> String insertFormats(<span class="keyword">final</span> String pattern, <span class="keyword">final</span> ArrayList&lt;String&gt; customPatterns) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>447</td>
 	<td class='coveredLight'><pre>        <span class="keyword">if</span> (!containsElements(customPatterns)) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>448</td>
 	<td class='coveredLight'><pre>            <span class="keyword">return</span> pattern;</pre></td>
</tr>
<tr>
 	<td class=''>449</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>450</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> StringBuilder sb = <span class="keyword">new</span> StringBuilder(pattern.length() * 2);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>451</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> ParsePosition pos = <span class="keyword">new</span> ParsePosition(0);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>452</td>
 	<td class='coveredLight'><pre>        <span class="keyword">int</span> fe = -1;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>453</td>
 	<td class='coveredLight'><pre>        <span class="keyword">int</span> depth = 0;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>454</td>
 	<td class='coveredLight'><pre>        <span class="keyword">while</span> (pos.getIndex() &lt; pattern.length()) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>455</td>
 	<td class='coveredLight'><pre>            <span class="keyword">final</span> <span class="keyword">char</span> c = pattern.charAt(pos.getIndex());</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>456</td>
 	<td class='coveredLight'><pre>            <span class="keyword">switch</span> (c) {</pre></td>
</tr>
<tr>
 	<td class=''>457</td>
 	<td class=''><pre>            <span class="keyword">case</span> QUOTE:</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>458</td>
 	<td class='coveredLight'><pre>                appendQuotedString(pattern, pos, sb);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>459</td>
 	<td class='coveredLight'><pre>                <span class="keyword">break</span>;</pre></td>
</tr>
<tr>
 	<td class=''>460</td>
 	<td class=''><pre>            <span class="keyword">case</span> START_FE:</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>461</td>
 	<td class='coveredLight'><pre>                depth++;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>462</td>
 	<td class='coveredLight'><pre>                sb.append(START_FE).append(readArgumentIndex(pattern, next(pos)));</pre></td>
</tr>
<tr>
 	<td class=''>463</td>
 	<td class=''><pre>                <span class="comment">// do not look for custom patterns when they are embedded, e.g. in a choice</span></pre></td>
</tr>
<tr>
 	<td class='coveredLight'>464</td>
 	<td class='coveredLight'><pre>                <span class="keyword">if</span> (depth == 1) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>465</td>
 	<td class='coveredLight'><pre>                    fe++;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>466</td>
 	<td class='coveredLight'><pre>                    <span class="keyword">final</span> String customPattern = customPatterns.get(fe);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>467</td>
 	<td class='coveredLight'><pre>                    <span class="keyword">if</span> (customPattern != <span class="keyword">null</span>) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>468</td>
 	<td class='coveredLight'><pre>                        sb.append(START_FMT).append(customPattern);</pre></td>
</tr>
<tr>
 	<td class=''>469</td>
 	<td class=''><pre>                    }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>470</td>
 	<td class='coveredLight'><pre>                }</pre></td>
</tr>
<tr>
 	<td class=''>471</td>
 	<td class=''><pre>                <span class="keyword">break</span>;</pre></td>
</tr>
<tr>
 	<td class=''>472</td>
 	<td class=''><pre>            <span class="keyword">case</span> END_FE:</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>473</td>
 	<td class='coveredLight'><pre>                depth--;</pre></td>
</tr>
<tr>
 	<td class=''>474</td>
 	<td class=''><pre>                <span class="comment">//$FALL-THROUGH$</span></pre></td>
</tr>
<tr>
 	<td class=''>475</td>
 	<td class=''><pre>            <span class="keyword">default</span>:</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>476</td>
 	<td class='coveredLight'><pre>                sb.append(c);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>477</td>
 	<td class='coveredLight'><pre>                next(pos);</pre></td>
</tr>
<tr>
 	<td class=''>478</td>
 	<td class=''><pre>            }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>479</td>
 	<td class='coveredLight'><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>480</td>
 	<td class='coveredLight'><pre>        <span class="keyword">return</span> sb.toString();</pre></td>
</tr>
<tr>
 	<td class=''>481</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>482</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>483</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>484</td>
 	<td class=''><pre><span class="comment">     * Consume whitespace from the current parse position.</span></pre></td>
</tr>
<tr>
 	<td class=''>485</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>486</td>
 	<td class=''><pre><span class="comment">     * @param pattern String to read</span></pre></td>
</tr>
<tr>
 	<td class=''>487</td>
 	<td class=''><pre><span class="comment">     * @param pos current position</span></pre></td>
</tr>
<tr>
 	<td class=''>488</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>489</td>
 	<td class=''><pre>    <span class="keyword">private</span> <span class="keyword">void</span> seekNonWs(<span class="keyword">final</span> String pattern, <span class="keyword">final</span> ParsePosition pos) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>490</td>
 	<td class='coveredLight'><pre>        <span class="keyword">int</span> len = 0;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>491</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> <span class="keyword">char</span>[] buffer = pattern.toCharArray();</pre></td>
</tr>
<tr>
 	<td class=''>492</td>
 	<td class=''><pre>        <span class="keyword">do</span> {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>493</td>
 	<td class='coveredLight'><pre>            len = StrMatcher.splitMatcher().isMatch(buffer, pos.getIndex());</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>494</td>
 	<td class='coveredLight'><pre>            pos.setIndex(pos.getIndex() + len);</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>495</td>
 	<td class='notCoveredLight'><pre>        } <span class="keyword">while</span> (len &gt; 0 &amp;&amp; pos.getIndex() &lt; pattern.length());</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>496</td>
 	<td class='coveredLight'><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>497</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>498</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>499</td>
 	<td class=''><pre><span class="comment">     * Convenience method to advance parse position by 1.</span></pre></td>
</tr>
<tr>
 	<td class=''>500</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>501</td>
 	<td class=''><pre><span class="comment">     * @param pos ParsePosition</span></pre></td>
</tr>
<tr>
 	<td class=''>502</td>
 	<td class=''><pre><span class="comment">     * @return &lt;code&gt;pos&lt;/code&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>503</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>504</td>
 	<td class=''><pre>    <span class="keyword">private</span> ParsePosition next(<span class="keyword">final</span> ParsePosition pos) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>505</td>
 	<td class='coveredLight'><pre>        pos.setIndex(pos.getIndex() + 1);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>506</td>
 	<td class='coveredLight'><pre>        <span class="keyword">return</span> pos;</pre></td>
</tr>
<tr>
 	<td class=''>507</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>508</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>509</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>510</td>
 	<td class=''><pre><span class="comment">     * Consume a quoted string, adding it to &lt;code&gt;appendTo&lt;/code&gt; if</span></pre></td>
</tr>
<tr>
 	<td class=''>511</td>
 	<td class=''><pre><span class="comment">     * specified.</span></pre></td>
</tr>
<tr>
 	<td class=''>512</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>513</td>
 	<td class=''><pre><span class="comment">     * @param pattern pattern to parse</span></pre></td>
</tr>
<tr>
 	<td class=''>514</td>
 	<td class=''><pre><span class="comment">     * @param pos current parse position</span></pre></td>
</tr>
<tr>
 	<td class=''>515</td>
 	<td class=''><pre><span class="comment">     * @param appendTo optional StringBuilder to append</span></pre></td>
</tr>
<tr>
 	<td class=''>516</td>
 	<td class=''><pre><span class="comment">     * @return &lt;code&gt;appendTo&lt;/code&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>517</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>518</td>
 	<td class=''><pre>    <span class="keyword">private</span> StringBuilder appendQuotedString(<span class="keyword">final</span> String pattern, <span class="keyword">final</span> ParsePosition pos,</pre></td>
</tr>
<tr>
 	<td class=''>519</td>
 	<td class=''><pre>            <span class="keyword">final</span> StringBuilder appendTo) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>520</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">assert</span> pattern.toCharArray()[pos.getIndex()] == QUOTE</pre></td>
</tr>
<tr>
 	<td class=''>521</td>
 	<td class=''><pre>                : <span class="string">"Quoted string must start with quote character"</span>;</pre></td>
</tr>
<tr>
 	<td class=''>522</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>523</td>
 	<td class=''><pre>        <span class="comment">// handle quote character at the beginning of the string</span></pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>524</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">if</span> (appendTo != <span class="keyword">null</span>) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>525</td>
 	<td class='coveredLight'><pre>            appendTo.append(QUOTE);</pre></td>
</tr>
<tr>
 	<td class=''>526</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>527</td>
 	<td class='coveredLight'><pre>        next(pos);</pre></td>
</tr>
<tr>
 	<td class=''>528</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class='coveredLight'>529</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> <span class="keyword">int</span> start = pos.getIndex();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>530</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> <span class="keyword">char</span>[] c = pattern.toCharArray();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>531</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> <span class="keyword">int</span> lastHold = start;</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>532</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">for</span> (<span class="keyword">int</span> i = pos.getIndex(); i &lt; pattern.length(); i++) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>533</td>
 	<td class='coveredLight'><pre>            <span class="keyword">switch</span> (c[pos.getIndex()]) {</pre></td>
</tr>
<tr>
 	<td class=''>534</td>
 	<td class=''><pre>            <span class="keyword">case</span> QUOTE:</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>535</td>
 	<td class='coveredLight'><pre>                next(pos);</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>536</td>
 	<td class='notCoveredLight'><pre>                <span class="keyword">return</span> appendTo == <span class="keyword">null</span> ? <span class="keyword">null</span> : appendTo.append(c, lastHold,</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>537</td>
 	<td class='coveredLight'><pre>                        pos.getIndex() - lastHold);</pre></td>
</tr>
<tr>
 	<td class=''>538</td>
 	<td class=''><pre>            <span class="keyword">default</span>:</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>539</td>
 	<td class='coveredLight'><pre>                next(pos);</pre></td>
</tr>
<tr>
 	<td class=''>540</td>
 	<td class=''><pre>            }</pre></td>
</tr>
<tr>
 	<td class=''>541</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>542</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</pre></td>
</tr>
<tr>
 	<td class=''>543</td>
 	<td class=''><pre>                <span class="string">"Unterminated quoted string at position "</span> + start);</pre></td>
</tr>
<tr>
 	<td class=''>544</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>545</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>546</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>547</td>
 	<td class=''><pre><span class="comment">     * Consume quoted string only.</span></pre></td>
</tr>
<tr>
 	<td class=''>548</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>549</td>
 	<td class=''><pre><span class="comment">     * @param pattern pattern to parse</span></pre></td>
</tr>
<tr>
 	<td class=''>550</td>
 	<td class=''><pre><span class="comment">     * @param pos current parse position</span></pre></td>
</tr>
<tr>
 	<td class=''>551</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>552</td>
 	<td class=''><pre>    <span class="keyword">private</span> <span class="keyword">void</span> getQuotedString(<span class="keyword">final</span> String pattern, <span class="keyword">final</span> ParsePosition pos) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>553</td>
 	<td class='notCoveredLight'><pre>        appendQuotedString(pattern, pos, <span class="keyword">null</span>);</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>554</td>
 	<td class='notCoveredLight'><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>555</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>556</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>557</td>
 	<td class=''><pre><span class="comment">     * Learn whether the specified Collection contains non-null elements.</span></pre></td>
</tr>
<tr>
 	<td class=''>558</td>
 	<td class=''><pre><span class="comment">     * @param coll to check</span></pre></td>
</tr>
<tr>
 	<td class=''>559</td>
 	<td class=''><pre><span class="comment">     * @return &lt;code&gt;true&lt;/code&gt; if some Object was found, &lt;code&gt;false&lt;/code&gt; otherwise.</span></pre></td>
</tr>
<tr>
 	<td class=''>560</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>561</td>
 	<td class=''><pre>    <span class="keyword">private</span> <span class="keyword">boolean</span> containsElements(<span class="keyword">final</span> Collection&lt;?&gt; coll) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>562</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">if</span> (coll == <span class="keyword">null</span> || coll.isEmpty()) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>563</td>
 	<td class='coveredLight'><pre>            <span class="keyword">return</span> <span class="keyword">false</span>;</pre></td>
</tr>
<tr>
 	<td class=''>564</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>565</td>
 	<td class='coveredLight'><pre>        <span class="keyword">for</span> (<span class="keyword">final</span> Object name : coll) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>566</td>
 	<td class='coveredLight'><pre>            <span class="keyword">if</span> (name != <span class="keyword">null</span>) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>567</td>
 	<td class='coveredLight'><pre>                <span class="keyword">return</span> <span class="keyword">true</span>;</pre></td>
</tr>
<tr>
 	<td class=''>568</td>
 	<td class=''><pre>            }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>569</td>
 	<td class='coveredLight'><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>570</td>
 	<td class='coveredLight'><pre>        <span class="keyword">return</span> <span class="keyword">false</span>;</pre></td>
</tr>
<tr>
 	<td class=''>571</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>572</td>
 	<td class=''><pre>}</pre></td>
</tr>
<table id='sourceDiffTable'  class='code'>
<tr>
 	<td>1</td>
 	<td>1</td>
 	<td><pre><span class="comment">/*</span></pre></td>
</tr>
<tr>
 	<td>2</td>
 	<td>2</td>
 	<td><pre><span class="comment"> * Licensed to the Apache Software Foundation (ASF) under one or more</span></pre></td>
</tr>
<tr>
 	<td>3</td>
 	<td>3</td>
 	<td><pre><span class="comment"> * contributor license agreements.  See the NOTICE file distributed with</span></pre></td>
</tr>
<tr>
 	<td>4</td>
 	<td>4</td>
 	<td><pre><span class="comment"> * this work for additional information regarding copyright ownership.</span></pre></td>
</tr>
<tr>
 	<td>5</td>
 	<td>5</td>
 	<td><pre><span class="comment"> * The ASF licenses this file to You under the Apache License, Version 2.0</span></pre></td>
</tr>
<tr>
 	<td>6</td>
 	<td>6</td>
 	<td><pre><span class="comment"> * (the "License"); you may not use this file except in compliance with</span></pre></td>
</tr>
<tr>
 	<td>7</td>
 	<td>7</td>
 	<td><pre><span class="comment"> * the License.  You may obtain a copy of the License at</span></pre></td>
</tr>
<tr>
 	<td>8</td>
 	<td>8</td>
 	<td><pre><span class="comment"> *</span></pre></td>
</tr>
<tr>
 	<td>9</td>
 	<td>9</td>
 	<td><pre><span class="comment"> *      http://www.apache.org/licenses/LICENSE-2.0</span></pre></td>
</tr>
<tr>
 	<td>10</td>
 	<td>10</td>
 	<td><pre><span class="comment"> *</span></pre></td>
</tr>
<tr>
 	<td>11</td>
 	<td>11</td>
 	<td><pre><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></pre></td>
</tr>
<tr>
 	<td>12</td>
 	<td>12</td>
 	<td><pre><span class="comment"> * distributed under the License is distributed on an "AS IS" BASIS,</span></pre></td>
</tr>
<tr>
 	<td>13</td>
 	<td>13</td>
 	<td><pre><span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></pre></td>
</tr>
<tr>
 	<td>14</td>
 	<td>14</td>
 	<td><pre><span class="comment"> * See the License for the specific language governing permissions and</span></pre></td>
</tr>
<tr>
 	<td>15</td>
 	<td>15</td>
 	<td><pre><span class="comment"> * limitations under the License.</span></pre></td>
</tr>
<tr>
 	<td>16</td>
 	<td>16</td>
 	<td><pre><span class="comment"> */</span></pre></td>
</tr>
<tr>
 	<td>17</td>
 	<td>17</td>
 	<td><pre><span class="keyword">package</span> org.apache.commons.text;</pre></td>
</tr>
<tr>
 	<td>18</td>
 	<td>18</td>
 	<td><pre></pre></td>
</tr>
<tr>
 	<td>19</td>
 	<td>19</td>
 	<td><pre><span class="keyword">import</span> java.text.Format;</pre></td>
</tr>
<tr>
 	<td>20</td>
 	<td>20</td>
 	<td><pre><span class="keyword">import</span> java.text.MessageFormat;</pre></td>
</tr>
<tr>
 	<td>21</td>
 	<td>21</td>
 	<td><pre><span class="keyword">import</span> java.text.ParsePosition;</pre></td>
</tr>
<tr>
 	<td>22</td>
 	<td>22</td>
 	<td><pre><span class="keyword">import</span> java.util.ArrayList;</pre></td>
</tr>
<tr>
 	<td>23</td>
 	<td>23</td>
 	<td><pre><span class="keyword">import</span> java.util.Collection;</pre></td>
</tr>
<tr>
 	<td>24</td>
 	<td>24</td>
 	<td><pre><span class="keyword">import</span> java.util.Iterator;</pre></td>
</tr>
<tr>
 	<td>25</td>
 	<td>25</td>
 	<td><pre><span class="keyword">import</span> java.util.Locale;</pre></td>
</tr>
<tr>
 	<td class='left bottom top'></td>
 	<td class=' bottom top'>26</td>
 	<td class='right bottom top'><pre><span class="keyword">import</span> java.util.Locale.Category;</pre></td>
</tr>
<tr>
 	<td>26</td>
 	<td>27</td>
 	<td><pre><span class="keyword">import</span> java.util.Map;</pre></td>
</tr>
<tr>
 	<td>27</td>
 	<td>28</td>
 	<td><pre><span class="keyword">import</span> java.util.Objects;</pre></td>
</tr>
<tr>
 	<td>28</td>
 	<td>29</td>
 	<td><pre></pre></td>
</tr>
<tr>
 	<td>29</td>
 	<td>30</td>
 	<td><pre><span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td>30</td>
 	<td>31</td>
 	<td><pre><span class="comment"> * Extends &lt;code&gt;java.text.MessageFormat&lt;/code&gt; to allow pluggable/additional formatting</span></pre></td>
</tr>
<tr>
 	<td>31</td>
 	<td>32</td>
 	<td><pre><span class="comment"> * options for embedded format elements.  Client code should specify a registry</span></pre></td>
</tr>
<tr>
 	<td>32</td>
 	<td>33</td>
 	<td><pre><span class="comment"> * of &lt;code&gt;FormatFactory&lt;/code&gt; instances associated with &lt;code&gt;String&lt;/code&gt;</span></pre></td>
</tr>
<tr>
 	<td>33</td>
 	<td>34</td>
 	<td><pre><span class="comment"> * format names.  This registry will be consulted when the format elements are</span></pre></td>
</tr>
<tr>
 	<td>34</td>
 	<td>35</td>
 	<td><pre><span class="comment"> * parsed from the message pattern.  In this way custom patterns can be specified,</span></pre></td>
</tr>
<tr>
 	<td>35</td>
 	<td>36</td>
 	<td><pre><span class="comment"> * and the formats supported by &lt;code&gt;java.text.MessageFormat&lt;/code&gt; can be overridden</span></pre></td>
</tr>
<tr>
 	<td>36</td>
 	<td>37</td>
 	<td><pre><span class="comment"> * at the format and/or format style level (see MessageFormat).  A "format element"</span></pre></td>
</tr>
<tr>
 	<td>37</td>
 	<td>38</td>
 	<td><pre><span class="comment"> * embedded in the message pattern is specified (&lt;b&gt;()?&lt;/b&gt; signifies optionality):&lt;br&gt;</span></pre></td>
</tr>
<tr>
 	<td>38</td>
 	<td>39</td>
 	<td><pre><span class="comment"> * &lt;code&gt;{&lt;/code&gt;&lt;i&gt;argument-number&lt;/i&gt;&lt;b&gt;(&lt;/b&gt;&lt;code&gt;,&lt;/code&gt;&lt;i&gt;format-name&lt;/i&gt;&lt;b&gt;</span></pre></td>
</tr>
<tr>
 	<td>39</td>
 	<td>40</td>
 	<td><pre><span class="comment"> * (&lt;/b&gt;&lt;code&gt;,&lt;/code&gt;&lt;i&gt;format-style&lt;/i&gt;&lt;b&gt;)?)?&lt;/b&gt;&lt;code&gt;}&lt;/code&gt;</span></pre></td>
</tr>
<tr>
 	<td>40</td>
 	<td>41</td>
 	<td><pre><span class="comment"> *</span></pre></td>
</tr>
<tr>
 	<td>41</td>
 	<td>42</td>
 	<td><pre><span class="comment"> * &lt;p&gt;</span></pre></td>
</tr>
<tr>
 	<td>42</td>
 	<td>43</td>
 	<td><pre><span class="comment"> * &lt;i&gt;format-name&lt;/i&gt; and &lt;i&gt;format-style&lt;/i&gt; values are trimmed of surrounding whitespace</span></pre></td>
</tr>
<tr>
 	<td>43</td>
 	<td>44</td>
 	<td><pre><span class="comment"> * in the manner of &lt;code&gt;java.text.MessageFormat&lt;/code&gt;.  If &lt;i&gt;format-name&lt;/i&gt; denotes</span></pre></td>
</tr>
<tr>
 	<td>44</td>
 	<td>45</td>
 	<td><pre><span class="comment"> * &lt;code&gt;FormatFactory formatFactoryInstance&lt;/code&gt; in &lt;code&gt;registry&lt;/code&gt;, a &lt;code&gt;Format&lt;/code&gt;</span></pre></td>
</tr>
<tr>
 	<td>45</td>
 	<td>46</td>
 	<td><pre><span class="comment"> * matching &lt;i&gt;format-name&lt;/i&gt; and &lt;i&gt;format-style&lt;/i&gt; is requested from</span></pre></td>
</tr>
<tr>
 	<td>46</td>
 	<td>47</td>
 	<td><pre><span class="comment"> * &lt;code&gt;formatFactoryInstance&lt;/code&gt;.  If this is successful, the &lt;code&gt;Format&lt;/code&gt;</span></pre></td>
</tr>
<tr>
 	<td>47</td>
 	<td>48</td>
 	<td><pre><span class="comment"> * found is used for this format element.</span></pre></td>
</tr>
<tr>
 	<td>48</td>
 	<td>49</td>
 	<td><pre><span class="comment"> * &lt;/p&gt;</span></pre></td>
</tr>
<tr>
 	<td>49</td>
 	<td>50</td>
 	<td><pre><span class="comment"> *</span></pre></td>
</tr>
<tr>
 	<td>50</td>
 	<td>51</td>
 	<td><pre><span class="comment"> * &lt;p&gt;&lt;b&gt;NOTICE:&lt;/b&gt; The various subformat mutator methods are considered unnecessary; they exist on the parent</span></pre></td>
</tr>
<tr>
 	<td>51</td>
 	<td>52</td>
 	<td><pre><span class="comment"> * class to allow the type of customization which it is the job of this class to provide in</span></pre></td>
</tr>
<tr>
 	<td>52</td>
 	<td>53</td>
 	<td><pre><span class="comment"> * a configurable fashion.  These methods have thus been disabled and will throw</span></pre></td>
</tr>
<tr>
 	<td>53</td>
 	<td>54</td>
 	<td><pre><span class="comment"> * &lt;code&gt;UnsupportedOperationException&lt;/code&gt; if called.</span></pre></td>
</tr>
<tr>
 	<td>54</td>
 	<td>55</td>
 	<td><pre><span class="comment"> * &lt;/p&gt;</span></pre></td>
</tr>
<tr>
 	<td>55</td>
 	<td>56</td>
 	<td><pre><span class="comment"> *</span></pre></td>
</tr>
<tr>
 	<td>56</td>
 	<td>57</td>
 	<td><pre><span class="comment"> * &lt;p&gt;Limitations inherited from &lt;code&gt;java.text.MessageFormat&lt;/code&gt;:&lt;/p&gt;</span></pre></td>
</tr>
<tr>
 	<td>57</td>
 	<td>58</td>
 	<td><pre><span class="comment"> * &lt;ul&gt;</span></pre></td>
</tr>
<tr>
 	<td>58</td>
 	<td>59</td>
 	<td><pre><span class="comment"> * &lt;li&gt;When using "choice" subformats, support for nested formatting instructions is limited</span></pre></td>
</tr>
<tr>
 	<td>59</td>
 	<td>60</td>
 	<td><pre><span class="comment"> *     to that provided by the base class.&lt;/li&gt;</span></pre></td>
</tr>
<tr>
 	<td>60</td>
 	<td>61</td>
 	<td><pre><span class="comment"> * &lt;li&gt;Thread-safety of &lt;code&gt;Format&lt;/code&gt;s, including &lt;code&gt;MessageFormat&lt;/code&gt; and thus</span></pre></td>
</tr>
<tr>
 	<td>61</td>
 	<td>62</td>
 	<td><pre><span class="comment"> *     &lt;code&gt;ExtendedMessageFormat&lt;/code&gt;, is not guaranteed.&lt;/li&gt;</span></pre></td>
</tr>
<tr>
 	<td>62</td>
 	<td>63</td>
 	<td><pre><span class="comment"> * &lt;/ul&gt;</span></pre></td>
</tr>
<tr>
 	<td>63</td>
 	<td>64</td>
 	<td><pre><span class="comment"> *</span></pre></td>
</tr>
<tr>
 	<td>64</td>
 	<td>65</td>
 	<td><pre><span class="comment"> * @since 1.0</span></pre></td>
</tr>
<tr>
 	<td>65</td>
 	<td>66</td>
 	<td><pre><span class="comment"> */</span></pre></td>
</tr>
<tr>
 	<td>66</td>
 	<td>67</td>
 	<td><pre><span class="keyword">public</span> <span class="keyword">class</span> ExtendedMessageFormat <span class="keyword">extends</span> MessageFormat {</pre></td>
</tr>
<tr>
 	<td>67</td>
 	<td>68</td>
 	<td><pre></pre></td>
</tr>
<tr>
 	<td>68</td>
 	<td>69</td>
 	<td><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td>69</td>
 	<td>70</td>
 	<td><pre><span class="comment">     * Serializable Object.</span></pre></td>
</tr>
<tr>
 	<td>70</td>
 	<td>71</td>
 	<td><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td>71</td>
 	<td>72</td>
 	<td><pre>    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -2362048321261811743L;</pre></td>
</tr>
<tr>
 	<td>72</td>
 	<td>73</td>
 	<td><pre></pre></td>
</tr>
<tr>
 	<td>73</td>
 	<td>74</td>
 	<td><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td>74</td>
 	<td>75</td>
 	<td><pre><span class="comment">     * Our initial seed value for calculating hashes.</span></pre></td>
</tr>
<tr>
 	<td>75</td>
 	<td>76</td>
 	<td><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td>76</td>
 	<td>77</td>
 	<td><pre>    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> HASH_SEED = 31;</pre></td>
</tr>
<tr>
 	<td>77</td>
 	<td>78</td>
 	<td><pre></pre></td>
</tr>
<tr>
 	<td>78</td>
 	<td>79</td>
 	<td><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td>79</td>
 	<td>80</td>
 	<td><pre><span class="comment">     * The empty string.</span></pre></td>
</tr>
<tr>
 	<td>80</td>
 	<td>81</td>
 	<td><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td>81</td>
 	<td>82</td>
 	<td><pre>    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DUMMY_PATTERN = <span class="string">""</span>;</pre></td>
</tr>
<tr>
 	<td>82</td>
 	<td>83</td>
 	<td><pre></pre></td>
</tr>
<tr>
 	<td>83</td>
 	<td>84</td>
 	<td><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td>84</td>
 	<td>85</td>
 	<td><pre><span class="comment">     * A comma.</span></pre></td>
</tr>
<tr>
 	<td>85</td>
 	<td>86</td>
 	<td><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td>86</td>
 	<td>87</td>
 	<td><pre>    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span> START_FMT = <span class="string">','</span>;</pre></td>
</tr>
<tr>
 	<td>87</td>
 	<td>88</td>
 	<td><pre></pre></td>
</tr>
<tr>
 	<td>88</td>
 	<td>89</td>
 	<td><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td>89</td>
 	<td>90</td>
 	<td><pre><span class="comment">     * A right side squigly brace.</span></pre></td>
</tr>
<tr>
 	<td>90</td>
 	<td>91</td>
 	<td><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td>91</td>
 	<td>92</td>
 	<td><pre>    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span> END_FE = <span class="string">'}'</span>;</pre></td>
</tr>
<tr>
 	<td>92</td>
 	<td>93</td>
 	<td><pre></pre></td>
</tr>
<tr>
 	<td>93</td>
 	<td>94</td>
 	<td><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td>94</td>
 	<td>95</td>
 	<td><pre><span class="comment">     * A left side squigly brace.</span></pre></td>
</tr>
<tr>
 	<td>95</td>
 	<td>96</td>
 	<td><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td>96</td>
 	<td>97</td>
 	<td><pre>    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span> START_FE = <span class="string">'{'</span>;</pre></td>
</tr>
<tr>
 	<td>97</td>
 	<td>98</td>
 	<td><pre></pre></td>
</tr>
<tr>
 	<td>98</td>
 	<td>99</td>
 	<td><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td>99</td>
 	<td>100</td>
 	<td><pre><span class="comment">     * A properly escaped character representing a single quote.</span></pre></td>
</tr>
<tr>
 	<td>100</td>
 	<td>101</td>
 	<td><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td>101</td>
 	<td>102</td>
 	<td><pre>    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span> QUOTE = <span class="string">'\''</span>;</pre></td>
</tr>
<tr>
 	<td>102</td>
 	<td>103</td>
 	<td><pre></pre></td>
</tr>
<tr>
 	<td>103</td>
 	<td>104</td>
 	<td><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td>104</td>
 	<td>105</td>
 	<td><pre><span class="comment">     * To pattern string.</span></pre></td>
</tr>
<tr>
 	<td>105</td>
 	<td>106</td>
 	<td><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td>106</td>
 	<td>107</td>
 	<td><pre>    <span class="keyword">private</span> String toPattern;</pre></td>
</tr>
<tr>
 	<td>107</td>
 	<td>108</td>
 	<td><pre></pre></td>
</tr>
<tr>
 	<td>108</td>
 	<td>109</td>
 	<td><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td>109</td>
 	<td>110</td>
 	<td><pre><span class="comment">     * Our registry of FormatFactory's.</span></pre></td>
</tr>
<tr>
 	<td>110</td>
 	<td>111</td>
 	<td><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td>111</td>
 	<td>112</td>
 	<td><pre>    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, ? <span class="keyword">extends</span> FormatFactory&gt; registry;</pre></td>
</tr>
<tr>
 	<td>112</td>
 	<td>113</td>
 	<td><pre></pre></td>
</tr>
<tr>
 	<td>113</td>
 	<td>114</td>
 	<td><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td>114</td>
 	<td>115</td>
 	<td><pre><span class="comment">     * Create a new ExtendedMessageFormat for the default locale.</span></pre></td>
</tr>
<tr>
 	<td>115</td>
 	<td>116</td>
 	<td><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td>116</td>
 	<td>117</td>
 	<td><pre><span class="comment">     * @param pattern  the pattern to use, not null</span></pre></td>
</tr>
<tr>
 	<td>117</td>
 	<td>118</td>
 	<td><pre><span class="comment">     * @throws IllegalArgumentException in case of a bad pattern.</span></pre></td>
</tr>
<tr>
 	<td>118</td>
 	<td>119</td>
 	<td><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td>119</td>
 	<td>120</td>
 	<td><pre>    <span class="keyword">public</span> ExtendedMessageFormat(<span class="keyword">final</span> String pattern) {</pre></td>
</tr>
<tr>
 	<td class='deletedRow'>120</td>
 	<td class='deletedRow'></td>
 	<td class='deletedRow'><pre>        this(pattern, Locale.getDefault());</pre></td>
</tr>
<tr>
 	<td class='left bottom top'></td>
 	<td class=' bottom top'>121</td>
 	<td class='right bottom top'><pre>        <span class="keyword">this</span>(pattern, Locale.getDefault(Category.FORMAT));</pre></td>
</tr>
<tr>
 	<td>121</td>
 	<td>122</td>
 	<td><pre>    }</pre></td>
</tr>
<tr>
 	<td>122</td>
 	<td>123</td>
 	<td><pre></pre></td>
</tr>
<tr>
 	<td>123</td>
 	<td>124</td>
 	<td><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td>124</td>
 	<td>125</td>
 	<td><pre><span class="comment">     * Create a new ExtendedMessageFormat.</span></pre></td>
</tr>
<tr>
 	<td>125</td>
 	<td>126</td>
 	<td><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td>126</td>
 	<td>127</td>
 	<td><pre><span class="comment">     * @param pattern  the pattern to use, not null</span></pre></td>
</tr>
<tr>
 	<td>127</td>
 	<td>128</td>
 	<td><pre><span class="comment">     * @param locale  the locale to use, not null</span></pre></td>
</tr>
<tr>
 	<td>128</td>
 	<td>129</td>
 	<td><pre><span class="comment">     * @throws IllegalArgumentException in case of a bad pattern.</span></pre></td>
</tr>
<tr>
 	<td>129</td>
 	<td>130</td>
 	<td><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td>130</td>
 	<td>131</td>
 	<td><pre>    <span class="keyword">public</span> ExtendedMessageFormat(<span class="keyword">final</span> String pattern, <span class="keyword">final</span> Locale locale) {</pre></td>
</tr>
<tr>
 	<td>131</td>
 	<td>132</td>
 	<td><pre>        <span class="keyword">this</span>(pattern, locale, <span class="keyword">null</span>);</pre></td>
</tr>
<tr>
 	<td>132</td>
 	<td>133</td>
 	<td><pre>    }</pre></td>
</tr>
<tr>
 	<td>133</td>
 	<td>134</td>
 	<td><pre></pre></td>
</tr>
<tr>
 	<td>134</td>
 	<td>135</td>
 	<td><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td>135</td>
 	<td>136</td>
 	<td><pre><span class="comment">     * Create a new ExtendedMessageFormat for the default locale.</span></pre></td>
</tr>
<tr>
 	<td>136</td>
 	<td>137</td>
 	<td><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td>137</td>
 	<td>138</td>
 	<td><pre><span class="comment">     * @param pattern  the pattern to use, not null</span></pre></td>
</tr>
<tr>
 	<td>138</td>
 	<td>139</td>
 	<td><pre><span class="comment">     * @param registry  the registry of format factories, may be null</span></pre></td>
</tr>
<tr>
 	<td>139</td>
 	<td>140</td>
 	<td><pre><span class="comment">     * @throws IllegalArgumentException in case of a bad pattern.</span></pre></td>
</tr>
<tr>
 	<td>140</td>
 	<td>141</td>
 	<td><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td>141</td>
 	<td>142</td>
 	<td><pre>    <span class="keyword">public</span> ExtendedMessageFormat(<span class="keyword">final</span> String pattern,</pre></td>
</tr>
<tr>
 	<td>142</td>
 	<td>143</td>
 	<td><pre>                                 <span class="keyword">final</span> Map&lt;String, ? <span class="keyword">extends</span> FormatFactory&gt; registry) {</pre></td>
</tr>
<tr>
 	<td class='deletedRow'>143</td>
 	<td class='deletedRow'></td>
 	<td class='deletedRow'><pre>        this(pattern, Locale.getDefault(), registry);</pre></td>
</tr>
<tr>
 	<td class='left bottom top'></td>
 	<td class=' bottom top'>144</td>
 	<td class='right bottom top'><pre>        <span class="keyword">this</span>(pattern, Locale.getDefault(Category.FORMAT), registry);</pre></td>
</tr>
<tr>
 	<td>144</td>
 	<td>145</td>
 	<td><pre>    }</pre></td>
</tr>
<tr>
 	<td>145</td>
 	<td>146</td>
 	<td><pre></pre></td>
</tr>
<tr>
 	<td>146</td>
 	<td>147</td>
 	<td><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td>147</td>
 	<td>148</td>
 	<td><pre><span class="comment">     * Create a new ExtendedMessageFormat.</span></pre></td>
</tr>
<tr>
 	<td>148</td>
 	<td>149</td>
 	<td><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td>149</td>
 	<td>150</td>
 	<td><pre><span class="comment">     * @param pattern  the pattern to use, not null</span></pre></td>
</tr>
<tr>
 	<td>150</td>
 	<td>151</td>
 	<td><pre><span class="comment">     * @param locale  the locale to use, not null</span></pre></td>
</tr>
<tr>
 	<td>151</td>
 	<td>152</td>
 	<td><pre><span class="comment">     * @param registry  the registry of format factories, may be null</span></pre></td>
</tr>
<tr>
 	<td>152</td>
 	<td>153</td>
 	<td><pre><span class="comment">     * @throws IllegalArgumentException in case of a bad pattern.</span></pre></td>
</tr>
<tr>
 	<td>153</td>
 	<td>154</td>
 	<td><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td>154</td>
 	<td>155</td>
 	<td><pre>    <span class="keyword">public</span> ExtendedMessageFormat(<span class="keyword">final</span> String pattern,</pre></td>
</tr>
<tr>
 	<td>155</td>
 	<td>156</td>
 	<td><pre>                                 <span class="keyword">final</span> Locale locale,</pre></td>
</tr>
<tr>
 	<td>156</td>
 	<td>157</td>
 	<td><pre>                                 <span class="keyword">final</span> Map&lt;String, ? <span class="keyword">extends</span> FormatFactory&gt; registry) {</pre></td>
</tr>
<tr>
 	<td>157</td>
 	<td>158</td>
 	<td><pre>        <span class="keyword">super</span>(DUMMY_PATTERN);</pre></td>
</tr>
<tr>
 	<td>158</td>
 	<td>159</td>
 	<td><pre>        setLocale(locale);</pre></td>
</tr>
<tr>
 	<td>159</td>
 	<td>160</td>
 	<td><pre>        <span class="keyword">this</span>.registry = registry;</pre></td>
</tr>
<tr>
 	<td>160</td>
 	<td>161</td>
 	<td><pre>        applyPattern(pattern);</pre></td>
</tr>
<tr>
 	<td>161</td>
 	<td>162</td>
 	<td><pre>    }</pre></td>
</tr>
<tr>
 	<td>162</td>
 	<td>163</td>
 	<td><pre></pre></td>
</tr>
<tr>
 	<td>163</td>
 	<td>164</td>
 	<td><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td>164</td>
 	<td>165</td>
 	<td><pre><span class="comment">     * {@inheritDoc}</span></pre></td>
</tr>
<tr>
 	<td>165</td>
 	<td>166</td>
 	<td><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td>166</td>
 	<td>167</td>
 	<td><pre>    @Override</pre></td>
</tr>
<tr>
 	<td>167</td>
 	<td>168</td>
 	<td><pre>    <span class="keyword">public</span> String toPattern() {</pre></td>
</tr>
<tr>
 	<td>168</td>
 	<td>169</td>
 	<td><pre>        <span class="keyword">return</span> toPattern;</pre></td>
</tr>
<tr>
 	<td>169</td>
 	<td>170</td>
 	<td><pre>    }</pre></td>
</tr>
<tr>
 	<td>170</td>
 	<td>171</td>
 	<td><pre></pre></td>
</tr>
<tr>
 	<td>171</td>
 	<td>172</td>
 	<td><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td>172</td>
 	<td>173</td>
 	<td><pre><span class="comment">     * Apply the specified pattern.</span></pre></td>
</tr>
<tr>
 	<td>173</td>
 	<td>174</td>
 	<td><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td>174</td>
 	<td>175</td>
 	<td><pre><span class="comment">     * @param pattern String</span></pre></td>
</tr>
<tr>
 	<td>175</td>
 	<td>176</td>
 	<td><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td>176</td>
 	<td>177</td>
 	<td><pre>    @Override</pre></td>
</tr>
<tr>
 	<td>177</td>
 	<td>178</td>
 	<td><pre>    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> applyPattern(<span class="keyword">final</span> String pattern) {</pre></td>
</tr>
<tr>
 	<td>178</td>
 	<td>179</td>
 	<td><pre>        <span class="keyword">if</span> (registry == <span class="keyword">null</span>) {</pre></td>
</tr>
<tr>
 	<td>179</td>
 	<td>180</td>
 	<td><pre>            <span class="keyword">super</span>.applyPattern(pattern);</pre></td>
</tr>
<tr>
 	<td>180</td>
 	<td>181</td>
 	<td><pre>            toPattern = <span class="keyword">super</span>.toPattern();</pre></td>
</tr>
<tr>
 	<td>181</td>
 	<td>182</td>
 	<td><pre>            <span class="keyword">return</span>;</pre></td>
</tr>
<tr>
 	<td>182</td>
 	<td>183</td>
 	<td><pre>        }</pre></td>
</tr>
<tr>
 	<td>183</td>
 	<td>184</td>
 	<td><pre>        <span class="keyword">final</span> ArrayList&lt;Format&gt; foundFormats = <span class="keyword">new</span> ArrayList&lt;&gt;();</pre></td>
</tr>
<tr>
 	<td>184</td>
 	<td>185</td>
 	<td><pre>        <span class="keyword">final</span> ArrayList&lt;String&gt; foundDescriptions = <span class="keyword">new</span> ArrayList&lt;&gt;();</pre></td>
</tr>
<tr>
 	<td>185</td>
 	<td>186</td>
 	<td><pre>        <span class="keyword">final</span> StringBuilder stripCustom = <span class="keyword">new</span> StringBuilder(pattern.length());</pre></td>
</tr>
<tr>
 	<td>186</td>
 	<td>187</td>
 	<td><pre></pre></td>
</tr>
<tr>
 	<td>187</td>
 	<td>188</td>
 	<td><pre>        <span class="keyword">final</span> ParsePosition pos = <span class="keyword">new</span> ParsePosition(0);</pre></td>
</tr>
<tr>
 	<td>188</td>
 	<td>189</td>
 	<td><pre>        <span class="keyword">final</span> <span class="keyword">char</span>[] c = pattern.toCharArray();</pre></td>
</tr>
<tr>
 	<td>189</td>
 	<td>190</td>
 	<td><pre>        <span class="keyword">int</span> fmtCount = 0;</pre></td>
</tr>
<tr>
 	<td>190</td>
 	<td>191</td>
 	<td><pre>        <span class="keyword">while</span> (pos.getIndex() &lt; pattern.length()) {</pre></td>
</tr>
<tr>
 	<td>191</td>
 	<td>192</td>
 	<td><pre>            <span class="keyword">switch</span> (c[pos.getIndex()]) {</pre></td>
</tr>
<tr>
 	<td>192</td>
 	<td>193</td>
 	<td><pre>            <span class="keyword">case</span> QUOTE:</pre></td>
</tr>
<tr>
 	<td>193</td>
 	<td>194</td>
 	<td><pre>                appendQuotedString(pattern, pos, stripCustom);</pre></td>
</tr>
<tr>
 	<td>194</td>
 	<td>195</td>
 	<td><pre>                <span class="keyword">break</span>;</pre></td>
</tr>
<tr>
 	<td>195</td>
 	<td>196</td>
 	<td><pre>            <span class="keyword">case</span> START_FE:</pre></td>
</tr>
<tr>
 	<td>196</td>
 	<td>197</td>
 	<td><pre>                fmtCount++;</pre></td>
</tr>
<tr>
 	<td>197</td>
 	<td>198</td>
 	<td><pre>                seekNonWs(pattern, pos);</pre></td>
</tr>
<tr>
 	<td>198</td>
 	<td>199</td>
 	<td><pre>                <span class="keyword">final</span> <span class="keyword">int</span> start = pos.getIndex();</pre></td>
</tr>
<tr>
 	<td>199</td>
 	<td>200</td>
 	<td><pre>                <span class="keyword">final</span> <span class="keyword">int</span> index = readArgumentIndex(pattern, next(pos));</pre></td>
</tr>
<tr>
 	<td>200</td>
 	<td>201</td>
 	<td><pre>                stripCustom.append(START_FE).append(index);</pre></td>
</tr>
<tr>
 	<td>201</td>
 	<td>202</td>
 	<td><pre>                seekNonWs(pattern, pos);</pre></td>
</tr>
<tr>
 	<td>202</td>
 	<td>203</td>
 	<td><pre>                Format format = <span class="keyword">null</span>;</pre></td>
</tr>
<tr>
 	<td>203</td>
 	<td>204</td>
 	<td><pre>                String formatDescription = <span class="keyword">null</span>;</pre></td>
</tr>
<tr>
 	<td>204</td>
 	<td>205</td>
 	<td><pre>                <span class="keyword">if</span> (c[pos.getIndex()] == START_FMT) {</pre></td>
</tr>
<tr>
 	<td>205</td>
 	<td>206</td>
 	<td><pre>                    formatDescription = parseFormatDescription(pattern,</pre></td>
</tr>
<tr>
 	<td>206</td>
 	<td>207</td>
 	<td><pre>                            next(pos));</pre></td>
</tr>
<tr>
 	<td>207</td>
 	<td>208</td>
 	<td><pre>                    format = getFormat(formatDescription);</pre></td>
</tr>
<tr>
 	<td>208</td>
 	<td>209</td>
 	<td><pre>                    <span class="keyword">if</span> (format == <span class="keyword">null</span>) {</pre></td>
</tr>
<tr>
 	<td>209</td>
 	<td>210</td>
 	<td><pre>                        stripCustom.append(START_FMT).append(formatDescription);</pre></td>
</tr>
<tr>
 	<td>210</td>
 	<td>211</td>
 	<td><pre>                    }</pre></td>
</tr>
<tr>
 	<td>211</td>
 	<td>212</td>
 	<td><pre>                }</pre></td>
</tr>
<tr>
 	<td>212</td>
 	<td>213</td>
 	<td><pre>                foundFormats.add(format);</pre></td>
</tr>
<tr>
 	<td>213</td>
 	<td>214</td>
 	<td><pre>                foundDescriptions.add(format == <span class="keyword">null</span> ? <span class="keyword">null</span> : formatDescription);</pre></td>
</tr>
<tr>
 	<td>214</td>
 	<td>215</td>
 	<td><pre>                <span class="keyword">if</span> (foundFormats.size() != fmtCount) {</pre></td>
</tr>
<tr>
 	<td>215</td>
 	<td>216</td>
 	<td><pre>                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"The validated expression is false"</span>);</pre></td>
</tr>
<tr>
 	<td>216</td>
 	<td>217</td>
 	<td><pre>                }</pre></td>
</tr>
<tr>
 	<td>217</td>
 	<td>218</td>
 	<td><pre>                <span class="keyword">if</span> (foundDescriptions.size() != fmtCount) {</pre></td>
</tr>
<tr>
 	<td>218</td>
 	<td>219</td>
 	<td><pre>                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"The validated expression is false"</span>);</pre></td>
</tr>
<tr>
 	<td>219</td>
 	<td>220</td>
 	<td><pre>                }</pre></td>
</tr>
<tr>
 	<td>220</td>
 	<td>221</td>
 	<td><pre>                <span class="keyword">if</span> (c[pos.getIndex()] != END_FE) {</pre></td>
</tr>
<tr>
 	<td>221</td>
 	<td>222</td>
 	<td><pre>                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</pre></td>
</tr>
<tr>
 	<td>222</td>
 	<td>223</td>
 	<td><pre>                            <span class="string">"Unreadable format element at position "</span> + start);</pre></td>
</tr>
<tr>
 	<td>223</td>
 	<td>224</td>
 	<td><pre>                }</pre></td>
</tr>
<tr>
 	<td>224</td>
 	<td>225</td>
 	<td><pre>                <span class="comment">//$FALL-THROUGH$</span></pre></td>
</tr>
<tr>
 	<td>225</td>
 	<td>226</td>
 	<td><pre>            <span class="keyword">default</span>:</pre></td>
</tr>
<tr>
 	<td>226</td>
 	<td>227</td>
 	<td><pre>                stripCustom.append(c[pos.getIndex()]);</pre></td>
</tr>
<tr>
 	<td>227</td>
 	<td>228</td>
 	<td><pre>                next(pos);</pre></td>
</tr>
<tr>
 	<td>228</td>
 	<td>229</td>
 	<td><pre>            }</pre></td>
</tr>
<tr>
 	<td>229</td>
 	<td>230</td>
 	<td><pre>        }</pre></td>
</tr>
<tr>
 	<td>230</td>
 	<td>231</td>
 	<td><pre>        <span class="keyword">super</span>.applyPattern(stripCustom.toString());</pre></td>
</tr>
<tr>
 	<td>231</td>
 	<td>232</td>
 	<td><pre>        toPattern = insertFormats(<span class="keyword">super</span>.toPattern(), foundDescriptions);</pre></td>
</tr>
<tr>
 	<td>232</td>
 	<td>233</td>
 	<td><pre>        <span class="keyword">if</span> (containsElements(foundFormats)) {</pre></td>
</tr>
<tr>
 	<td>233</td>
 	<td>234</td>
 	<td><pre>            <span class="keyword">final</span> Format[] origFormats = getFormats();</pre></td>
</tr>
<tr>
 	<td>234</td>
 	<td>235</td>
 	<td><pre>            <span class="comment">// only loop over what we know we have, as MessageFormat on Java 1.3</span></pre></td>
</tr>
<tr>
 	<td>235</td>
 	<td>236</td>
 	<td><pre>            <span class="comment">// seems to provide an extra format element:</span></pre></td>
</tr>
<tr>
 	<td>236</td>
 	<td>237</td>
 	<td><pre>            <span class="keyword">int</span> i = 0;</pre></td>
</tr>
<tr>
 	<td>237</td>
 	<td>238</td>
 	<td><pre>            <span class="keyword">for</span> (<span class="keyword">final</span> Iterator&lt;Format&gt; it = foundFormats.iterator(); it.hasNext(); i++) {</pre></td>
</tr>
<tr>
 	<td>238</td>
 	<td>239</td>
 	<td><pre>                <span class="keyword">final</span> Format f = it.next();</pre></td>
</tr>
<tr>
 	<td>239</td>
 	<td>240</td>
 	<td><pre>                <span class="keyword">if</span> (f != <span class="keyword">null</span>) {</pre></td>
</tr>
<tr>
 	<td>240</td>
 	<td>241</td>
 	<td><pre>                    origFormats[i] = f;</pre></td>
</tr>
<tr>
 	<td>241</td>
 	<td>242</td>
 	<td><pre>                }</pre></td>
</tr>
<tr>
 	<td>242</td>
 	<td>243</td>
 	<td><pre>            }</pre></td>
</tr>
<tr>
 	<td>243</td>
 	<td>244</td>
 	<td><pre>            <span class="keyword">super</span>.setFormats(origFormats);</pre></td>
</tr>
<tr>
 	<td>244</td>
 	<td>245</td>
 	<td><pre>        }</pre></td>
</tr>
<tr>
 	<td>245</td>
 	<td>246</td>
 	<td><pre>    }</pre></td>
</tr>
<tr>
 	<td>246</td>
 	<td>247</td>
 	<td><pre></pre></td>
</tr>
<tr>
 	<td>247</td>
 	<td>248</td>
 	<td><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td>248</td>
 	<td>249</td>
 	<td><pre><span class="comment">     * Throws UnsupportedOperationException - see class Javadoc for details.</span></pre></td>
</tr>
<tr>
 	<td>249</td>
 	<td>250</td>
 	<td><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td>250</td>
 	<td>251</td>
 	<td><pre><span class="comment">     * @param formatElementIndex format element index</span></pre></td>
</tr>
<tr>
 	<td>251</td>
 	<td>252</td>
 	<td><pre><span class="comment">     * @param newFormat the new format</span></pre></td>
</tr>
<tr>
 	<td>252</td>
 	<td>253</td>
 	<td><pre><span class="comment">     * @throws UnsupportedOperationException always thrown since this isn't</span></pre></td>
</tr>
<tr>
 	<td>253</td>
 	<td>254</td>
 	<td><pre><span class="comment">     *                                       supported by ExtendMessageFormat</span></pre></td>
</tr>
<tr>
 	<td>254</td>
 	<td>255</td>
 	<td><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td>255</td>
 	<td>256</td>
 	<td><pre>    @Override</pre></td>
</tr>
<tr>
 	<td>256</td>
 	<td>257</td>
 	<td><pre>    <span class="keyword">public</span> <span class="keyword">void</span> setFormat(<span class="keyword">final</span> <span class="keyword">int</span> formatElementIndex, <span class="keyword">final</span> Format newFormat) {</pre></td>
</tr>
<tr>
 	<td>257</td>
 	<td>258</td>
 	<td><pre>        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</pre></td>
</tr>
<tr>
 	<td>258</td>
 	<td>259</td>
 	<td><pre>    }</pre></td>
</tr>
<tr>
 	<td>259</td>
 	<td>260</td>
 	<td><pre></pre></td>
</tr>
<tr>
 	<td>260</td>
 	<td>261</td>
 	<td><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td>261</td>
 	<td>262</td>
 	<td><pre><span class="comment">     * Throws UnsupportedOperationException - see class Javadoc for details.</span></pre></td>
</tr>
<tr>
 	<td>262</td>
 	<td>263</td>
 	<td><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td>263</td>
 	<td>264</td>
 	<td><pre><span class="comment">     * @param argumentIndex argument index</span></pre></td>
</tr>
<tr>
 	<td>264</td>
 	<td>265</td>
 	<td><pre><span class="comment">     * @param newFormat the new format</span></pre></td>
</tr>
<tr>
 	<td>265</td>
 	<td>266</td>
 	<td><pre><span class="comment">     * @throws UnsupportedOperationException always thrown since this isn't</span></pre></td>
</tr>
<tr>
 	<td>266</td>
 	<td>267</td>
 	<td><pre><span class="comment">     *                                       supported by ExtendMessageFormat</span></pre></td>
</tr>
<tr>
 	<td>267</td>
 	<td>268</td>
 	<td><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td>268</td>
 	<td>269</td>
 	<td><pre>    @Override</pre></td>
</tr>
<tr>
 	<td>269</td>
 	<td>270</td>
 	<td><pre>    <span class="keyword">public</span> <span class="keyword">void</span> setFormatByArgumentIndex(<span class="keyword">final</span> <span class="keyword">int</span> argumentIndex,</pre></td>
</tr>
<tr>
 	<td>270</td>
 	<td>271</td>
 	<td><pre>                                         <span class="keyword">final</span> Format newFormat) {</pre></td>
</tr>
<tr>
 	<td>271</td>
 	<td>272</td>
 	<td><pre>        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</pre></td>
</tr>
<tr>
 	<td>272</td>
 	<td>273</td>
 	<td><pre>    }</pre></td>
</tr>
<tr>
 	<td>273</td>
 	<td>274</td>
 	<td><pre></pre></td>
</tr>
<tr>
 	<td>274</td>
 	<td>275</td>
 	<td><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td>275</td>
 	<td>276</td>
 	<td><pre><span class="comment">     * Throws UnsupportedOperationException - see class Javadoc for details.</span></pre></td>
</tr>
<tr>
 	<td>276</td>
 	<td>277</td>
 	<td><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td>277</td>
 	<td>278</td>
 	<td><pre><span class="comment">     * @param newFormats new formats</span></pre></td>
</tr>
<tr>
 	<td>278</td>
 	<td>279</td>
 	<td><pre><span class="comment">     * @throws UnsupportedOperationException always thrown since this isn't</span></pre></td>
</tr>
<tr>
 	<td>279</td>
 	<td>280</td>
 	<td><pre><span class="comment">     *                                       supported by ExtendMessageFormat</span></pre></td>
</tr>
<tr>
 	<td>280</td>
 	<td>281</td>
 	<td><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td>281</td>
 	<td>282</td>
 	<td><pre>    @Override</pre></td>
</tr>
<tr>
 	<td>282</td>
 	<td>283</td>
 	<td><pre>    <span class="keyword">public</span> <span class="keyword">void</span> setFormats(<span class="keyword">final</span> Format[] newFormats) {</pre></td>
</tr>
<tr>
 	<td>283</td>
 	<td>284</td>
 	<td><pre>        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</pre></td>
</tr>
<tr>
 	<td>284</td>
 	<td>285</td>
 	<td><pre>    }</pre></td>
</tr>
<tr>
 	<td>285</td>
 	<td>286</td>
 	<td><pre></pre></td>
</tr>
<tr>
 	<td>286</td>
 	<td>287</td>
 	<td><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td>287</td>
 	<td>288</td>
 	<td><pre><span class="comment">     * Throws UnsupportedOperationException - see class Javadoc for details.</span></pre></td>
</tr>
<tr>
 	<td>288</td>
 	<td>289</td>
 	<td><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td>289</td>
 	<td>290</td>
 	<td><pre><span class="comment">     * @param newFormats new formats</span></pre></td>
</tr>
<tr>
 	<td>290</td>
 	<td>291</td>
 	<td><pre><span class="comment">     * @throws UnsupportedOperationException always thrown since this isn't</span></pre></td>
</tr>
<tr>
 	<td>291</td>
 	<td>292</td>
 	<td><pre><span class="comment">     *                                       supported by ExtendMessageFormat</span></pre></td>
</tr>
<tr>
 	<td>292</td>
 	<td>293</td>
 	<td><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td>293</td>
 	<td>294</td>
 	<td><pre>    @Override</pre></td>
</tr>
<tr>
 	<td>294</td>
 	<td>295</td>
 	<td><pre>    <span class="keyword">public</span> <span class="keyword">void</span> setFormatsByArgumentIndex(<span class="keyword">final</span> Format[] newFormats) {</pre></td>
</tr>
<tr>
 	<td>295</td>
 	<td>296</td>
 	<td><pre>        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</pre></td>
</tr>
<tr>
 	<td>296</td>
 	<td>297</td>
 	<td><pre>    }</pre></td>
</tr>
<tr>
 	<td>297</td>
 	<td>298</td>
 	<td><pre></pre></td>
</tr>
<tr>
 	<td>298</td>
 	<td>299</td>
 	<td><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td>299</td>
 	<td>300</td>
 	<td><pre><span class="comment">     * Check if this extended message format is equal to another object.</span></pre></td>
</tr>
<tr>
 	<td>300</td>
 	<td>301</td>
 	<td><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td>301</td>
 	<td>302</td>
 	<td><pre><span class="comment">     * @param obj the object to compare to</span></pre></td>
</tr>
<tr>
 	<td>302</td>
 	<td>303</td>
 	<td><pre><span class="comment">     * @return true if this object equals the other, otherwise false</span></pre></td>
</tr>
<tr>
 	<td>303</td>
 	<td>304</td>
 	<td><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td>304</td>
 	<td>305</td>
 	<td><pre>    @Override</pre></td>
</tr>
<tr>
 	<td>305</td>
 	<td>306</td>
 	<td><pre>    <span class="keyword">public</span> <span class="keyword">boolean</span> equals(<span class="keyword">final</span> Object obj) {</pre></td>
</tr>
<tr>
 	<td>306</td>
 	<td>307</td>
 	<td><pre>        <span class="keyword">if</span> (obj == <span class="keyword">this</span>) {</pre></td>
</tr>
<tr>
 	<td>307</td>
 	<td>308</td>
 	<td><pre>            <span class="keyword">return</span> <span class="keyword">true</span>;</pre></td>
</tr>
<tr>
 	<td>308</td>
 	<td>309</td>
 	<td><pre>        }</pre></td>
</tr>
<tr>
 	<td>309</td>
 	<td>310</td>
 	<td><pre>        <span class="keyword">if</span> (obj == <span class="keyword">null</span>) {</pre></td>
</tr>
<tr>
 	<td>310</td>
 	<td>311</td>
 	<td><pre>            <span class="keyword">return</span> <span class="keyword">false</span>;</pre></td>
</tr>
<tr>
 	<td>311</td>
 	<td>312</td>
 	<td><pre>        }</pre></td>
</tr>
<tr>
 	<td>312</td>
 	<td>313</td>
 	<td><pre>        <span class="keyword">if</span> (!<span class="keyword">super</span>.equals(obj)) {</pre></td>
</tr>
<tr>
 	<td>313</td>
 	<td>314</td>
 	<td><pre>            <span class="keyword">return</span> <span class="keyword">false</span>;</pre></td>
</tr>
<tr>
 	<td>314</td>
 	<td>315</td>
 	<td><pre>        }</pre></td>
</tr>
<tr>
 	<td>315</td>
 	<td>316</td>
 	<td><pre>        <span class="keyword">if</span> (!Objects.equals(getClass(), obj.getClass())) {</pre></td>
</tr>
<tr>
 	<td>316</td>
 	<td>317</td>
 	<td><pre>          <span class="keyword">return</span> <span class="keyword">false</span>;</pre></td>
</tr>
<tr>
 	<td>317</td>
 	<td>318</td>
 	<td><pre>        }</pre></td>
</tr>
<tr>
 	<td>318</td>
 	<td>319</td>
 	<td><pre>        <span class="keyword">final</span> ExtendedMessageFormat rhs = (ExtendedMessageFormat) obj;</pre></td>
</tr>
<tr>
 	<td>319</td>
 	<td>320</td>
 	<td><pre>        <span class="keyword">if</span> (!Objects.equals(toPattern, rhs.toPattern)) {</pre></td>
</tr>
<tr>
 	<td>320</td>
 	<td>321</td>
 	<td><pre>            <span class="keyword">return</span> <span class="keyword">false</span>;</pre></td>
</tr>
<tr>
 	<td>321</td>
 	<td>322</td>
 	<td><pre>        }</pre></td>
</tr>
<tr>
 	<td>322</td>
 	<td>323</td>
 	<td><pre>        <span class="keyword">if</span> (!Objects.equals(registry, rhs.registry)) {</pre></td>
</tr>
<tr>
 	<td>323</td>
 	<td>324</td>
 	<td><pre>            <span class="keyword">return</span> <span class="keyword">false</span>;</pre></td>
</tr>
<tr>
 	<td>324</td>
 	<td>325</td>
 	<td><pre>        }</pre></td>
</tr>
<tr>
 	<td>325</td>
 	<td>326</td>
 	<td><pre>        <span class="keyword">return</span> <span class="keyword">true</span>;</pre></td>
</tr>
<tr>
 	<td>326</td>
 	<td>327</td>
 	<td><pre>    }</pre></td>
</tr>
<tr>
 	<td>327</td>
 	<td>328</td>
 	<td><pre></pre></td>
</tr>
<tr>
 	<td>328</td>
 	<td>329</td>
 	<td><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td>329</td>
 	<td>330</td>
 	<td><pre><span class="comment">     * {@inheritDoc}</span></pre></td>
</tr>
<tr>
 	<td>330</td>
 	<td>331</td>
 	<td><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td>331</td>
 	<td>332</td>
 	<td><pre>    @Override</pre></td>
</tr>
<tr>
 	<td>332</td>
 	<td>333</td>
 	<td><pre>    <span class="keyword">public</span> <span class="keyword">int</span> hashCode() {</pre></td>
</tr>
<tr>
 	<td>333</td>
 	<td>334</td>
 	<td><pre>        <span class="keyword">int</span> result = <span class="keyword">super</span>.hashCode();</pre></td>
</tr>
<tr>
 	<td>334</td>
 	<td>335</td>
 	<td><pre>        result = HASH_SEED * result + Objects.hashCode(registry);</pre></td>
</tr>
<tr>
 	<td>335</td>
 	<td>336</td>
 	<td><pre>        result = HASH_SEED * result + Objects.hashCode(toPattern);</pre></td>
</tr>
<tr>
 	<td>336</td>
 	<td>337</td>
 	<td><pre>        <span class="keyword">return</span> result;</pre></td>
</tr>
<tr>
 	<td>337</td>
 	<td>338</td>
 	<td><pre>    }</pre></td>
</tr>
<tr>
 	<td>338</td>
 	<td>339</td>
 	<td><pre></pre></td>
</tr>
<tr>
 	<td>339</td>
 	<td>340</td>
 	<td><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td>340</td>
 	<td>341</td>
 	<td><pre><span class="comment">     * Get a custom format from a format description.</span></pre></td>
</tr>
<tr>
 	<td>341</td>
 	<td>342</td>
 	<td><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td>342</td>
 	<td>343</td>
 	<td><pre><span class="comment">     * @param desc String</span></pre></td>
</tr>
<tr>
 	<td>343</td>
 	<td>344</td>
 	<td><pre><span class="comment">     * @return Format</span></pre></td>
</tr>
<tr>
 	<td>344</td>
 	<td>345</td>
 	<td><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td>345</td>
 	<td>346</td>
 	<td><pre>    <span class="keyword">private</span> Format getFormat(<span class="keyword">final</span> String desc) {</pre></td>
</tr>
<tr>
 	<td>346</td>
 	<td>347</td>
 	<td><pre>        <span class="keyword">if</span> (registry != <span class="keyword">null</span>) {</pre></td>
</tr>
<tr>
 	<td>347</td>
 	<td>348</td>
 	<td><pre>            String name = desc;</pre></td>
</tr>
<tr>
 	<td>348</td>
 	<td>349</td>
 	<td><pre>            String args = <span class="keyword">null</span>;</pre></td>
</tr>
<tr>
 	<td>349</td>
 	<td>350</td>
 	<td><pre>            <span class="keyword">final</span> <span class="keyword">int</span> i = desc.indexOf(START_FMT);</pre></td>
</tr>
<tr>
 	<td>350</td>
 	<td>351</td>
 	<td><pre>            <span class="keyword">if</span> (i &gt; 0) {</pre></td>
</tr>
<tr>
 	<td>351</td>
 	<td>352</td>
 	<td><pre>                name = desc.substring(0, i).trim();</pre></td>
</tr>
<tr>
 	<td>352</td>
 	<td>353</td>
 	<td><pre>                args = desc.substring(i + 1).trim();</pre></td>
</tr>
<tr>
 	<td>353</td>
 	<td>354</td>
 	<td><pre>            }</pre></td>
</tr>
<tr>
 	<td>354</td>
 	<td>355</td>
 	<td><pre>            <span class="keyword">final</span> FormatFactory factory = registry.get(name);</pre></td>
</tr>
<tr>
 	<td>355</td>
 	<td>356</td>
 	<td><pre>            <span class="keyword">if</span> (factory != <span class="keyword">null</span>) {</pre></td>
</tr>
<tr>
 	<td>356</td>
 	<td>357</td>
 	<td><pre>                <span class="keyword">return</span> factory.getFormat(name, args, getLocale());</pre></td>
</tr>
<tr>
 	<td>357</td>
 	<td>358</td>
 	<td><pre>            }</pre></td>
</tr>
<tr>
 	<td>358</td>
 	<td>359</td>
 	<td><pre>        }</pre></td>
</tr>
<tr>
 	<td>359</td>
 	<td>360</td>
 	<td><pre>        <span class="keyword">return</span> <span class="keyword">null</span>;</pre></td>
</tr>
<tr>
 	<td>360</td>
 	<td>361</td>
 	<td><pre>    }</pre></td>
</tr>
<tr>
 	<td>361</td>
 	<td>362</td>
 	<td><pre></pre></td>
</tr>
<tr>
 	<td>362</td>
 	<td>363</td>
 	<td><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td>363</td>
 	<td>364</td>
 	<td><pre><span class="comment">     * Read the argument index from the current format element.</span></pre></td>
</tr>
<tr>
 	<td>364</td>
 	<td>365</td>
 	<td><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td>365</td>
 	<td>366</td>
 	<td><pre><span class="comment">     * @param pattern pattern to parse</span></pre></td>
</tr>
<tr>
 	<td>366</td>
 	<td>367</td>
 	<td><pre><span class="comment">     * @param pos current parse position</span></pre></td>
</tr>
<tr>
 	<td>367</td>
 	<td>368</td>
 	<td><pre><span class="comment">     * @return argument index</span></pre></td>
</tr>
<tr>
 	<td>368</td>
 	<td>369</td>
 	<td><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td>369</td>
 	<td>370</td>
 	<td><pre>    <span class="keyword">private</span> <span class="keyword">int</span> readArgumentIndex(<span class="keyword">final</span> String pattern, <span class="keyword">final</span> ParsePosition pos) {</pre></td>
</tr>
<tr>
 	<td>370</td>
 	<td>371</td>
 	<td><pre>        <span class="keyword">final</span> <span class="keyword">int</span> start = pos.getIndex();</pre></td>
</tr>
<tr>
 	<td>371</td>
 	<td>372</td>
 	<td><pre>        seekNonWs(pattern, pos);</pre></td>
</tr>
<tr>
 	<td>372</td>
 	<td>373</td>
 	<td><pre>        <span class="keyword">final</span> StringBuilder result = <span class="keyword">new</span> StringBuilder();</pre></td>
</tr>
<tr>
 	<td>373</td>
 	<td>374</td>
 	<td><pre>        <span class="keyword">boolean</span> error = <span class="keyword">false</span>;</pre></td>
</tr>
<tr>
 	<td>374</td>
 	<td>375</td>
 	<td><pre>        <span class="keyword">for</span> (; !error &amp;&amp; pos.getIndex() &lt; pattern.length(); next(pos)) {</pre></td>
</tr>
<tr>
 	<td>375</td>
 	<td>376</td>
 	<td><pre>            <span class="keyword">char</span> c = pattern.charAt(pos.getIndex());</pre></td>
</tr>
<tr>
 	<td>376</td>
 	<td>377</td>
 	<td><pre>            <span class="keyword">if</span> (Character.isWhitespace(c)) {</pre></td>
</tr>
<tr>
 	<td>377</td>
 	<td>378</td>
 	<td><pre>                seekNonWs(pattern, pos);</pre></td>
</tr>
<tr>
 	<td>378</td>
 	<td>379</td>
 	<td><pre>                c = pattern.charAt(pos.getIndex());</pre></td>
</tr>
<tr>
 	<td>379</td>
 	<td>380</td>
 	<td><pre>                <span class="keyword">if</span> (c != START_FMT &amp;&amp; c != END_FE) {</pre></td>
</tr>
<tr>
 	<td>380</td>
 	<td>381</td>
 	<td><pre>                    error = <span class="keyword">true</span>;</pre></td>
</tr>
<tr>
 	<td>381</td>
 	<td>382</td>
 	<td><pre>                    <span class="keyword">continue</span>;</pre></td>
</tr>
<tr>
 	<td>382</td>
 	<td>383</td>
 	<td><pre>                }</pre></td>
</tr>
<tr>
 	<td>383</td>
 	<td>384</td>
 	<td><pre>            }</pre></td>
</tr>
<tr>
 	<td>384</td>
 	<td>385</td>
 	<td><pre>            <span class="keyword">if</span> ((c == START_FMT || c == END_FE) &amp;&amp; result.length() &gt; 0) {</pre></td>
</tr>
<tr>
 	<td>385</td>
 	<td>386</td>
 	<td><pre>                <span class="keyword">try</span> {</pre></td>
</tr>
<tr>
 	<td>386</td>
 	<td>387</td>
 	<td><pre>                    <span class="keyword">return</span> Integer.parseInt(result.toString());</pre></td>
</tr>
<tr>
 	<td>387</td>
 	<td>388</td>
 	<td><pre>                } <span class="keyword">catch</span> (<span class="keyword">final</span> NumberFormatException e) { <span class="comment">// NOPMD</span></pre></td>
</tr>
<tr>
 	<td>388</td>
 	<td>389</td>
 	<td><pre>                    <span class="comment">// we've already ensured only digits, so unless something</span></pre></td>
</tr>
<tr>
 	<td>389</td>
 	<td>390</td>
 	<td><pre>                    <span class="comment">// outlandishly large was specified we should be okay.</span></pre></td>
</tr>
<tr>
 	<td>390</td>
 	<td>391</td>
 	<td><pre>                }</pre></td>
</tr>
<tr>
 	<td>391</td>
 	<td>392</td>
 	<td><pre>            }</pre></td>
</tr>
<tr>
 	<td>392</td>
 	<td>393</td>
 	<td><pre>            error = !Character.isDigit(c);</pre></td>
</tr>
<tr>
 	<td>393</td>
 	<td>394</td>
 	<td><pre>            result.append(c);</pre></td>
</tr>
<tr>
 	<td>394</td>
 	<td>395</td>
 	<td><pre>        }</pre></td>
</tr>
<tr>
 	<td>395</td>
 	<td>396</td>
 	<td><pre>        <span class="keyword">if</span> (error) {</pre></td>
</tr>
<tr>
 	<td>396</td>
 	<td>397</td>
 	<td><pre>            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</pre></td>
</tr>
<tr>
 	<td>397</td>
 	<td>398</td>
 	<td><pre>                    <span class="string">"Invalid format argument index at position "</span> + start + <span class="string">": "</span></pre></td>
</tr>
<tr>
 	<td>398</td>
 	<td>399</td>
 	<td><pre>                            + pattern.substring(start, pos.getIndex()));</pre></td>
</tr>
<tr>
 	<td>399</td>
 	<td>400</td>
 	<td><pre>        }</pre></td>
</tr>
<tr>
 	<td>400</td>
 	<td>401</td>
 	<td><pre>        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</pre></td>
</tr>
<tr>
 	<td>401</td>
 	<td>402</td>
 	<td><pre>                <span class="string">"Unterminated format element at position "</span> + start);</pre></td>
</tr>
<tr>
 	<td>402</td>
 	<td>403</td>
 	<td><pre>    }</pre></td>
</tr>
<tr>
 	<td>403</td>
 	<td>404</td>
 	<td><pre></pre></td>
</tr>
<tr>
 	<td>404</td>
 	<td>405</td>
 	<td><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td>405</td>
 	<td>406</td>
 	<td><pre><span class="comment">     * Parse the format component of a format element.</span></pre></td>
</tr>
<tr>
 	<td>406</td>
 	<td>407</td>
 	<td><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td>407</td>
 	<td>408</td>
 	<td><pre><span class="comment">     * @param pattern string to parse</span></pre></td>
</tr>
<tr>
 	<td>408</td>
 	<td>409</td>
 	<td><pre><span class="comment">     * @param pos current parse position</span></pre></td>
</tr>
<tr>
 	<td>409</td>
 	<td>410</td>
 	<td><pre><span class="comment">     * @return Format description String</span></pre></td>
</tr>
<tr>
 	<td>410</td>
 	<td>411</td>
 	<td><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td>411</td>
 	<td>412</td>
 	<td><pre>    <span class="keyword">private</span> String parseFormatDescription(<span class="keyword">final</span> String pattern, <span class="keyword">final</span> ParsePosition pos) {</pre></td>
</tr>
<tr>
 	<td>412</td>
 	<td>413</td>
 	<td><pre>        <span class="keyword">final</span> <span class="keyword">int</span> start = pos.getIndex();</pre></td>
</tr>
<tr>
 	<td>413</td>
 	<td>414</td>
 	<td><pre>        seekNonWs(pattern, pos);</pre></td>
</tr>
<tr>
 	<td>414</td>
 	<td>415</td>
 	<td><pre>        <span class="keyword">final</span> <span class="keyword">int</span> text = pos.getIndex();</pre></td>
</tr>
<tr>
 	<td>415</td>
 	<td>416</td>
 	<td><pre>        <span class="keyword">int</span> depth = 1;</pre></td>
</tr>
<tr>
 	<td>416</td>
 	<td>417</td>
 	<td><pre>        <span class="keyword">for</span> (; pos.getIndex() &lt; pattern.length(); next(pos)) {</pre></td>
</tr>
<tr>
 	<td>417</td>
 	<td>418</td>
 	<td><pre>            <span class="keyword">switch</span> (pattern.charAt(pos.getIndex())) {</pre></td>
</tr>
<tr>
 	<td>418</td>
 	<td>419</td>
 	<td><pre>            <span class="keyword">case</span> START_FE:</pre></td>
</tr>
<tr>
 	<td>419</td>
 	<td>420</td>
 	<td><pre>                depth++;</pre></td>
</tr>
<tr>
 	<td>420</td>
 	<td>421</td>
 	<td><pre>                <span class="keyword">break</span>;</pre></td>
</tr>
<tr>
 	<td>421</td>
 	<td>422</td>
 	<td><pre>            <span class="keyword">case</span> END_FE:</pre></td>
</tr>
<tr>
 	<td>422</td>
 	<td>423</td>
 	<td><pre>                depth--;</pre></td>
</tr>
<tr>
 	<td>423</td>
 	<td>424</td>
 	<td><pre>                <span class="keyword">if</span> (depth == 0) {</pre></td>
</tr>
<tr>
 	<td>424</td>
 	<td>425</td>
 	<td><pre>                    <span class="keyword">return</span> pattern.substring(text, pos.getIndex());</pre></td>
</tr>
<tr>
 	<td>425</td>
 	<td>426</td>
 	<td><pre>                }</pre></td>
</tr>
<tr>
 	<td>426</td>
 	<td>427</td>
 	<td><pre>                <span class="keyword">break</span>;</pre></td>
</tr>
<tr>
 	<td>427</td>
 	<td>428</td>
 	<td><pre>            <span class="keyword">case</span> QUOTE:</pre></td>
</tr>
<tr>
 	<td>428</td>
 	<td>429</td>
 	<td><pre>                getQuotedString(pattern, pos);</pre></td>
</tr>
<tr>
 	<td>429</td>
 	<td>430</td>
 	<td><pre>                <span class="keyword">break</span>;</pre></td>
</tr>
<tr>
 	<td>430</td>
 	<td>431</td>
 	<td><pre>            <span class="keyword">default</span>:</pre></td>
</tr>
<tr>
 	<td>431</td>
 	<td>432</td>
 	<td><pre>                <span class="keyword">break</span>;</pre></td>
</tr>
<tr>
 	<td>432</td>
 	<td>433</td>
 	<td><pre>            }</pre></td>
</tr>
<tr>
 	<td>433</td>
 	<td>434</td>
 	<td><pre>        }</pre></td>
</tr>
<tr>
 	<td>434</td>
 	<td>435</td>
 	<td><pre>        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</pre></td>
</tr>
<tr>
 	<td>435</td>
 	<td>436</td>
 	<td><pre>                <span class="string">"Unterminated format element at position "</span> + start);</pre></td>
</tr>
<tr>
 	<td>436</td>
 	<td>437</td>
 	<td><pre>    }</pre></td>
</tr>
<tr>
 	<td>437</td>
 	<td>438</td>
 	<td><pre></pre></td>
</tr>
<tr>
 	<td>438</td>
 	<td>439</td>
 	<td><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td>439</td>
 	<td>440</td>
 	<td><pre><span class="comment">     * Insert formats back into the pattern for toPattern() support.</span></pre></td>
</tr>
<tr>
 	<td>440</td>
 	<td>441</td>
 	<td><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td>441</td>
 	<td>442</td>
 	<td><pre><span class="comment">     * @param pattern source</span></pre></td>
</tr>
<tr>
 	<td>442</td>
 	<td>443</td>
 	<td><pre><span class="comment">     * @param customPatterns The custom patterns to re-insert, if any</span></pre></td>
</tr>
<tr>
 	<td>443</td>
 	<td>444</td>
 	<td><pre><span class="comment">     * @return full pattern</span></pre></td>
</tr>
<tr>
 	<td>444</td>
 	<td>445</td>
 	<td><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td>445</td>
 	<td>446</td>
 	<td><pre>    <span class="keyword">private</span> String insertFormats(<span class="keyword">final</span> String pattern, <span class="keyword">final</span> ArrayList&lt;String&gt; customPatterns) {</pre></td>
</tr>
<tr>
 	<td>446</td>
 	<td>447</td>
 	<td><pre>        <span class="keyword">if</span> (!containsElements(customPatterns)) {</pre></td>
</tr>
<tr>
 	<td>447</td>
 	<td>448</td>
 	<td><pre>            <span class="keyword">return</span> pattern;</pre></td>
</tr>
<tr>
 	<td>448</td>
 	<td>449</td>
 	<td><pre>        }</pre></td>
</tr>
<tr>
 	<td>449</td>
 	<td>450</td>
 	<td><pre>        <span class="keyword">final</span> StringBuilder sb = <span class="keyword">new</span> StringBuilder(pattern.length() * 2);</pre></td>
</tr>
<tr>
 	<td>450</td>
 	<td>451</td>
 	<td><pre>        <span class="keyword">final</span> ParsePosition pos = <span class="keyword">new</span> ParsePosition(0);</pre></td>
</tr>
<tr>
 	<td>451</td>
 	<td>452</td>
 	<td><pre>        <span class="keyword">int</span> fe = -1;</pre></td>
</tr>
<tr>
 	<td>452</td>
 	<td>453</td>
 	<td><pre>        <span class="keyword">int</span> depth = 0;</pre></td>
</tr>
<tr>
 	<td>453</td>
 	<td>454</td>
 	<td><pre>        <span class="keyword">while</span> (pos.getIndex() &lt; pattern.length()) {</pre></td>
</tr>
<tr>
 	<td>454</td>
 	<td>455</td>
 	<td><pre>            <span class="keyword">final</span> <span class="keyword">char</span> c = pattern.charAt(pos.getIndex());</pre></td>
</tr>
<tr>
 	<td>455</td>
 	<td>456</td>
 	<td><pre>            <span class="keyword">switch</span> (c) {</pre></td>
</tr>
<tr>
 	<td>456</td>
 	<td>457</td>
 	<td><pre>            <span class="keyword">case</span> QUOTE:</pre></td>
</tr>
<tr>
 	<td>457</td>
 	<td>458</td>
 	<td><pre>                appendQuotedString(pattern, pos, sb);</pre></td>
</tr>
<tr>
 	<td>458</td>
 	<td>459</td>
 	<td><pre>                <span class="keyword">break</span>;</pre></td>
</tr>
<tr>
 	<td>459</td>
 	<td>460</td>
 	<td><pre>            <span class="keyword">case</span> START_FE:</pre></td>
</tr>
<tr>
 	<td>460</td>
 	<td>461</td>
 	<td><pre>                depth++;</pre></td>
</tr>
<tr>
 	<td>461</td>
 	<td>462</td>
 	<td><pre>                sb.append(START_FE).append(readArgumentIndex(pattern, next(pos)));</pre></td>
</tr>
<tr>
 	<td>462</td>
 	<td>463</td>
 	<td><pre>                <span class="comment">// do not look for custom patterns when they are embedded, e.g. in a choice</span></pre></td>
</tr>
<tr>
 	<td>463</td>
 	<td>464</td>
 	<td><pre>                <span class="keyword">if</span> (depth == 1) {</pre></td>
</tr>
<tr>
 	<td>464</td>
 	<td>465</td>
 	<td><pre>                    fe++;</pre></td>
</tr>
<tr>
 	<td>465</td>
 	<td>466</td>
 	<td><pre>                    <span class="keyword">final</span> String customPattern = customPatterns.get(fe);</pre></td>
</tr>
<tr>
 	<td>466</td>
 	<td>467</td>
 	<td><pre>                    <span class="keyword">if</span> (customPattern != <span class="keyword">null</span>) {</pre></td>
</tr>
<tr>
 	<td>467</td>
 	<td>468</td>
 	<td><pre>                        sb.append(START_FMT).append(customPattern);</pre></td>
</tr>
<tr>
 	<td>468</td>
 	<td>469</td>
 	<td><pre>                    }</pre></td>
</tr>
<tr>
 	<td>469</td>
 	<td>470</td>
 	<td><pre>                }</pre></td>
</tr>
<tr>
 	<td>470</td>
 	<td>471</td>
 	<td><pre>                <span class="keyword">break</span>;</pre></td>
</tr>
<tr>
 	<td>471</td>
 	<td>472</td>
 	<td><pre>            <span class="keyword">case</span> END_FE:</pre></td>
</tr>
<tr>
 	<td>472</td>
 	<td>473</td>
 	<td><pre>                depth--;</pre></td>
</tr>
<tr>
 	<td>473</td>
 	<td>474</td>
 	<td><pre>                <span class="comment">//$FALL-THROUGH$</span></pre></td>
</tr>
<tr>
 	<td>474</td>
 	<td>475</td>
 	<td><pre>            <span class="keyword">default</span>:</pre></td>
</tr>
<tr>
 	<td>475</td>
 	<td>476</td>
 	<td><pre>                sb.append(c);</pre></td>
</tr>
<tr>
 	<td>476</td>
 	<td>477</td>
 	<td><pre>                next(pos);</pre></td>
</tr>
<tr>
 	<td>477</td>
 	<td>478</td>
 	<td><pre>            }</pre></td>
</tr>
<tr>
 	<td>478</td>
 	<td>479</td>
 	<td><pre>        }</pre></td>
</tr>
<tr>
 	<td>479</td>
 	<td>480</td>
 	<td><pre>        <span class="keyword">return</span> sb.toString();</pre></td>
</tr>
<tr>
 	<td>480</td>
 	<td>481</td>
 	<td><pre>    }</pre></td>
</tr>
<tr>
 	<td>481</td>
 	<td>482</td>
 	<td><pre></pre></td>
</tr>
<tr>
 	<td>482</td>
 	<td>483</td>
 	<td><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td>483</td>
 	<td>484</td>
 	<td><pre><span class="comment">     * Consume whitespace from the current parse position.</span></pre></td>
</tr>
<tr>
 	<td>484</td>
 	<td>485</td>
 	<td><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td>485</td>
 	<td>486</td>
 	<td><pre><span class="comment">     * @param pattern String to read</span></pre></td>
</tr>
<tr>
 	<td>486</td>
 	<td>487</td>
 	<td><pre><span class="comment">     * @param pos current position</span></pre></td>
</tr>
<tr>
 	<td>487</td>
 	<td>488</td>
 	<td><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td>488</td>
 	<td>489</td>
 	<td><pre>    <span class="keyword">private</span> <span class="keyword">void</span> seekNonWs(<span class="keyword">final</span> String pattern, <span class="keyword">final</span> ParsePosition pos) {</pre></td>
</tr>
<tr>
 	<td>489</td>
 	<td>490</td>
 	<td><pre>        <span class="keyword">int</span> len = 0;</pre></td>
</tr>
<tr>
 	<td>490</td>
 	<td>491</td>
 	<td><pre>        <span class="keyword">final</span> <span class="keyword">char</span>[] buffer = pattern.toCharArray();</pre></td>
</tr>
<tr>
 	<td>491</td>
 	<td>492</td>
 	<td><pre>        <span class="keyword">do</span> {</pre></td>
</tr>
<tr>
 	<td>492</td>
 	<td>493</td>
 	<td><pre>            len = StrMatcher.splitMatcher().isMatch(buffer, pos.getIndex());</pre></td>
</tr>
<tr>
 	<td>493</td>
 	<td>494</td>
 	<td><pre>            pos.setIndex(pos.getIndex() + len);</pre></td>
</tr>
<tr>
 	<td>494</td>
 	<td>495</td>
 	<td><pre>        } <span class="keyword">while</span> (len &gt; 0 &amp;&amp; pos.getIndex() &lt; pattern.length());</pre></td>
</tr>
<tr>
 	<td>495</td>
 	<td>496</td>
 	<td><pre>    }</pre></td>
</tr>
<tr>
 	<td>496</td>
 	<td>497</td>
 	<td><pre></pre></td>
</tr>
<tr>
 	<td>497</td>
 	<td>498</td>
 	<td><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td>498</td>
 	<td>499</td>
 	<td><pre><span class="comment">     * Convenience method to advance parse position by 1.</span></pre></td>
</tr>
<tr>
 	<td>499</td>
 	<td>500</td>
 	<td><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td>500</td>
 	<td>501</td>
 	<td><pre><span class="comment">     * @param pos ParsePosition</span></pre></td>
</tr>
<tr>
 	<td>501</td>
 	<td>502</td>
 	<td><pre><span class="comment">     * @return &lt;code&gt;pos&lt;/code&gt;</span></pre></td>
</tr>
<tr>
 	<td>502</td>
 	<td>503</td>
 	<td><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td>503</td>
 	<td>504</td>
 	<td><pre>    <span class="keyword">private</span> ParsePosition next(<span class="keyword">final</span> ParsePosition pos) {</pre></td>
</tr>
<tr>
 	<td>504</td>
 	<td>505</td>
 	<td><pre>        pos.setIndex(pos.getIndex() + 1);</pre></td>
</tr>
<tr>
 	<td>505</td>
 	<td>506</td>
 	<td><pre>        <span class="keyword">return</span> pos;</pre></td>
</tr>
<tr>
 	<td>506</td>
 	<td>507</td>
 	<td><pre>    }</pre></td>
</tr>
<tr>
 	<td>507</td>
 	<td>508</td>
 	<td><pre></pre></td>
</tr>
<tr>
 	<td>508</td>
 	<td>509</td>
 	<td><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td>509</td>
 	<td>510</td>
 	<td><pre><span class="comment">     * Consume a quoted string, adding it to &lt;code&gt;appendTo&lt;/code&gt; if</span></pre></td>
</tr>
<tr>
 	<td>510</td>
 	<td>511</td>
 	<td><pre><span class="comment">     * specified.</span></pre></td>
</tr>
<tr>
 	<td>511</td>
 	<td>512</td>
 	<td><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td>512</td>
 	<td>513</td>
 	<td><pre><span class="comment">     * @param pattern pattern to parse</span></pre></td>
</tr>
<tr>
 	<td>513</td>
 	<td>514</td>
 	<td><pre><span class="comment">     * @param pos current parse position</span></pre></td>
</tr>
<tr>
 	<td>514</td>
 	<td>515</td>
 	<td><pre><span class="comment">     * @param appendTo optional StringBuilder to append</span></pre></td>
</tr>
<tr>
 	<td>515</td>
 	<td>516</td>
 	<td><pre><span class="comment">     * @return &lt;code&gt;appendTo&lt;/code&gt;</span></pre></td>
</tr>
<tr>
 	<td>516</td>
 	<td>517</td>
 	<td><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td>517</td>
 	<td>518</td>
 	<td><pre>    <span class="keyword">private</span> StringBuilder appendQuotedString(<span class="keyword">final</span> String pattern, <span class="keyword">final</span> ParsePosition pos,</pre></td>
</tr>
<tr>
 	<td>518</td>
 	<td>519</td>
 	<td><pre>            <span class="keyword">final</span> StringBuilder appendTo) {</pre></td>
</tr>
<tr>
 	<td>519</td>
 	<td>520</td>
 	<td><pre>        <span class="keyword">assert</span> pattern.toCharArray()[pos.getIndex()] == QUOTE</pre></td>
</tr>
<tr>
 	<td>520</td>
 	<td>521</td>
 	<td><pre>                : <span class="string">"Quoted string must start with quote character"</span>;</pre></td>
</tr>
<tr>
 	<td>521</td>
 	<td>522</td>
 	<td><pre></pre></td>
</tr>
<tr>
 	<td>522</td>
 	<td>523</td>
 	<td><pre>        <span class="comment">// handle quote character at the beginning of the string</span></pre></td>
</tr>
<tr>
 	<td>523</td>
 	<td>524</td>
 	<td><pre>        <span class="keyword">if</span> (appendTo != <span class="keyword">null</span>) {</pre></td>
</tr>
<tr>
 	<td>524</td>
 	<td>525</td>
 	<td><pre>            appendTo.append(QUOTE);</pre></td>
</tr>
<tr>
 	<td>525</td>
 	<td>526</td>
 	<td><pre>        }</pre></td>
</tr>
<tr>
 	<td>526</td>
 	<td>527</td>
 	<td><pre>        next(pos);</pre></td>
</tr>
<tr>
 	<td>527</td>
 	<td>528</td>
 	<td><pre></pre></td>
</tr>
<tr>
 	<td>528</td>
 	<td>529</td>
 	<td><pre>        <span class="keyword">final</span> <span class="keyword">int</span> start = pos.getIndex();</pre></td>
</tr>
<tr>
 	<td>529</td>
 	<td>530</td>
 	<td><pre>        <span class="keyword">final</span> <span class="keyword">char</span>[] c = pattern.toCharArray();</pre></td>
</tr>
<tr>
 	<td>530</td>
 	<td>531</td>
 	<td><pre>        <span class="keyword">final</span> <span class="keyword">int</span> lastHold = start;</pre></td>
</tr>
<tr>
 	<td>531</td>
 	<td>532</td>
 	<td><pre>        <span class="keyword">for</span> (<span class="keyword">int</span> i = pos.getIndex(); i &lt; pattern.length(); i++) {</pre></td>
</tr>
<tr>
 	<td>532</td>
 	<td>533</td>
 	<td><pre>            <span class="keyword">switch</span> (c[pos.getIndex()]) {</pre></td>
</tr>
<tr>
 	<td>533</td>
 	<td>534</td>
 	<td><pre>            <span class="keyword">case</span> QUOTE:</pre></td>
</tr>
<tr>
 	<td>534</td>
 	<td>535</td>
 	<td><pre>                next(pos);</pre></td>
</tr>
<tr>
 	<td>535</td>
 	<td>536</td>
 	<td><pre>                <span class="keyword">return</span> appendTo == <span class="keyword">null</span> ? <span class="keyword">null</span> : appendTo.append(c, lastHold,</pre></td>
</tr>
<tr>
 	<td>536</td>
 	<td>537</td>
 	<td><pre>                        pos.getIndex() - lastHold);</pre></td>
</tr>
<tr>
 	<td>537</td>
 	<td>538</td>
 	<td><pre>            <span class="keyword">default</span>:</pre></td>
</tr>
<tr>
 	<td>538</td>
 	<td>539</td>
 	<td><pre>                next(pos);</pre></td>
</tr>
<tr>
 	<td>539</td>
 	<td>540</td>
 	<td><pre>            }</pre></td>
</tr>
<tr>
 	<td>540</td>
 	<td>541</td>
 	<td><pre>        }</pre></td>
</tr>
<tr>
 	<td>541</td>
 	<td>542</td>
 	<td><pre>        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</pre></td>
</tr>
<tr>
 	<td>542</td>
 	<td>543</td>
 	<td><pre>                <span class="string">"Unterminated quoted string at position "</span> + start);</pre></td>
</tr>
<tr>
 	<td>543</td>
 	<td>544</td>
 	<td><pre>    }</pre></td>
</tr>
<tr>
 	<td>544</td>
 	<td>545</td>
 	<td><pre></pre></td>
</tr>
<tr>
 	<td>545</td>
 	<td>546</td>
 	<td><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td>546</td>
 	<td>547</td>
 	<td><pre><span class="comment">     * Consume quoted string only.</span></pre></td>
</tr>
<tr>
 	<td>547</td>
 	<td>548</td>
 	<td><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td>548</td>
 	<td>549</td>
 	<td><pre><span class="comment">     * @param pattern pattern to parse</span></pre></td>
</tr>
<tr>
 	<td>549</td>
 	<td>550</td>
 	<td><pre><span class="comment">     * @param pos current parse position</span></pre></td>
</tr>
<tr>
 	<td>550</td>
 	<td>551</td>
 	<td><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td>551</td>
 	<td>552</td>
 	<td><pre>    <span class="keyword">private</span> <span class="keyword">void</span> getQuotedString(<span class="keyword">final</span> String pattern, <span class="keyword">final</span> ParsePosition pos) {</pre></td>
</tr>
<tr>
 	<td>552</td>
 	<td>553</td>
 	<td><pre>        appendQuotedString(pattern, pos, <span class="keyword">null</span>);</pre></td>
</tr>
<tr>
 	<td>553</td>
 	<td>554</td>
 	<td><pre>    }</pre></td>
</tr>
<tr>
 	<td>554</td>
 	<td>555</td>
 	<td><pre></pre></td>
</tr>
<tr>
 	<td>555</td>
 	<td>556</td>
 	<td><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td>556</td>
 	<td>557</td>
 	<td><pre><span class="comment">     * Learn whether the specified Collection contains non-null elements.</span></pre></td>
</tr>
<tr>
 	<td>557</td>
 	<td>558</td>
 	<td><pre><span class="comment">     * @param coll to check</span></pre></td>
</tr>
<tr>
 	<td>558</td>
 	<td>559</td>
 	<td><pre><span class="comment">     * @return &lt;code&gt;true&lt;/code&gt; if some Object was found, &lt;code&gt;false&lt;/code&gt; otherwise.</span></pre></td>
</tr>
<tr>
 	<td>559</td>
 	<td>560</td>
 	<td><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td>560</td>
 	<td>561</td>
 	<td><pre>    <span class="keyword">private</span> <span class="keyword">boolean</span> containsElements(<span class="keyword">final</span> Collection&lt;?&gt; coll) {</pre></td>
</tr>
<tr>
 	<td>561</td>
 	<td>562</td>
 	<td><pre>        <span class="keyword">if</span> (coll == <span class="keyword">null</span> || coll.isEmpty()) {</pre></td>
</tr>
<tr>
 	<td>562</td>
 	<td>563</td>
 	<td><pre>            <span class="keyword">return</span> <span class="keyword">false</span>;</pre></td>
</tr>
<tr>
 	<td>563</td>
 	<td>564</td>
 	<td><pre>        }</pre></td>
</tr>
<tr>
 	<td>564</td>
 	<td>565</td>
 	<td><pre>        <span class="keyword">for</span> (<span class="keyword">final</span> Object name : coll) {</pre></td>
</tr>
<tr>
 	<td>565</td>
 	<td>566</td>
 	<td><pre>            <span class="keyword">if</span> (name != <span class="keyword">null</span>) {</pre></td>
</tr>
<tr>
 	<td>566</td>
 	<td>567</td>
 	<td><pre>                <span class="keyword">return</span> <span class="keyword">true</span>;</pre></td>
</tr>
<tr>
 	<td>567</td>
 	<td>568</td>
 	<td><pre>            }</pre></td>
</tr>
<tr>
 	<td>568</td>
 	<td>569</td>
 	<td><pre>        }</pre></td>
</tr>
<tr>
 	<td>569</td>
 	<td>570</td>
 	<td><pre>        <span class="keyword">return</span> <span class="keyword">false</span>;</pre></td>
</tr>
<tr>
 	<td>570</td>
 	<td>571</td>
 	<td><pre>    }</pre></td>
</tr>
<tr>
 	<td>571</td>
 	<td>572</td>
 	<td><pre>}</pre></td>
</tr>
</table>
<table id='combinedTable' class='code'>
<tr>
 	<td class=''>1</td>
 	<td class=''>1</td>
 	<td class=''><pre><span class="comment">/*</span></pre></td>
</tr>
<tr>
 	<td class=''>2</td>
 	<td class=''>2</td>
 	<td class=''><pre><span class="comment"> * Licensed to the Apache Software Foundation (ASF) under one or more</span></pre></td>
</tr>
<tr>
 	<td class=''>3</td>
 	<td class=''>3</td>
 	<td class=''><pre><span class="comment"> * contributor license agreements.  See the NOTICE file distributed with</span></pre></td>
</tr>
<tr>
 	<td class=''>4</td>
 	<td class=''>4</td>
 	<td class=''><pre><span class="comment"> * this work for additional information regarding copyright ownership.</span></pre></td>
</tr>
<tr>
 	<td class=''>5</td>
 	<td class=''>5</td>
 	<td class=''><pre><span class="comment"> * The ASF licenses this file to You under the Apache License, Version 2.0</span></pre></td>
</tr>
<tr>
 	<td class=''>6</td>
 	<td class=''>6</td>
 	<td class=''><pre><span class="comment"> * (the "License"); you may not use this file except in compliance with</span></pre></td>
</tr>
<tr>
 	<td class=''>7</td>
 	<td class=''>7</td>
 	<td class=''><pre><span class="comment"> * the License.  You may obtain a copy of the License at</span></pre></td>
</tr>
<tr>
 	<td class=''>8</td>
 	<td class=''>8</td>
 	<td class=''><pre><span class="comment"> *</span></pre></td>
</tr>
<tr>
 	<td class=''>9</td>
 	<td class=''>9</td>
 	<td class=''><pre><span class="comment"> *      http://www.apache.org/licenses/LICENSE-2.0</span></pre></td>
</tr>
<tr>
 	<td class=''>10</td>
 	<td class=''>10</td>
 	<td class=''><pre><span class="comment"> *</span></pre></td>
</tr>
<tr>
 	<td class=''>11</td>
 	<td class=''>11</td>
 	<td class=''><pre><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></pre></td>
</tr>
<tr>
 	<td class=''>12</td>
 	<td class=''>12</td>
 	<td class=''><pre><span class="comment"> * distributed under the License is distributed on an "AS IS" BASIS,</span></pre></td>
</tr>
<tr>
 	<td class=''>13</td>
 	<td class=''>13</td>
 	<td class=''><pre><span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></pre></td>
</tr>
<tr>
 	<td class=''>14</td>
 	<td class=''>14</td>
 	<td class=''><pre><span class="comment"> * See the License for the specific language governing permissions and</span></pre></td>
</tr>
<tr>
 	<td class=''>15</td>
 	<td class=''>15</td>
 	<td class=''><pre><span class="comment"> * limitations under the License.</span></pre></td>
</tr>
<tr>
 	<td class=''>16</td>
 	<td class=''>16</td>
 	<td class=''><pre><span class="comment"> */</span></pre></td>
</tr>
<tr>
 	<td class=''>17</td>
 	<td class=''>17</td>
 	<td class=''><pre><span class="keyword">package</span> org.apache.commons.text;</pre></td>
</tr>
<tr>
 	<td class=''>18</td>
 	<td class=''>18</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>19</td>
 	<td class=''>19</td>
 	<td class=''><pre><span class="keyword">import</span> java.text.Format;</pre></td>
</tr>
<tr>
 	<td class=''>20</td>
 	<td class=''>20</td>
 	<td class=''><pre><span class="keyword">import</span> java.text.MessageFormat;</pre></td>
</tr>
<tr>
 	<td class=''>21</td>
 	<td class=''>21</td>
 	<td class=''><pre><span class="keyword">import</span> java.text.ParsePosition;</pre></td>
</tr>
<tr>
 	<td class=''>22</td>
 	<td class=''>22</td>
 	<td class=''><pre><span class="keyword">import</span> java.util.ArrayList;</pre></td>
</tr>
<tr>
 	<td class=''>23</td>
 	<td class=''>23</td>
 	<td class=''><pre><span class="keyword">import</span> java.util.Collection;</pre></td>
</tr>
<tr>
 	<td class=''>24</td>
 	<td class=''>24</td>
 	<td class=''><pre><span class="keyword">import</span> java.util.Iterator;</pre></td>
</tr>
<tr>
 	<td class=''>25</td>
 	<td class=''>25</td>
 	<td class=''><pre><span class="keyword">import</span> java.util.Locale;</pre></td>
</tr>
<tr>
 	<td class='insertedRow left bottom top'></td>
 	<td class='insertedRow bottom top'>26</td>
 	<td class='insertedRow right bottom top'><pre><span class="keyword">import</span> java.util.Locale.Category;</pre></td>
</tr>
<tr>
 	<td class=''>26</td>
 	<td class=''>27</td>
 	<td class=''><pre><span class="keyword">import</span> java.util.Map;</pre></td>
</tr>
<tr>
 	<td class=''>27</td>
 	<td class=''>28</td>
 	<td class=''><pre><span class="keyword">import</span> java.util.Objects;</pre></td>
</tr>
<tr>
 	<td class=''>28</td>
 	<td class=''>29</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>29</td>
 	<td class=''>30</td>
 	<td class=''><pre><span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>30</td>
 	<td class=''>31</td>
 	<td class=''><pre><span class="comment"> * Extends &lt;code&gt;java.text.MessageFormat&lt;/code&gt; to allow pluggable/additional formatting</span></pre></td>
</tr>
<tr>
 	<td class=''>31</td>
 	<td class=''>32</td>
 	<td class=''><pre><span class="comment"> * options for embedded format elements.  Client code should specify a registry</span></pre></td>
</tr>
<tr>
 	<td class=''>32</td>
 	<td class=''>33</td>
 	<td class=''><pre><span class="comment"> * of &lt;code&gt;FormatFactory&lt;/code&gt; instances associated with &lt;code&gt;String&lt;/code&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>33</td>
 	<td class=''>34</td>
 	<td class=''><pre><span class="comment"> * format names.  This registry will be consulted when the format elements are</span></pre></td>
</tr>
<tr>
 	<td class=''>34</td>
 	<td class=''>35</td>
 	<td class=''><pre><span class="comment"> * parsed from the message pattern.  In this way custom patterns can be specified,</span></pre></td>
</tr>
<tr>
 	<td class=''>35</td>
 	<td class=''>36</td>
 	<td class=''><pre><span class="comment"> * and the formats supported by &lt;code&gt;java.text.MessageFormat&lt;/code&gt; can be overridden</span></pre></td>
</tr>
<tr>
 	<td class=''>36</td>
 	<td class=''>37</td>
 	<td class=''><pre><span class="comment"> * at the format and/or format style level (see MessageFormat).  A "format element"</span></pre></td>
</tr>
<tr>
 	<td class=''>37</td>
 	<td class=''>38</td>
 	<td class=''><pre><span class="comment"> * embedded in the message pattern is specified (&lt;b&gt;()?&lt;/b&gt; signifies optionality):&lt;br&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>38</td>
 	<td class=''>39</td>
 	<td class=''><pre><span class="comment"> * &lt;code&gt;{&lt;/code&gt;&lt;i&gt;argument-number&lt;/i&gt;&lt;b&gt;(&lt;/b&gt;&lt;code&gt;,&lt;/code&gt;&lt;i&gt;format-name&lt;/i&gt;&lt;b&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>39</td>
 	<td class=''>40</td>
 	<td class=''><pre><span class="comment"> * (&lt;/b&gt;&lt;code&gt;,&lt;/code&gt;&lt;i&gt;format-style&lt;/i&gt;&lt;b&gt;)?)?&lt;/b&gt;&lt;code&gt;}&lt;/code&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>40</td>
 	<td class=''>41</td>
 	<td class=''><pre><span class="comment"> *</span></pre></td>
</tr>
<tr>
 	<td class=''>41</td>
 	<td class=''>42</td>
 	<td class=''><pre><span class="comment"> * &lt;p&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>42</td>
 	<td class=''>43</td>
 	<td class=''><pre><span class="comment"> * &lt;i&gt;format-name&lt;/i&gt; and &lt;i&gt;format-style&lt;/i&gt; values are trimmed of surrounding whitespace</span></pre></td>
</tr>
<tr>
 	<td class=''>43</td>
 	<td class=''>44</td>
 	<td class=''><pre><span class="comment"> * in the manner of &lt;code&gt;java.text.MessageFormat&lt;/code&gt;.  If &lt;i&gt;format-name&lt;/i&gt; denotes</span></pre></td>
</tr>
<tr>
 	<td class=''>44</td>
 	<td class=''>45</td>
 	<td class=''><pre><span class="comment"> * &lt;code&gt;FormatFactory formatFactoryInstance&lt;/code&gt; in &lt;code&gt;registry&lt;/code&gt;, a &lt;code&gt;Format&lt;/code&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>45</td>
 	<td class=''>46</td>
 	<td class=''><pre><span class="comment"> * matching &lt;i&gt;format-name&lt;/i&gt; and &lt;i&gt;format-style&lt;/i&gt; is requested from</span></pre></td>
</tr>
<tr>
 	<td class=''>46</td>
 	<td class=''>47</td>
 	<td class=''><pre><span class="comment"> * &lt;code&gt;formatFactoryInstance&lt;/code&gt;.  If this is successful, the &lt;code&gt;Format&lt;/code&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>47</td>
 	<td class=''>48</td>
 	<td class=''><pre><span class="comment"> * found is used for this format element.</span></pre></td>
</tr>
<tr>
 	<td class=''>48</td>
 	<td class=''>49</td>
 	<td class=''><pre><span class="comment"> * &lt;/p&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>49</td>
 	<td class=''>50</td>
 	<td class=''><pre><span class="comment"> *</span></pre></td>
</tr>
<tr>
 	<td class=''>50</td>
 	<td class=''>51</td>
 	<td class=''><pre><span class="comment"> * &lt;p&gt;&lt;b&gt;NOTICE:&lt;/b&gt; The various subformat mutator methods are considered unnecessary; they exist on the parent</span></pre></td>
</tr>
<tr>
 	<td class=''>51</td>
 	<td class=''>52</td>
 	<td class=''><pre><span class="comment"> * class to allow the type of customization which it is the job of this class to provide in</span></pre></td>
</tr>
<tr>
 	<td class=''>52</td>
 	<td class=''>53</td>
 	<td class=''><pre><span class="comment"> * a configurable fashion.  These methods have thus been disabled and will throw</span></pre></td>
</tr>
<tr>
 	<td class=''>53</td>
 	<td class=''>54</td>
 	<td class=''><pre><span class="comment"> * &lt;code&gt;UnsupportedOperationException&lt;/code&gt; if called.</span></pre></td>
</tr>
<tr>
 	<td class=''>54</td>
 	<td class=''>55</td>
 	<td class=''><pre><span class="comment"> * &lt;/p&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>55</td>
 	<td class=''>56</td>
 	<td class=''><pre><span class="comment"> *</span></pre></td>
</tr>
<tr>
 	<td class=''>56</td>
 	<td class=''>57</td>
 	<td class=''><pre><span class="comment"> * &lt;p&gt;Limitations inherited from &lt;code&gt;java.text.MessageFormat&lt;/code&gt;:&lt;/p&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>57</td>
 	<td class=''>58</td>
 	<td class=''><pre><span class="comment"> * &lt;ul&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>58</td>
 	<td class=''>59</td>
 	<td class=''><pre><span class="comment"> * &lt;li&gt;When using "choice" subformats, support for nested formatting instructions is limited</span></pre></td>
</tr>
<tr>
 	<td class=''>59</td>
 	<td class=''>60</td>
 	<td class=''><pre><span class="comment"> *     to that provided by the base class.&lt;/li&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>60</td>
 	<td class=''>61</td>
 	<td class=''><pre><span class="comment"> * &lt;li&gt;Thread-safety of &lt;code&gt;Format&lt;/code&gt;s, including &lt;code&gt;MessageFormat&lt;/code&gt; and thus</span></pre></td>
</tr>
<tr>
 	<td class=''>61</td>
 	<td class=''>62</td>
 	<td class=''><pre><span class="comment"> *     &lt;code&gt;ExtendedMessageFormat&lt;/code&gt;, is not guaranteed.&lt;/li&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>62</td>
 	<td class=''>63</td>
 	<td class=''><pre><span class="comment"> * &lt;/ul&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>63</td>
 	<td class=''>64</td>
 	<td class=''><pre><span class="comment"> *</span></pre></td>
</tr>
<tr>
 	<td class=''>64</td>
 	<td class=''>65</td>
 	<td class=''><pre><span class="comment"> * @since 1.0</span></pre></td>
</tr>
<tr>
 	<td class=''>65</td>
 	<td class=''>66</td>
 	<td class=''><pre><span class="comment"> */</span></pre></td>
</tr>
<tr>
 	<td class='coveredLight'>66</td>
 	<td class='coveredLight'>67</td>
 	<td class='coveredLight'><pre><span class="keyword">public</span> <span class="keyword">class</span> ExtendedMessageFormat <span class="keyword">extends</span> MessageFormat {</pre></td>
</tr>
<tr>
 	<td class=''>67</td>
 	<td class=''>68</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>68</td>
 	<td class=''>69</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>69</td>
 	<td class=''>70</td>
 	<td class=''><pre><span class="comment">     * Serializable Object.</span></pre></td>
</tr>
<tr>
 	<td class=''>70</td>
 	<td class=''>71</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>71</td>
 	<td class=''>72</td>
 	<td class=''><pre>    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -2362048321261811743L;</pre></td>
</tr>
<tr>
 	<td class=''>72</td>
 	<td class=''>73</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>73</td>
 	<td class=''>74</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>74</td>
 	<td class=''>75</td>
 	<td class=''><pre><span class="comment">     * Our initial seed value for calculating hashes.</span></pre></td>
</tr>
<tr>
 	<td class=''>75</td>
 	<td class=''>76</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>76</td>
 	<td class=''>77</td>
 	<td class=''><pre>    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> HASH_SEED = 31;</pre></td>
</tr>
<tr>
 	<td class=''>77</td>
 	<td class=''>78</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>78</td>
 	<td class=''>79</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>79</td>
 	<td class=''>80</td>
 	<td class=''><pre><span class="comment">     * The empty string.</span></pre></td>
</tr>
<tr>
 	<td class=''>80</td>
 	<td class=''>81</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>81</td>
 	<td class=''>82</td>
 	<td class=''><pre>    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DUMMY_PATTERN = <span class="string">""</span>;</pre></td>
</tr>
<tr>
 	<td class=''>82</td>
 	<td class=''>83</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>83</td>
 	<td class=''>84</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>84</td>
 	<td class=''>85</td>
 	<td class=''><pre><span class="comment">     * A comma.</span></pre></td>
</tr>
<tr>
 	<td class=''>85</td>
 	<td class=''>86</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>86</td>
 	<td class=''>87</td>
 	<td class=''><pre>    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span> START_FMT = <span class="string">','</span>;</pre></td>
</tr>
<tr>
 	<td class=''>87</td>
 	<td class=''>88</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>88</td>
 	<td class=''>89</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>89</td>
 	<td class=''>90</td>
 	<td class=''><pre><span class="comment">     * A right side squigly brace.</span></pre></td>
</tr>
<tr>
 	<td class=''>90</td>
 	<td class=''>91</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>91</td>
 	<td class=''>92</td>
 	<td class=''><pre>    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span> END_FE = <span class="string">'}'</span>;</pre></td>
</tr>
<tr>
 	<td class=''>92</td>
 	<td class=''>93</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>93</td>
 	<td class=''>94</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>94</td>
 	<td class=''>95</td>
 	<td class=''><pre><span class="comment">     * A left side squigly brace.</span></pre></td>
</tr>
<tr>
 	<td class=''>95</td>
 	<td class=''>96</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>96</td>
 	<td class=''>97</td>
 	<td class=''><pre>    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span> START_FE = <span class="string">'{'</span>;</pre></td>
</tr>
<tr>
 	<td class=''>97</td>
 	<td class=''>98</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>98</td>
 	<td class=''>99</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>99</td>
 	<td class=''>100</td>
 	<td class=''><pre><span class="comment">     * A properly escaped character representing a single quote.</span></pre></td>
</tr>
<tr>
 	<td class=''>100</td>
 	<td class=''>101</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>101</td>
 	<td class=''>102</td>
 	<td class=''><pre>    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span> QUOTE = <span class="string">'\''</span>;</pre></td>
</tr>
<tr>
 	<td class=''>102</td>
 	<td class=''>103</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>103</td>
 	<td class=''>104</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>104</td>
 	<td class=''>105</td>
 	<td class=''><pre><span class="comment">     * To pattern string.</span></pre></td>
</tr>
<tr>
 	<td class=''>105</td>
 	<td class=''>106</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>106</td>
 	<td class=''>107</td>
 	<td class=''><pre>    <span class="keyword">private</span> String toPattern;</pre></td>
</tr>
<tr>
 	<td class=''>107</td>
 	<td class=''>108</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>108</td>
 	<td class=''>109</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>109</td>
 	<td class=''>110</td>
 	<td class=''><pre><span class="comment">     * Our registry of FormatFactory's.</span></pre></td>
</tr>
<tr>
 	<td class=''>110</td>
 	<td class=''>111</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>111</td>
 	<td class=''>112</td>
 	<td class=''><pre>    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, ? <span class="keyword">extends</span> FormatFactory&gt; registry;</pre></td>
</tr>
<tr>
 	<td class=''>112</td>
 	<td class=''>113</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>113</td>
 	<td class=''>114</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>114</td>
 	<td class=''>115</td>
 	<td class=''><pre><span class="comment">     * Create a new ExtendedMessageFormat for the default locale.</span></pre></td>
</tr>
<tr>
 	<td class=''>115</td>
 	<td class=''>116</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>116</td>
 	<td class=''>117</td>
 	<td class=''><pre><span class="comment">     * @param pattern  the pattern to use, not null</span></pre></td>
</tr>
<tr>
 	<td class=''>117</td>
 	<td class=''>118</td>
 	<td class=''><pre><span class="comment">     * @throws IllegalArgumentException in case of a bad pattern.</span></pre></td>
</tr>
<tr>
 	<td class=''>118</td>
 	<td class=''>119</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>119</td>
 	<td class=''>120</td>
 	<td class=''><pre>    <span class="keyword">public</span> ExtendedMessageFormat(<span class="keyword">final</span> String pattern) {</pre></td>
</tr>
<tr>
 	<td class='deletedRow coveredLight'>120</td>
 	<td class='deletedRow coveredLight'></td>
 	<td class='deletedRow coveredLight'><pre>        this(pattern, Locale.getDefault());</pre></td>
</tr>
<tr>
 	<td class='coveredDark left bottom top'></td>
 	<td class='coveredDark bottom top'>121</td>
 	<td class='coveredDark right bottom top'><pre>        <span class="keyword">this</span>(pattern, Locale.getDefault(Category.FORMAT));</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>121</td>
 	<td class='coveredLight'>122</td>
 	<td class='coveredLight'><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>122</td>
 	<td class=''>123</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>123</td>
 	<td class=''>124</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>124</td>
 	<td class=''>125</td>
 	<td class=''><pre><span class="comment">     * Create a new ExtendedMessageFormat.</span></pre></td>
</tr>
<tr>
 	<td class=''>125</td>
 	<td class=''>126</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>126</td>
 	<td class=''>127</td>
 	<td class=''><pre><span class="comment">     * @param pattern  the pattern to use, not null</span></pre></td>
</tr>
<tr>
 	<td class=''>127</td>
 	<td class=''>128</td>
 	<td class=''><pre><span class="comment">     * @param locale  the locale to use, not null</span></pre></td>
</tr>
<tr>
 	<td class=''>128</td>
 	<td class=''>129</td>
 	<td class=''><pre><span class="comment">     * @throws IllegalArgumentException in case of a bad pattern.</span></pre></td>
</tr>
<tr>
 	<td class=''>129</td>
 	<td class=''>130</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>130</td>
 	<td class=''>131</td>
 	<td class=''><pre>    <span class="keyword">public</span> ExtendedMessageFormat(<span class="keyword">final</span> String pattern, <span class="keyword">final</span> Locale locale) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>131</td>
 	<td class='coveredLight'>132</td>
 	<td class='coveredLight'><pre>        <span class="keyword">this</span>(pattern, locale, <span class="keyword">null</span>);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>132</td>
 	<td class='coveredLight'>133</td>
 	<td class='coveredLight'><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>133</td>
 	<td class=''>134</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>134</td>
 	<td class=''>135</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>135</td>
 	<td class=''>136</td>
 	<td class=''><pre><span class="comment">     * Create a new ExtendedMessageFormat for the default locale.</span></pre></td>
</tr>
<tr>
 	<td class=''>136</td>
 	<td class=''>137</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>137</td>
 	<td class=''>138</td>
 	<td class=''><pre><span class="comment">     * @param pattern  the pattern to use, not null</span></pre></td>
</tr>
<tr>
 	<td class=''>138</td>
 	<td class=''>139</td>
 	<td class=''><pre><span class="comment">     * @param registry  the registry of format factories, may be null</span></pre></td>
</tr>
<tr>
 	<td class=''>139</td>
 	<td class=''>140</td>
 	<td class=''><pre><span class="comment">     * @throws IllegalArgumentException in case of a bad pattern.</span></pre></td>
</tr>
<tr>
 	<td class=''>140</td>
 	<td class=''>141</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>141</td>
 	<td class=''>142</td>
 	<td class=''><pre>    <span class="keyword">public</span> ExtendedMessageFormat(<span class="keyword">final</span> String pattern,</pre></td>
</tr>
<tr>
 	<td class=''>142</td>
 	<td class=''>143</td>
 	<td class=''><pre>                                 <span class="keyword">final</span> Map&lt;String, ? <span class="keyword">extends</span> FormatFactory&gt; registry) {</pre></td>
</tr>
<tr>
 	<td class='deletedRow coveredLight'>143</td>
 	<td class='deletedRow coveredLight'></td>
 	<td class='deletedRow coveredLight'><pre>        this(pattern, Locale.getDefault(), registry);</pre></td>
</tr>
<tr>
 	<td class='coveredDark left bottom top'></td>
 	<td class='coveredDark bottom top'>144</td>
 	<td class='coveredDark right bottom top'><pre>        <span class="keyword">this</span>(pattern, Locale.getDefault(Category.FORMAT), registry);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>144</td>
 	<td class='coveredLight'>145</td>
 	<td class='coveredLight'><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>145</td>
 	<td class=''>146</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>146</td>
 	<td class=''>147</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>147</td>
 	<td class=''>148</td>
 	<td class=''><pre><span class="comment">     * Create a new ExtendedMessageFormat.</span></pre></td>
</tr>
<tr>
 	<td class=''>148</td>
 	<td class=''>149</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>149</td>
 	<td class=''>150</td>
 	<td class=''><pre><span class="comment">     * @param pattern  the pattern to use, not null</span></pre></td>
</tr>
<tr>
 	<td class=''>150</td>
 	<td class=''>151</td>
 	<td class=''><pre><span class="comment">     * @param locale  the locale to use, not null</span></pre></td>
</tr>
<tr>
 	<td class=''>151</td>
 	<td class=''>152</td>
 	<td class=''><pre><span class="comment">     * @param registry  the registry of format factories, may be null</span></pre></td>
</tr>
<tr>
 	<td class=''>152</td>
 	<td class=''>153</td>
 	<td class=''><pre><span class="comment">     * @throws IllegalArgumentException in case of a bad pattern.</span></pre></td>
</tr>
<tr>
 	<td class=''>153</td>
 	<td class=''>154</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>154</td>
 	<td class=''>155</td>
 	<td class=''><pre>    <span class="keyword">public</span> ExtendedMessageFormat(<span class="keyword">final</span> String pattern,</pre></td>
</tr>
<tr>
 	<td class=''>155</td>
 	<td class=''>156</td>
 	<td class=''><pre>                                 <span class="keyword">final</span> Locale locale,</pre></td>
</tr>
<tr>
 	<td class=''>156</td>
 	<td class=''>157</td>
 	<td class=''><pre>                                 <span class="keyword">final</span> Map&lt;String, ? <span class="keyword">extends</span> FormatFactory&gt; registry) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>157</td>
 	<td class='coveredLight'>158</td>
 	<td class='coveredLight'><pre>        <span class="keyword">super</span>(DUMMY_PATTERN);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>158</td>
 	<td class='coveredLight'>159</td>
 	<td class='coveredLight'><pre>        setLocale(locale);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>159</td>
 	<td class='coveredLight'>160</td>
 	<td class='coveredLight'><pre>        <span class="keyword">this</span>.registry = registry;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>160</td>
 	<td class='coveredLight'>161</td>
 	<td class='coveredLight'><pre>        applyPattern(pattern);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>161</td>
 	<td class='coveredLight'>162</td>
 	<td class='coveredLight'><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>162</td>
 	<td class=''>163</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>163</td>
 	<td class=''>164</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>164</td>
 	<td class=''>165</td>
 	<td class=''><pre><span class="comment">     * {@inheritDoc}</span></pre></td>
</tr>
<tr>
 	<td class=''>165</td>
 	<td class=''>166</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>166</td>
 	<td class=''>167</td>
 	<td class=''><pre>    @Override</pre></td>
</tr>
<tr>
 	<td class=''>167</td>
 	<td class=''>168</td>
 	<td class=''><pre>    <span class="keyword">public</span> String toPattern() {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>168</td>
 	<td class='coveredLight'>169</td>
 	<td class='coveredLight'><pre>        <span class="keyword">return</span> toPattern;</pre></td>
</tr>
<tr>
 	<td class=''>169</td>
 	<td class=''>170</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>170</td>
 	<td class=''>171</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>171</td>
 	<td class=''>172</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>172</td>
 	<td class=''>173</td>
 	<td class=''><pre><span class="comment">     * Apply the specified pattern.</span></pre></td>
</tr>
<tr>
 	<td class=''>173</td>
 	<td class=''>174</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>174</td>
 	<td class=''>175</td>
 	<td class=''><pre><span class="comment">     * @param pattern String</span></pre></td>
</tr>
<tr>
 	<td class=''>175</td>
 	<td class=''>176</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>176</td>
 	<td class=''>177</td>
 	<td class=''><pre>    @Override</pre></td>
</tr>
<tr>
 	<td class=''>177</td>
 	<td class=''>178</td>
 	<td class=''><pre>    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> applyPattern(<span class="keyword">final</span> String pattern) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>178</td>
 	<td class='coveredLight'>179</td>
 	<td class='coveredLight'><pre>        <span class="keyword">if</span> (registry == <span class="keyword">null</span>) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>179</td>
 	<td class='coveredLight'>180</td>
 	<td class='coveredLight'><pre>            <span class="keyword">super</span>.applyPattern(pattern);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>180</td>
 	<td class='coveredLight'>181</td>
 	<td class='coveredLight'><pre>            toPattern = <span class="keyword">super</span>.toPattern();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>181</td>
 	<td class='coveredLight'>182</td>
 	<td class='coveredLight'><pre>            <span class="keyword">return</span>;</pre></td>
</tr>
<tr>
 	<td class=''>182</td>
 	<td class=''>183</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>183</td>
 	<td class='coveredLight'>184</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> ArrayList&lt;Format&gt; foundFormats = <span class="keyword">new</span> ArrayList&lt;&gt;();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>184</td>
 	<td class='coveredLight'>185</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> ArrayList&lt;String&gt; foundDescriptions = <span class="keyword">new</span> ArrayList&lt;&gt;();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>185</td>
 	<td class='coveredLight'>186</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> StringBuilder stripCustom = <span class="keyword">new</span> StringBuilder(pattern.length());</pre></td>
</tr>
<tr>
 	<td class=''>186</td>
 	<td class=''>187</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class='coveredLight'>187</td>
 	<td class='coveredLight'>188</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> ParsePosition pos = <span class="keyword">new</span> ParsePosition(0);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>188</td>
 	<td class='coveredLight'>189</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> <span class="keyword">char</span>[] c = pattern.toCharArray();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>189</td>
 	<td class='coveredLight'>190</td>
 	<td class='coveredLight'><pre>        <span class="keyword">int</span> fmtCount = 0;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>190</td>
 	<td class='coveredLight'>191</td>
 	<td class='coveredLight'><pre>        <span class="keyword">while</span> (pos.getIndex() &lt; pattern.length()) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>191</td>
 	<td class='coveredLight'>192</td>
 	<td class='coveredLight'><pre>            <span class="keyword">switch</span> (c[pos.getIndex()]) {</pre></td>
</tr>
<tr>
 	<td class=''>192</td>
 	<td class=''>193</td>
 	<td class=''><pre>            <span class="keyword">case</span> QUOTE:</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>193</td>
 	<td class='coveredLight'>194</td>
 	<td class='coveredLight'><pre>                appendQuotedString(pattern, pos, stripCustom);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>194</td>
 	<td class='coveredLight'>195</td>
 	<td class='coveredLight'><pre>                <span class="keyword">break</span>;</pre></td>
</tr>
<tr>
 	<td class=''>195</td>
 	<td class=''>196</td>
 	<td class=''><pre>            <span class="keyword">case</span> START_FE:</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>196</td>
 	<td class='coveredLight'>197</td>
 	<td class='coveredLight'><pre>                fmtCount++;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>197</td>
 	<td class='coveredLight'>198</td>
 	<td class='coveredLight'><pre>                seekNonWs(pattern, pos);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>198</td>
 	<td class='coveredLight'>199</td>
 	<td class='coveredLight'><pre>                <span class="keyword">final</span> <span class="keyword">int</span> start = pos.getIndex();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>199</td>
 	<td class='coveredLight'>200</td>
 	<td class='coveredLight'><pre>                <span class="keyword">final</span> <span class="keyword">int</span> index = readArgumentIndex(pattern, next(pos));</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>200</td>
 	<td class='coveredLight'>201</td>
 	<td class='coveredLight'><pre>                stripCustom.append(START_FE).append(index);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>201</td>
 	<td class='coveredLight'>202</td>
 	<td class='coveredLight'><pre>                seekNonWs(pattern, pos);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>202</td>
 	<td class='coveredLight'>203</td>
 	<td class='coveredLight'><pre>                Format format = <span class="keyword">null</span>;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>203</td>
 	<td class='coveredLight'>204</td>
 	<td class='coveredLight'><pre>                String formatDescription = <span class="keyword">null</span>;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>204</td>
 	<td class='coveredLight'>205</td>
 	<td class='coveredLight'><pre>                <span class="keyword">if</span> (c[pos.getIndex()] == START_FMT) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>205</td>
 	<td class='coveredLight'>206</td>
 	<td class='coveredLight'><pre>                    formatDescription = parseFormatDescription(pattern,</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>206</td>
 	<td class='coveredLight'>207</td>
 	<td class='coveredLight'><pre>                            next(pos));</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>207</td>
 	<td class='coveredLight'>208</td>
 	<td class='coveredLight'><pre>                    format = getFormat(formatDescription);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>208</td>
 	<td class='coveredLight'>209</td>
 	<td class='coveredLight'><pre>                    <span class="keyword">if</span> (format == <span class="keyword">null</span>) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>209</td>
 	<td class='coveredLight'>210</td>
 	<td class='coveredLight'><pre>                        stripCustom.append(START_FMT).append(formatDescription);</pre></td>
</tr>
<tr>
 	<td class=''>210</td>
 	<td class=''>211</td>
 	<td class=''><pre>                    }</pre></td>
</tr>
<tr>
 	<td class=''>211</td>
 	<td class=''>212</td>
 	<td class=''><pre>                }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>212</td>
 	<td class='coveredLight'>213</td>
 	<td class='coveredLight'><pre>                foundFormats.add(format);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>213</td>
 	<td class='coveredLight'>214</td>
 	<td class='coveredLight'><pre>                foundDescriptions.add(format == <span class="keyword">null</span> ? <span class="keyword">null</span> : formatDescription);</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>214</td>
 	<td class='notCoveredLight'>215</td>
 	<td class='notCoveredLight'><pre>                <span class="keyword">if</span> (foundFormats.size() != fmtCount) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>215</td>
 	<td class='notCoveredLight'>216</td>
 	<td class='notCoveredLight'><pre>                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"The validated expression is false"</span>);</pre></td>
</tr>
<tr>
 	<td class=''>216</td>
 	<td class=''>217</td>
 	<td class=''><pre>                }</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>217</td>
 	<td class='notCoveredLight'>218</td>
 	<td class='notCoveredLight'><pre>                <span class="keyword">if</span> (foundDescriptions.size() != fmtCount) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>218</td>
 	<td class='notCoveredLight'>219</td>
 	<td class='notCoveredLight'><pre>                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"The validated expression is false"</span>);</pre></td>
</tr>
<tr>
 	<td class=''>219</td>
 	<td class=''>220</td>
 	<td class=''><pre>                }</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>220</td>
 	<td class='notCoveredLight'>221</td>
 	<td class='notCoveredLight'><pre>                <span class="keyword">if</span> (c[pos.getIndex()] != END_FE) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>221</td>
 	<td class='notCoveredLight'>222</td>
 	<td class='notCoveredLight'><pre>                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</pre></td>
</tr>
<tr>
 	<td class=''>222</td>
 	<td class=''>223</td>
 	<td class=''><pre>                            <span class="string">"Unreadable format element at position "</span> + start);</pre></td>
</tr>
<tr>
 	<td class=''>223</td>
 	<td class=''>224</td>
 	<td class=''><pre>                }</pre></td>
</tr>
<tr>
 	<td class=''>224</td>
 	<td class=''>225</td>
 	<td class=''><pre>                <span class="comment">//$FALL-THROUGH$</span></pre></td>
</tr>
<tr>
 	<td class=''>225</td>
 	<td class=''>226</td>
 	<td class=''><pre>            <span class="keyword">default</span>:</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>226</td>
 	<td class='coveredLight'>227</td>
 	<td class='coveredLight'><pre>                stripCustom.append(c[pos.getIndex()]);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>227</td>
 	<td class='coveredLight'>228</td>
 	<td class='coveredLight'><pre>                next(pos);</pre></td>
</tr>
<tr>
 	<td class=''>228</td>
 	<td class=''>229</td>
 	<td class=''><pre>            }</pre></td>
</tr>
<tr>
 	<td class=''>229</td>
 	<td class=''>230</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>230</td>
 	<td class='coveredLight'>231</td>
 	<td class='coveredLight'><pre>        <span class="keyword">super</span>.applyPattern(stripCustom.toString());</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>231</td>
 	<td class='coveredLight'>232</td>
 	<td class='coveredLight'><pre>        toPattern = insertFormats(<span class="keyword">super</span>.toPattern(), foundDescriptions);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>232</td>
 	<td class='coveredLight'>233</td>
 	<td class='coveredLight'><pre>        <span class="keyword">if</span> (containsElements(foundFormats)) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>233</td>
 	<td class='coveredLight'>234</td>
 	<td class='coveredLight'><pre>            <span class="keyword">final</span> Format[] origFormats = getFormats();</pre></td>
</tr>
<tr>
 	<td class=''>234</td>
 	<td class=''>235</td>
 	<td class=''><pre>            <span class="comment">// only loop over what we know we have, as MessageFormat on Java 1.3</span></pre></td>
</tr>
<tr>
 	<td class=''>235</td>
 	<td class=''>236</td>
 	<td class=''><pre>            <span class="comment">// seems to provide an extra format element:</span></pre></td>
</tr>
<tr>
 	<td class='coveredLight'>236</td>
 	<td class='coveredLight'>237</td>
 	<td class='coveredLight'><pre>            <span class="keyword">int</span> i = 0;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>237</td>
 	<td class='coveredLight'>238</td>
 	<td class='coveredLight'><pre>            <span class="keyword">for</span> (<span class="keyword">final</span> Iterator&lt;Format&gt; it = foundFormats.iterator(); it.hasNext(); i++) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>238</td>
 	<td class='coveredLight'>239</td>
 	<td class='coveredLight'><pre>                <span class="keyword">final</span> Format f = it.next();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>239</td>
 	<td class='coveredLight'>240</td>
 	<td class='coveredLight'><pre>                <span class="keyword">if</span> (f != <span class="keyword">null</span>) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>240</td>
 	<td class='coveredLight'>241</td>
 	<td class='coveredLight'><pre>                    origFormats[i] = f;</pre></td>
</tr>
<tr>
 	<td class=''>241</td>
 	<td class=''>242</td>
 	<td class=''><pre>                }</pre></td>
</tr>
<tr>
 	<td class=''>242</td>
 	<td class=''>243</td>
 	<td class=''><pre>            }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>243</td>
 	<td class='coveredLight'>244</td>
 	<td class='coveredLight'><pre>            <span class="keyword">super</span>.setFormats(origFormats);</pre></td>
</tr>
<tr>
 	<td class=''>244</td>
 	<td class=''>245</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>245</td>
 	<td class='coveredLight'>246</td>
 	<td class='coveredLight'><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>246</td>
 	<td class=''>247</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>247</td>
 	<td class=''>248</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>248</td>
 	<td class=''>249</td>
 	<td class=''><pre><span class="comment">     * Throws UnsupportedOperationException - see class Javadoc for details.</span></pre></td>
</tr>
<tr>
 	<td class=''>249</td>
 	<td class=''>250</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>250</td>
 	<td class=''>251</td>
 	<td class=''><pre><span class="comment">     * @param formatElementIndex format element index</span></pre></td>
</tr>
<tr>
 	<td class=''>251</td>
 	<td class=''>252</td>
 	<td class=''><pre><span class="comment">     * @param newFormat the new format</span></pre></td>
</tr>
<tr>
 	<td class=''>252</td>
 	<td class=''>253</td>
 	<td class=''><pre><span class="comment">     * @throws UnsupportedOperationException always thrown since this isn't</span></pre></td>
</tr>
<tr>
 	<td class=''>253</td>
 	<td class=''>254</td>
 	<td class=''><pre><span class="comment">     *                                       supported by ExtendMessageFormat</span></pre></td>
</tr>
<tr>
 	<td class=''>254</td>
 	<td class=''>255</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>255</td>
 	<td class=''>256</td>
 	<td class=''><pre>    @Override</pre></td>
</tr>
<tr>
 	<td class=''>256</td>
 	<td class=''>257</td>
 	<td class=''><pre>    <span class="keyword">public</span> <span class="keyword">void</span> setFormat(<span class="keyword">final</span> <span class="keyword">int</span> formatElementIndex, <span class="keyword">final</span> Format newFormat) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>257</td>
 	<td class='coveredLight'>258</td>
 	<td class='coveredLight'><pre>        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</pre></td>
</tr>
<tr>
 	<td class=''>258</td>
 	<td class=''>259</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>259</td>
 	<td class=''>260</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>260</td>
 	<td class=''>261</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>261</td>
 	<td class=''>262</td>
 	<td class=''><pre><span class="comment">     * Throws UnsupportedOperationException - see class Javadoc for details.</span></pre></td>
</tr>
<tr>
 	<td class=''>262</td>
 	<td class=''>263</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>263</td>
 	<td class=''>264</td>
 	<td class=''><pre><span class="comment">     * @param argumentIndex argument index</span></pre></td>
</tr>
<tr>
 	<td class=''>264</td>
 	<td class=''>265</td>
 	<td class=''><pre><span class="comment">     * @param newFormat the new format</span></pre></td>
</tr>
<tr>
 	<td class=''>265</td>
 	<td class=''>266</td>
 	<td class=''><pre><span class="comment">     * @throws UnsupportedOperationException always thrown since this isn't</span></pre></td>
</tr>
<tr>
 	<td class=''>266</td>
 	<td class=''>267</td>
 	<td class=''><pre><span class="comment">     *                                       supported by ExtendMessageFormat</span></pre></td>
</tr>
<tr>
 	<td class=''>267</td>
 	<td class=''>268</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>268</td>
 	<td class=''>269</td>
 	<td class=''><pre>    @Override</pre></td>
</tr>
<tr>
 	<td class=''>269</td>
 	<td class=''>270</td>
 	<td class=''><pre>    <span class="keyword">public</span> <span class="keyword">void</span> setFormatByArgumentIndex(<span class="keyword">final</span> <span class="keyword">int</span> argumentIndex,</pre></td>
</tr>
<tr>
 	<td class=''>270</td>
 	<td class=''>271</td>
 	<td class=''><pre>                                         <span class="keyword">final</span> Format newFormat) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>271</td>
 	<td class='coveredLight'>272</td>
 	<td class='coveredLight'><pre>        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</pre></td>
</tr>
<tr>
 	<td class=''>272</td>
 	<td class=''>273</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>273</td>
 	<td class=''>274</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>274</td>
 	<td class=''>275</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>275</td>
 	<td class=''>276</td>
 	<td class=''><pre><span class="comment">     * Throws UnsupportedOperationException - see class Javadoc for details.</span></pre></td>
</tr>
<tr>
 	<td class=''>276</td>
 	<td class=''>277</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>277</td>
 	<td class=''>278</td>
 	<td class=''><pre><span class="comment">     * @param newFormats new formats</span></pre></td>
</tr>
<tr>
 	<td class=''>278</td>
 	<td class=''>279</td>
 	<td class=''><pre><span class="comment">     * @throws UnsupportedOperationException always thrown since this isn't</span></pre></td>
</tr>
<tr>
 	<td class=''>279</td>
 	<td class=''>280</td>
 	<td class=''><pre><span class="comment">     *                                       supported by ExtendMessageFormat</span></pre></td>
</tr>
<tr>
 	<td class=''>280</td>
 	<td class=''>281</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>281</td>
 	<td class=''>282</td>
 	<td class=''><pre>    @Override</pre></td>
</tr>
<tr>
 	<td class=''>282</td>
 	<td class=''>283</td>
 	<td class=''><pre>    <span class="keyword">public</span> <span class="keyword">void</span> setFormats(<span class="keyword">final</span> Format[] newFormats) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>283</td>
 	<td class='coveredLight'>284</td>
 	<td class='coveredLight'><pre>        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</pre></td>
</tr>
<tr>
 	<td class=''>284</td>
 	<td class=''>285</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>285</td>
 	<td class=''>286</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>286</td>
 	<td class=''>287</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>287</td>
 	<td class=''>288</td>
 	<td class=''><pre><span class="comment">     * Throws UnsupportedOperationException - see class Javadoc for details.</span></pre></td>
</tr>
<tr>
 	<td class=''>288</td>
 	<td class=''>289</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>289</td>
 	<td class=''>290</td>
 	<td class=''><pre><span class="comment">     * @param newFormats new formats</span></pre></td>
</tr>
<tr>
 	<td class=''>290</td>
 	<td class=''>291</td>
 	<td class=''><pre><span class="comment">     * @throws UnsupportedOperationException always thrown since this isn't</span></pre></td>
</tr>
<tr>
 	<td class=''>291</td>
 	<td class=''>292</td>
 	<td class=''><pre><span class="comment">     *                                       supported by ExtendMessageFormat</span></pre></td>
</tr>
<tr>
 	<td class=''>292</td>
 	<td class=''>293</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>293</td>
 	<td class=''>294</td>
 	<td class=''><pre>    @Override</pre></td>
</tr>
<tr>
 	<td class=''>294</td>
 	<td class=''>295</td>
 	<td class=''><pre>    <span class="keyword">public</span> <span class="keyword">void</span> setFormatsByArgumentIndex(<span class="keyword">final</span> Format[] newFormats) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>295</td>
 	<td class='coveredLight'>296</td>
 	<td class='coveredLight'><pre>        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</pre></td>
</tr>
<tr>
 	<td class=''>296</td>
 	<td class=''>297</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>297</td>
 	<td class=''>298</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>298</td>
 	<td class=''>299</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>299</td>
 	<td class=''>300</td>
 	<td class=''><pre><span class="comment">     * Check if this extended message format is equal to another object.</span></pre></td>
</tr>
<tr>
 	<td class=''>300</td>
 	<td class=''>301</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>301</td>
 	<td class=''>302</td>
 	<td class=''><pre><span class="comment">     * @param obj the object to compare to</span></pre></td>
</tr>
<tr>
 	<td class=''>302</td>
 	<td class=''>303</td>
 	<td class=''><pre><span class="comment">     * @return true if this object equals the other, otherwise false</span></pre></td>
</tr>
<tr>
 	<td class=''>303</td>
 	<td class=''>304</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>304</td>
 	<td class=''>305</td>
 	<td class=''><pre>    @Override</pre></td>
</tr>
<tr>
 	<td class=''>305</td>
 	<td class=''>306</td>
 	<td class=''><pre>    <span class="keyword">public</span> <span class="keyword">boolean</span> equals(<span class="keyword">final</span> Object obj) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>306</td>
 	<td class='coveredLight'>307</td>
 	<td class='coveredLight'><pre>        <span class="keyword">if</span> (obj == <span class="keyword">this</span>) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>307</td>
 	<td class='coveredLight'>308</td>
 	<td class='coveredLight'><pre>            <span class="keyword">return</span> <span class="keyword">true</span>;</pre></td>
</tr>
<tr>
 	<td class=''>308</td>
 	<td class=''>309</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>309</td>
 	<td class='coveredLight'>310</td>
 	<td class='coveredLight'><pre>        <span class="keyword">if</span> (obj == <span class="keyword">null</span>) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>310</td>
 	<td class='coveredLight'>311</td>
 	<td class='coveredLight'><pre>            <span class="keyword">return</span> <span class="keyword">false</span>;</pre></td>
</tr>
<tr>
 	<td class=''>311</td>
 	<td class=''>312</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>312</td>
 	<td class='coveredLight'>313</td>
 	<td class='coveredLight'><pre>        <span class="keyword">if</span> (!<span class="keyword">super</span>.equals(obj)) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>313</td>
 	<td class='coveredLight'>314</td>
 	<td class='coveredLight'><pre>            <span class="keyword">return</span> <span class="keyword">false</span>;</pre></td>
</tr>
<tr>
 	<td class=''>314</td>
 	<td class=''>315</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>315</td>
 	<td class='notCoveredLight'>316</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">if</span> (!Objects.equals(getClass(), obj.getClass())) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>316</td>
 	<td class='notCoveredLight'>317</td>
 	<td class='notCoveredLight'><pre>          <span class="keyword">return</span> <span class="keyword">false</span>;</pre></td>
</tr>
<tr>
 	<td class=''>317</td>
 	<td class=''>318</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>318</td>
 	<td class='coveredLight'>319</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> ExtendedMessageFormat rhs = (ExtendedMessageFormat) obj;</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>319</td>
 	<td class='notCoveredLight'>320</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">if</span> (!Objects.equals(toPattern, rhs.toPattern)) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>320</td>
 	<td class='notCoveredLight'>321</td>
 	<td class='notCoveredLight'><pre>            <span class="keyword">return</span> <span class="keyword">false</span>;</pre></td>
</tr>
<tr>
 	<td class=''>321</td>
 	<td class=''>322</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>322</td>
 	<td class='notCoveredLight'>323</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">if</span> (!Objects.equals(registry, rhs.registry)) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>323</td>
 	<td class='notCoveredLight'>324</td>
 	<td class='notCoveredLight'><pre>            <span class="keyword">return</span> <span class="keyword">false</span>;</pre></td>
</tr>
<tr>
 	<td class=''>324</td>
 	<td class=''>325</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>325</td>
 	<td class='coveredLight'>326</td>
 	<td class='coveredLight'><pre>        <span class="keyword">return</span> <span class="keyword">true</span>;</pre></td>
</tr>
<tr>
 	<td class=''>326</td>
 	<td class=''>327</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>327</td>
 	<td class=''>328</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>328</td>
 	<td class=''>329</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>329</td>
 	<td class=''>330</td>
 	<td class=''><pre><span class="comment">     * {@inheritDoc}</span></pre></td>
</tr>
<tr>
 	<td class=''>330</td>
 	<td class=''>331</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>331</td>
 	<td class=''>332</td>
 	<td class=''><pre>    @Override</pre></td>
</tr>
<tr>
 	<td class=''>332</td>
 	<td class=''>333</td>
 	<td class=''><pre>    <span class="keyword">public</span> <span class="keyword">int</span> hashCode() {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>333</td>
 	<td class='coveredLight'>334</td>
 	<td class='coveredLight'><pre>        <span class="keyword">int</span> result = <span class="keyword">super</span>.hashCode();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>334</td>
 	<td class='coveredLight'>335</td>
 	<td class='coveredLight'><pre>        result = HASH_SEED * result + Objects.hashCode(registry);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>335</td>
 	<td class='coveredLight'>336</td>
 	<td class='coveredLight'><pre>        result = HASH_SEED * result + Objects.hashCode(toPattern);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>336</td>
 	<td class='coveredLight'>337</td>
 	<td class='coveredLight'><pre>        <span class="keyword">return</span> result;</pre></td>
</tr>
<tr>
 	<td class=''>337</td>
 	<td class=''>338</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>338</td>
 	<td class=''>339</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>339</td>
 	<td class=''>340</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>340</td>
 	<td class=''>341</td>
 	<td class=''><pre><span class="comment">     * Get a custom format from a format description.</span></pre></td>
</tr>
<tr>
 	<td class=''>341</td>
 	<td class=''>342</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>342</td>
 	<td class=''>343</td>
 	<td class=''><pre><span class="comment">     * @param desc String</span></pre></td>
</tr>
<tr>
 	<td class=''>343</td>
 	<td class=''>344</td>
 	<td class=''><pre><span class="comment">     * @return Format</span></pre></td>
</tr>
<tr>
 	<td class=''>344</td>
 	<td class=''>345</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>345</td>
 	<td class=''>346</td>
 	<td class=''><pre>    <span class="keyword">private</span> Format getFormat(<span class="keyword">final</span> String desc) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>346</td>
 	<td class='notCoveredLight'>347</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">if</span> (registry != <span class="keyword">null</span>) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>347</td>
 	<td class='coveredLight'>348</td>
 	<td class='coveredLight'><pre>            String name = desc;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>348</td>
 	<td class='coveredLight'>349</td>
 	<td class='coveredLight'><pre>            String args = <span class="keyword">null</span>;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>349</td>
 	<td class='coveredLight'>350</td>
 	<td class='coveredLight'><pre>            <span class="keyword">final</span> <span class="keyword">int</span> i = desc.indexOf(START_FMT);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>350</td>
 	<td class='coveredLight'>351</td>
 	<td class='coveredLight'><pre>            <span class="keyword">if</span> (i &gt; 0) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>351</td>
 	<td class='coveredLight'>352</td>
 	<td class='coveredLight'><pre>                name = desc.substring(0, i).trim();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>352</td>
 	<td class='coveredLight'>353</td>
 	<td class='coveredLight'><pre>                args = desc.substring(i + 1).trim();</pre></td>
</tr>
<tr>
 	<td class=''>353</td>
 	<td class=''>354</td>
 	<td class=''><pre>            }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>354</td>
 	<td class='coveredLight'>355</td>
 	<td class='coveredLight'><pre>            <span class="keyword">final</span> FormatFactory factory = registry.get(name);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>355</td>
 	<td class='coveredLight'>356</td>
 	<td class='coveredLight'><pre>            <span class="keyword">if</span> (factory != <span class="keyword">null</span>) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>356</td>
 	<td class='coveredLight'>357</td>
 	<td class='coveredLight'><pre>                <span class="keyword">return</span> factory.getFormat(name, args, getLocale());</pre></td>
</tr>
<tr>
 	<td class=''>357</td>
 	<td class=''>358</td>
 	<td class=''><pre>            }</pre></td>
</tr>
<tr>
 	<td class=''>358</td>
 	<td class=''>359</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>359</td>
 	<td class='coveredLight'>360</td>
 	<td class='coveredLight'><pre>        <span class="keyword">return</span> <span class="keyword">null</span>;</pre></td>
</tr>
<tr>
 	<td class=''>360</td>
 	<td class=''>361</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>361</td>
 	<td class=''>362</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>362</td>
 	<td class=''>363</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>363</td>
 	<td class=''>364</td>
 	<td class=''><pre><span class="comment">     * Read the argument index from the current format element.</span></pre></td>
</tr>
<tr>
 	<td class=''>364</td>
 	<td class=''>365</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>365</td>
 	<td class=''>366</td>
 	<td class=''><pre><span class="comment">     * @param pattern pattern to parse</span></pre></td>
</tr>
<tr>
 	<td class=''>366</td>
 	<td class=''>367</td>
 	<td class=''><pre><span class="comment">     * @param pos current parse position</span></pre></td>
</tr>
<tr>
 	<td class=''>367</td>
 	<td class=''>368</td>
 	<td class=''><pre><span class="comment">     * @return argument index</span></pre></td>
</tr>
<tr>
 	<td class=''>368</td>
 	<td class=''>369</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>369</td>
 	<td class=''>370</td>
 	<td class=''><pre>    <span class="keyword">private</span> <span class="keyword">int</span> readArgumentIndex(<span class="keyword">final</span> String pattern, <span class="keyword">final</span> ParsePosition pos) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>370</td>
 	<td class='coveredLight'>371</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> <span class="keyword">int</span> start = pos.getIndex();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>371</td>
 	<td class='coveredLight'>372</td>
 	<td class='coveredLight'><pre>        seekNonWs(pattern, pos);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>372</td>
 	<td class='coveredLight'>373</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> StringBuilder result = <span class="keyword">new</span> StringBuilder();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>373</td>
 	<td class='coveredLight'>374</td>
 	<td class='coveredLight'><pre>        <span class="keyword">boolean</span> error = <span class="keyword">false</span>;</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>374</td>
 	<td class='notCoveredLight'>375</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">for</span> (; !error &amp;&amp; pos.getIndex() &lt; pattern.length(); next(pos)) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>375</td>
 	<td class='coveredLight'>376</td>
 	<td class='coveredLight'><pre>            <span class="keyword">char</span> c = pattern.charAt(pos.getIndex());</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>376</td>
 	<td class='notCoveredLight'>377</td>
 	<td class='notCoveredLight'><pre>            <span class="keyword">if</span> (Character.isWhitespace(c)) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>377</td>
 	<td class='notCoveredLight'>378</td>
 	<td class='notCoveredLight'><pre>                seekNonWs(pattern, pos);</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>378</td>
 	<td class='notCoveredLight'>379</td>
 	<td class='notCoveredLight'><pre>                c = pattern.charAt(pos.getIndex());</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>379</td>
 	<td class='notCoveredLight'>380</td>
 	<td class='notCoveredLight'><pre>                <span class="keyword">if</span> (c != START_FMT &amp;&amp; c != END_FE) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>380</td>
 	<td class='notCoveredLight'>381</td>
 	<td class='notCoveredLight'><pre>                    error = <span class="keyword">true</span>;</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>381</td>
 	<td class='notCoveredLight'>382</td>
 	<td class='notCoveredLight'><pre>                    <span class="keyword">continue</span>;</pre></td>
</tr>
<tr>
 	<td class=''>382</td>
 	<td class=''>383</td>
 	<td class=''><pre>                }</pre></td>
</tr>
<tr>
 	<td class=''>383</td>
 	<td class=''>384</td>
 	<td class=''><pre>            }</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>384</td>
 	<td class='notCoveredLight'>385</td>
 	<td class='notCoveredLight'><pre>            <span class="keyword">if</span> ((c == START_FMT || c == END_FE) &amp;&amp; result.length() &gt; 0) {</pre></td>
</tr>
<tr>
 	<td class=''>385</td>
 	<td class=''>386</td>
 	<td class=''><pre>                <span class="keyword">try</span> {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>386</td>
 	<td class='coveredLight'>387</td>
 	<td class='coveredLight'><pre>                    <span class="keyword">return</span> Integer.parseInt(result.toString());</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>387</td>
 	<td class='notCoveredLight'>388</td>
 	<td class='notCoveredLight'><pre>                } <span class="keyword">catch</span> (<span class="keyword">final</span> NumberFormatException e) { <span class="comment">// NOPMD</span></pre></td>
</tr>
<tr>
 	<td class=''>388</td>
 	<td class=''>389</td>
 	<td class=''><pre>                    <span class="comment">// we've already ensured only digits, so unless something</span></pre></td>
</tr>
<tr>
 	<td class=''>389</td>
 	<td class=''>390</td>
 	<td class=''><pre>                    <span class="comment">// outlandishly large was specified we should be okay.</span></pre></td>
</tr>
<tr>
 	<td class=''>390</td>
 	<td class=''>391</td>
 	<td class=''><pre>                }</pre></td>
</tr>
<tr>
 	<td class=''>391</td>
 	<td class=''>392</td>
 	<td class=''><pre>            }</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>392</td>
 	<td class='notCoveredLight'>393</td>
 	<td class='notCoveredLight'><pre>            error = !Character.isDigit(c);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>393</td>
 	<td class='coveredLight'>394</td>
 	<td class='coveredLight'><pre>            result.append(c);</pre></td>
</tr>
<tr>
 	<td class=''>394</td>
 	<td class=''>395</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>395</td>
 	<td class='notCoveredLight'>396</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">if</span> (error) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>396</td>
 	<td class='notCoveredLight'>397</td>
 	<td class='notCoveredLight'><pre>            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</pre></td>
</tr>
<tr>
 	<td class=''>397</td>
 	<td class=''>398</td>
 	<td class=''><pre>                    <span class="string">"Invalid format argument index at position "</span> + start + <span class="string">": "</span></pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>398</td>
 	<td class='notCoveredLight'>399</td>
 	<td class='notCoveredLight'><pre>                            + pattern.substring(start, pos.getIndex()));</pre></td>
</tr>
<tr>
 	<td class=''>399</td>
 	<td class=''>400</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>400</td>
 	<td class='notCoveredLight'>401</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</pre></td>
</tr>
<tr>
 	<td class=''>401</td>
 	<td class=''>402</td>
 	<td class=''><pre>                <span class="string">"Unterminated format element at position "</span> + start);</pre></td>
</tr>
<tr>
 	<td class=''>402</td>
 	<td class=''>403</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>403</td>
 	<td class=''>404</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>404</td>
 	<td class=''>405</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>405</td>
 	<td class=''>406</td>
 	<td class=''><pre><span class="comment">     * Parse the format component of a format element.</span></pre></td>
</tr>
<tr>
 	<td class=''>406</td>
 	<td class=''>407</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>407</td>
 	<td class=''>408</td>
 	<td class=''><pre><span class="comment">     * @param pattern string to parse</span></pre></td>
</tr>
<tr>
 	<td class=''>408</td>
 	<td class=''>409</td>
 	<td class=''><pre><span class="comment">     * @param pos current parse position</span></pre></td>
</tr>
<tr>
 	<td class=''>409</td>
 	<td class=''>410</td>
 	<td class=''><pre><span class="comment">     * @return Format description String</span></pre></td>
</tr>
<tr>
 	<td class=''>410</td>
 	<td class=''>411</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>411</td>
 	<td class=''>412</td>
 	<td class=''><pre>    <span class="keyword">private</span> String parseFormatDescription(<span class="keyword">final</span> String pattern, <span class="keyword">final</span> ParsePosition pos) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>412</td>
 	<td class='coveredLight'>413</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> <span class="keyword">int</span> start = pos.getIndex();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>413</td>
 	<td class='coveredLight'>414</td>
 	<td class='coveredLight'><pre>        seekNonWs(pattern, pos);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>414</td>
 	<td class='coveredLight'>415</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> <span class="keyword">int</span> text = pos.getIndex();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>415</td>
 	<td class='coveredLight'>416</td>
 	<td class='coveredLight'><pre>        <span class="keyword">int</span> depth = 1;</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>416</td>
 	<td class='notCoveredLight'>417</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">for</span> (; pos.getIndex() &lt; pattern.length(); next(pos)) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>417</td>
 	<td class='notCoveredLight'>418</td>
 	<td class='notCoveredLight'><pre>            <span class="keyword">switch</span> (pattern.charAt(pos.getIndex())) {</pre></td>
</tr>
<tr>
 	<td class=''>418</td>
 	<td class=''>419</td>
 	<td class=''><pre>            <span class="keyword">case</span> START_FE:</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>419</td>
 	<td class='coveredLight'>420</td>
 	<td class='coveredLight'><pre>                depth++;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>420</td>
 	<td class='coveredLight'>421</td>
 	<td class='coveredLight'><pre>                <span class="keyword">break</span>;</pre></td>
</tr>
<tr>
 	<td class=''>421</td>
 	<td class=''>422</td>
 	<td class=''><pre>            <span class="keyword">case</span> END_FE:</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>422</td>
 	<td class='coveredLight'>423</td>
 	<td class='coveredLight'><pre>                depth--;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>423</td>
 	<td class='coveredLight'>424</td>
 	<td class='coveredLight'><pre>                <span class="keyword">if</span> (depth == 0) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>424</td>
 	<td class='coveredLight'>425</td>
 	<td class='coveredLight'><pre>                    <span class="keyword">return</span> pattern.substring(text, pos.getIndex());</pre></td>
</tr>
<tr>
 	<td class=''>425</td>
 	<td class=''>426</td>
 	<td class=''><pre>                }</pre></td>
</tr>
<tr>
 	<td class=''>426</td>
 	<td class=''>427</td>
 	<td class=''><pre>                <span class="keyword">break</span>;</pre></td>
</tr>
<tr>
 	<td class=''>427</td>
 	<td class=''>428</td>
 	<td class=''><pre>            <span class="keyword">case</span> QUOTE:</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>428</td>
 	<td class='notCoveredLight'>429</td>
 	<td class='notCoveredLight'><pre>                getQuotedString(pattern, pos);</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>429</td>
 	<td class='notCoveredLight'>430</td>
 	<td class='notCoveredLight'><pre>                <span class="keyword">break</span>;</pre></td>
</tr>
<tr>
 	<td class=''>430</td>
 	<td class=''>431</td>
 	<td class=''><pre>            <span class="keyword">default</span>:</pre></td>
</tr>
<tr>
 	<td class=''>431</td>
 	<td class=''>432</td>
 	<td class=''><pre>                <span class="keyword">break</span>;</pre></td>
</tr>
<tr>
 	<td class=''>432</td>
 	<td class=''>433</td>
 	<td class=''><pre>            }</pre></td>
</tr>
<tr>
 	<td class=''>433</td>
 	<td class=''>434</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>434</td>
 	<td class='notCoveredLight'>435</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</pre></td>
</tr>
<tr>
 	<td class=''>435</td>
 	<td class=''>436</td>
 	<td class=''><pre>                <span class="string">"Unterminated format element at position "</span> + start);</pre></td>
</tr>
<tr>
 	<td class=''>436</td>
 	<td class=''>437</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>437</td>
 	<td class=''>438</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>438</td>
 	<td class=''>439</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>439</td>
 	<td class=''>440</td>
 	<td class=''><pre><span class="comment">     * Insert formats back into the pattern for toPattern() support.</span></pre></td>
</tr>
<tr>
 	<td class=''>440</td>
 	<td class=''>441</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>441</td>
 	<td class=''>442</td>
 	<td class=''><pre><span class="comment">     * @param pattern source</span></pre></td>
</tr>
<tr>
 	<td class=''>442</td>
 	<td class=''>443</td>
 	<td class=''><pre><span class="comment">     * @param customPatterns The custom patterns to re-insert, if any</span></pre></td>
</tr>
<tr>
 	<td class=''>443</td>
 	<td class=''>444</td>
 	<td class=''><pre><span class="comment">     * @return full pattern</span></pre></td>
</tr>
<tr>
 	<td class=''>444</td>
 	<td class=''>445</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>445</td>
 	<td class=''>446</td>
 	<td class=''><pre>    <span class="keyword">private</span> String insertFormats(<span class="keyword">final</span> String pattern, <span class="keyword">final</span> ArrayList&lt;String&gt; customPatterns) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>446</td>
 	<td class='coveredLight'>447</td>
 	<td class='coveredLight'><pre>        <span class="keyword">if</span> (!containsElements(customPatterns)) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>447</td>
 	<td class='coveredLight'>448</td>
 	<td class='coveredLight'><pre>            <span class="keyword">return</span> pattern;</pre></td>
</tr>
<tr>
 	<td class=''>448</td>
 	<td class=''>449</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>449</td>
 	<td class='coveredLight'>450</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> StringBuilder sb = <span class="keyword">new</span> StringBuilder(pattern.length() * 2);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>450</td>
 	<td class='coveredLight'>451</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> ParsePosition pos = <span class="keyword">new</span> ParsePosition(0);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>451</td>
 	<td class='coveredLight'>452</td>
 	<td class='coveredLight'><pre>        <span class="keyword">int</span> fe = -1;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>452</td>
 	<td class='coveredLight'>453</td>
 	<td class='coveredLight'><pre>        <span class="keyword">int</span> depth = 0;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>453</td>
 	<td class='coveredLight'>454</td>
 	<td class='coveredLight'><pre>        <span class="keyword">while</span> (pos.getIndex() &lt; pattern.length()) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>454</td>
 	<td class='coveredLight'>455</td>
 	<td class='coveredLight'><pre>            <span class="keyword">final</span> <span class="keyword">char</span> c = pattern.charAt(pos.getIndex());</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>455</td>
 	<td class='coveredLight'>456</td>
 	<td class='coveredLight'><pre>            <span class="keyword">switch</span> (c) {</pre></td>
</tr>
<tr>
 	<td class=''>456</td>
 	<td class=''>457</td>
 	<td class=''><pre>            <span class="keyword">case</span> QUOTE:</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>457</td>
 	<td class='coveredLight'>458</td>
 	<td class='coveredLight'><pre>                appendQuotedString(pattern, pos, sb);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>458</td>
 	<td class='coveredLight'>459</td>
 	<td class='coveredLight'><pre>                <span class="keyword">break</span>;</pre></td>
</tr>
<tr>
 	<td class=''>459</td>
 	<td class=''>460</td>
 	<td class=''><pre>            <span class="keyword">case</span> START_FE:</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>460</td>
 	<td class='coveredLight'>461</td>
 	<td class='coveredLight'><pre>                depth++;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>461</td>
 	<td class='coveredLight'>462</td>
 	<td class='coveredLight'><pre>                sb.append(START_FE).append(readArgumentIndex(pattern, next(pos)));</pre></td>
</tr>
<tr>
 	<td class=''>462</td>
 	<td class=''>463</td>
 	<td class=''><pre>                <span class="comment">// do not look for custom patterns when they are embedded, e.g. in a choice</span></pre></td>
</tr>
<tr>
 	<td class='coveredLight'>463</td>
 	<td class='coveredLight'>464</td>
 	<td class='coveredLight'><pre>                <span class="keyword">if</span> (depth == 1) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>464</td>
 	<td class='coveredLight'>465</td>
 	<td class='coveredLight'><pre>                    fe++;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>465</td>
 	<td class='coveredLight'>466</td>
 	<td class='coveredLight'><pre>                    <span class="keyword">final</span> String customPattern = customPatterns.get(fe);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>466</td>
 	<td class='coveredLight'>467</td>
 	<td class='coveredLight'><pre>                    <span class="keyword">if</span> (customPattern != <span class="keyword">null</span>) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>467</td>
 	<td class='coveredLight'>468</td>
 	<td class='coveredLight'><pre>                        sb.append(START_FMT).append(customPattern);</pre></td>
</tr>
<tr>
 	<td class=''>468</td>
 	<td class=''>469</td>
 	<td class=''><pre>                    }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>469</td>
 	<td class='coveredLight'>470</td>
 	<td class='coveredLight'><pre>                }</pre></td>
</tr>
<tr>
 	<td class=''>470</td>
 	<td class=''>471</td>
 	<td class=''><pre>                <span class="keyword">break</span>;</pre></td>
</tr>
<tr>
 	<td class=''>471</td>
 	<td class=''>472</td>
 	<td class=''><pre>            <span class="keyword">case</span> END_FE:</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>472</td>
 	<td class='coveredLight'>473</td>
 	<td class='coveredLight'><pre>                depth--;</pre></td>
</tr>
<tr>
 	<td class=''>473</td>
 	<td class=''>474</td>
 	<td class=''><pre>                <span class="comment">//$FALL-THROUGH$</span></pre></td>
</tr>
<tr>
 	<td class=''>474</td>
 	<td class=''>475</td>
 	<td class=''><pre>            <span class="keyword">default</span>:</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>475</td>
 	<td class='coveredLight'>476</td>
 	<td class='coveredLight'><pre>                sb.append(c);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>476</td>
 	<td class='coveredLight'>477</td>
 	<td class='coveredLight'><pre>                next(pos);</pre></td>
</tr>
<tr>
 	<td class=''>477</td>
 	<td class=''>478</td>
 	<td class=''><pre>            }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>478</td>
 	<td class='coveredLight'>479</td>
 	<td class='coveredLight'><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>479</td>
 	<td class='coveredLight'>480</td>
 	<td class='coveredLight'><pre>        <span class="keyword">return</span> sb.toString();</pre></td>
</tr>
<tr>
 	<td class=''>480</td>
 	<td class=''>481</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>481</td>
 	<td class=''>482</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>482</td>
 	<td class=''>483</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>483</td>
 	<td class=''>484</td>
 	<td class=''><pre><span class="comment">     * Consume whitespace from the current parse position.</span></pre></td>
</tr>
<tr>
 	<td class=''>484</td>
 	<td class=''>485</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>485</td>
 	<td class=''>486</td>
 	<td class=''><pre><span class="comment">     * @param pattern String to read</span></pre></td>
</tr>
<tr>
 	<td class=''>486</td>
 	<td class=''>487</td>
 	<td class=''><pre><span class="comment">     * @param pos current position</span></pre></td>
</tr>
<tr>
 	<td class=''>487</td>
 	<td class=''>488</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>488</td>
 	<td class=''>489</td>
 	<td class=''><pre>    <span class="keyword">private</span> <span class="keyword">void</span> seekNonWs(<span class="keyword">final</span> String pattern, <span class="keyword">final</span> ParsePosition pos) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>489</td>
 	<td class='coveredLight'>490</td>
 	<td class='coveredLight'><pre>        <span class="keyword">int</span> len = 0;</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>490</td>
 	<td class='coveredLight'>491</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> <span class="keyword">char</span>[] buffer = pattern.toCharArray();</pre></td>
</tr>
<tr>
 	<td class=''>491</td>
 	<td class=''>492</td>
 	<td class=''><pre>        <span class="keyword">do</span> {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>492</td>
 	<td class='coveredLight'>493</td>
 	<td class='coveredLight'><pre>            len = StrMatcher.splitMatcher().isMatch(buffer, pos.getIndex());</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>493</td>
 	<td class='coveredLight'>494</td>
 	<td class='coveredLight'><pre>            pos.setIndex(pos.getIndex() + len);</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>494</td>
 	<td class='notCoveredLight'>495</td>
 	<td class='notCoveredLight'><pre>        } <span class="keyword">while</span> (len &gt; 0 &amp;&amp; pos.getIndex() &lt; pattern.length());</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>495</td>
 	<td class='coveredLight'>496</td>
 	<td class='coveredLight'><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>496</td>
 	<td class=''>497</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>497</td>
 	<td class=''>498</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>498</td>
 	<td class=''>499</td>
 	<td class=''><pre><span class="comment">     * Convenience method to advance parse position by 1.</span></pre></td>
</tr>
<tr>
 	<td class=''>499</td>
 	<td class=''>500</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>500</td>
 	<td class=''>501</td>
 	<td class=''><pre><span class="comment">     * @param pos ParsePosition</span></pre></td>
</tr>
<tr>
 	<td class=''>501</td>
 	<td class=''>502</td>
 	<td class=''><pre><span class="comment">     * @return &lt;code&gt;pos&lt;/code&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>502</td>
 	<td class=''>503</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>503</td>
 	<td class=''>504</td>
 	<td class=''><pre>    <span class="keyword">private</span> ParsePosition next(<span class="keyword">final</span> ParsePosition pos) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>504</td>
 	<td class='coveredLight'>505</td>
 	<td class='coveredLight'><pre>        pos.setIndex(pos.getIndex() + 1);</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>505</td>
 	<td class='coveredLight'>506</td>
 	<td class='coveredLight'><pre>        <span class="keyword">return</span> pos;</pre></td>
</tr>
<tr>
 	<td class=''>506</td>
 	<td class=''>507</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>507</td>
 	<td class=''>508</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>508</td>
 	<td class=''>509</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>509</td>
 	<td class=''>510</td>
 	<td class=''><pre><span class="comment">     * Consume a quoted string, adding it to &lt;code&gt;appendTo&lt;/code&gt; if</span></pre></td>
</tr>
<tr>
 	<td class=''>510</td>
 	<td class=''>511</td>
 	<td class=''><pre><span class="comment">     * specified.</span></pre></td>
</tr>
<tr>
 	<td class=''>511</td>
 	<td class=''>512</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>512</td>
 	<td class=''>513</td>
 	<td class=''><pre><span class="comment">     * @param pattern pattern to parse</span></pre></td>
</tr>
<tr>
 	<td class=''>513</td>
 	<td class=''>514</td>
 	<td class=''><pre><span class="comment">     * @param pos current parse position</span></pre></td>
</tr>
<tr>
 	<td class=''>514</td>
 	<td class=''>515</td>
 	<td class=''><pre><span class="comment">     * @param appendTo optional StringBuilder to append</span></pre></td>
</tr>
<tr>
 	<td class=''>515</td>
 	<td class=''>516</td>
 	<td class=''><pre><span class="comment">     * @return &lt;code&gt;appendTo&lt;/code&gt;</span></pre></td>
</tr>
<tr>
 	<td class=''>516</td>
 	<td class=''>517</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>517</td>
 	<td class=''>518</td>
 	<td class=''><pre>    <span class="keyword">private</span> StringBuilder appendQuotedString(<span class="keyword">final</span> String pattern, <span class="keyword">final</span> ParsePosition pos,</pre></td>
</tr>
<tr>
 	<td class=''>518</td>
 	<td class=''>519</td>
 	<td class=''><pre>            <span class="keyword">final</span> StringBuilder appendTo) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>519</td>
 	<td class='notCoveredLight'>520</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">assert</span> pattern.toCharArray()[pos.getIndex()] == QUOTE</pre></td>
</tr>
<tr>
 	<td class=''>520</td>
 	<td class=''>521</td>
 	<td class=''><pre>                : <span class="string">"Quoted string must start with quote character"</span>;</pre></td>
</tr>
<tr>
 	<td class=''>521</td>
 	<td class=''>522</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>522</td>
 	<td class=''>523</td>
 	<td class=''><pre>        <span class="comment">// handle quote character at the beginning of the string</span></pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>523</td>
 	<td class='notCoveredLight'>524</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">if</span> (appendTo != <span class="keyword">null</span>) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>524</td>
 	<td class='coveredLight'>525</td>
 	<td class='coveredLight'><pre>            appendTo.append(QUOTE);</pre></td>
</tr>
<tr>
 	<td class=''>525</td>
 	<td class=''>526</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>526</td>
 	<td class='coveredLight'>527</td>
 	<td class='coveredLight'><pre>        next(pos);</pre></td>
</tr>
<tr>
 	<td class=''>527</td>
 	<td class=''>528</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class='coveredLight'>528</td>
 	<td class='coveredLight'>529</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> <span class="keyword">int</span> start = pos.getIndex();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>529</td>
 	<td class='coveredLight'>530</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> <span class="keyword">char</span>[] c = pattern.toCharArray();</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>530</td>
 	<td class='coveredLight'>531</td>
 	<td class='coveredLight'><pre>        <span class="keyword">final</span> <span class="keyword">int</span> lastHold = start;</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>531</td>
 	<td class='notCoveredLight'>532</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">for</span> (<span class="keyword">int</span> i = pos.getIndex(); i &lt; pattern.length(); i++) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>532</td>
 	<td class='coveredLight'>533</td>
 	<td class='coveredLight'><pre>            <span class="keyword">switch</span> (c[pos.getIndex()]) {</pre></td>
</tr>
<tr>
 	<td class=''>533</td>
 	<td class=''>534</td>
 	<td class=''><pre>            <span class="keyword">case</span> QUOTE:</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>534</td>
 	<td class='coveredLight'>535</td>
 	<td class='coveredLight'><pre>                next(pos);</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>535</td>
 	<td class='notCoveredLight'>536</td>
 	<td class='notCoveredLight'><pre>                <span class="keyword">return</span> appendTo == <span class="keyword">null</span> ? <span class="keyword">null</span> : appendTo.append(c, lastHold,</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>536</td>
 	<td class='coveredLight'>537</td>
 	<td class='coveredLight'><pre>                        pos.getIndex() - lastHold);</pre></td>
</tr>
<tr>
 	<td class=''>537</td>
 	<td class=''>538</td>
 	<td class=''><pre>            <span class="keyword">default</span>:</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>538</td>
 	<td class='coveredLight'>539</td>
 	<td class='coveredLight'><pre>                next(pos);</pre></td>
</tr>
<tr>
 	<td class=''>539</td>
 	<td class=''>540</td>
 	<td class=''><pre>            }</pre></td>
</tr>
<tr>
 	<td class=''>540</td>
 	<td class=''>541</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>541</td>
 	<td class='notCoveredLight'>542</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</pre></td>
</tr>
<tr>
 	<td class=''>542</td>
 	<td class=''>543</td>
 	<td class=''><pre>                <span class="string">"Unterminated quoted string at position "</span> + start);</pre></td>
</tr>
<tr>
 	<td class=''>543</td>
 	<td class=''>544</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>544</td>
 	<td class=''>545</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>545</td>
 	<td class=''>546</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>546</td>
 	<td class=''>547</td>
 	<td class=''><pre><span class="comment">     * Consume quoted string only.</span></pre></td>
</tr>
<tr>
 	<td class=''>547</td>
 	<td class=''>548</td>
 	<td class=''><pre><span class="comment">     *</span></pre></td>
</tr>
<tr>
 	<td class=''>548</td>
 	<td class=''>549</td>
 	<td class=''><pre><span class="comment">     * @param pattern pattern to parse</span></pre></td>
</tr>
<tr>
 	<td class=''>549</td>
 	<td class=''>550</td>
 	<td class=''><pre><span class="comment">     * @param pos current parse position</span></pre></td>
</tr>
<tr>
 	<td class=''>550</td>
 	<td class=''>551</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>551</td>
 	<td class=''>552</td>
 	<td class=''><pre>    <span class="keyword">private</span> <span class="keyword">void</span> getQuotedString(<span class="keyword">final</span> String pattern, <span class="keyword">final</span> ParsePosition pos) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>552</td>
 	<td class='notCoveredLight'>553</td>
 	<td class='notCoveredLight'><pre>        appendQuotedString(pattern, pos, <span class="keyword">null</span>);</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>553</td>
 	<td class='notCoveredLight'>554</td>
 	<td class='notCoveredLight'><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>554</td>
 	<td class=''>555</td>
 	<td class=''><pre></pre></td>
</tr>
<tr>
 	<td class=''>555</td>
 	<td class=''>556</td>
 	<td class=''><pre>    <span class="comment">/**</span></pre></td>
</tr>
<tr>
 	<td class=''>556</td>
 	<td class=''>557</td>
 	<td class=''><pre><span class="comment">     * Learn whether the specified Collection contains non-null elements.</span></pre></td>
</tr>
<tr>
 	<td class=''>557</td>
 	<td class=''>558</td>
 	<td class=''><pre><span class="comment">     * @param coll to check</span></pre></td>
</tr>
<tr>
 	<td class=''>558</td>
 	<td class=''>559</td>
 	<td class=''><pre><span class="comment">     * @return &lt;code&gt;true&lt;/code&gt; if some Object was found, &lt;code&gt;false&lt;/code&gt; otherwise.</span></pre></td>
</tr>
<tr>
 	<td class=''>559</td>
 	<td class=''>560</td>
 	<td class=''><pre><span class="comment">     */</span></pre></td>
</tr>
<tr>
 	<td class=''>560</td>
 	<td class=''>561</td>
 	<td class=''><pre>    <span class="keyword">private</span> <span class="keyword">boolean</span> containsElements(<span class="keyword">final</span> Collection&lt;?&gt; coll) {</pre></td>
</tr>
<tr>
 	<td class='notCoveredLight'>561</td>
 	<td class='notCoveredLight'>562</td>
 	<td class='notCoveredLight'><pre>        <span class="keyword">if</span> (coll == <span class="keyword">null</span> || coll.isEmpty()) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>562</td>
 	<td class='coveredLight'>563</td>
 	<td class='coveredLight'><pre>            <span class="keyword">return</span> <span class="keyword">false</span>;</pre></td>
</tr>
<tr>
 	<td class=''>563</td>
 	<td class=''>564</td>
 	<td class=''><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>564</td>
 	<td class='coveredLight'>565</td>
 	<td class='coveredLight'><pre>        <span class="keyword">for</span> (<span class="keyword">final</span> Object name : coll) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>565</td>
 	<td class='coveredLight'>566</td>
 	<td class='coveredLight'><pre>            <span class="keyword">if</span> (name != <span class="keyword">null</span>) {</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>566</td>
 	<td class='coveredLight'>567</td>
 	<td class='coveredLight'><pre>                <span class="keyword">return</span> <span class="keyword">true</span>;</pre></td>
</tr>
<tr>
 	<td class=''>567</td>
 	<td class=''>568</td>
 	<td class=''><pre>            }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>568</td>
 	<td class='coveredLight'>569</td>
 	<td class='coveredLight'><pre>        }</pre></td>
</tr>
<tr>
 	<td class='coveredLight'>569</td>
 	<td class='coveredLight'>570</td>
 	<td class='coveredLight'><pre>        <span class="keyword">return</span> <span class="keyword">false</span>;</pre></td>
</tr>
<tr>
 	<td class=''>570</td>
 	<td class=''>571</td>
 	<td class=''><pre>    }</pre></td>
</tr>
<tr>
 	<td class=''>571</td>
 	<td class=''>572</td>
 	<td class=''><pre>}</pre></td>
</tr>
</table>
</div></div>

		<footer>&copy; Operias 2013</footer>
	</body>
</html>